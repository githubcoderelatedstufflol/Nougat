(function(g,S){typeof define=="function"&&define.amd?define([],S):typeof exports!="undefined"?S():(S(),g.FileSaver={})})(this,function(){"use strict";function g(h,c){return typeof c=="undefined"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(h.type)?new Blob(["\uFEFF",h],{type:h.type}):h}function S(h,c,u){var a=new XMLHttpRequest;a.open("GET",h),a.responseType="blob",a.onload=function(){i(a.response,c,u)},a.onerror=function(){console.error("could not download file")},a.send()}function E(h){var c=new XMLHttpRequest;c.open("HEAD",h,!1);try{c.send()}catch(u){}return 200<=c.status&&299>=c.status}function d(h){try{h.dispatchEvent(new MouseEvent("click"))}catch(u){var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),h.dispatchEvent(c)}}var v=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,l=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),i=v.saveAs||(typeof window!="object"||window!==v?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(h,c,u){var a=v.URL||v.webkitURL,t=document.createElement("a");c=c||h.name||"download",t.download=c,t.rel="noopener",typeof h=="string"?(t.href=h,t.origin===location.origin?d(t):E(t.href)?S(h,c,u):d(t,t.target="_blank")):(t.href=a.createObjectURL(h),setTimeout(function(){a.revokeObjectURL(t.href)},4e4),setTimeout(function(){d(t)},0))}:"msSaveOrOpenBlob"in navigator?function(h,c,u){if(c=c||h.name||"download",typeof h!="string")navigator.msSaveOrOpenBlob(g(h,u),c);else if(E(h))S(h,c,u);else{var a=document.createElement("a");a.href=h,a.target="_blank",setTimeout(function(){d(a)})}}:function(h,c,u,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof h=="string")return S(h,c,u);var t=h.type==="application/octet-stream",r=/constructor/i.test(v.HTMLElement)||v.safari,y=/CriOS\/[\d]+/.test(navigator.userAgent);if((y||t&&r||l)&&typeof FileReader!="undefined"){var f=new FileReader;f.onloadend=function(){var n=f.result;n=y?n:n.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=n:location=n,a=null},f.readAsDataURL(h)}else{var p=v.URL||v.webkitURL,e=p.createObjectURL(h);a?a.location=e:location.href=e,a=null,setTimeout(function(){p.revokeObjectURL(e)},4e4)}});v.saveAs=i.saveAs=i,typeof module!="undefined"&&(module.exports=i)});function Platform(g,S){if(!(this instanceof Platform))return new Platform(...arguments);for(const E of Platform.ALL_PLATFORMS)if(E.name===g&&E.version===S)return E;this.name=g,this.version=S,this.toString=()=>Platform.__GET__INTERNAL__NAME__(this),Platform.ALL_PLATFORMS.push(this),Platform.BY_SLASH_NAME[`${g}/${S}`]=this}Platform.ALL_PLATFORMS=[],Platform.BY_SLASH_NAME={},Platform.WINDOWS_10=new Platform("win","10"),Platform.WINDOWS_8_1=new Platform("win","8.1"),Platform.WINDOWS_8=new Platform("win","8"),Platform.WINDOWS_7=new Platform("win","7"),Platform.WINDOWS_VISTA=new Platform("win","vista"),Platform.WINDOWS_XP=new Platform("win","xp"),Platform.ANDROID_7_1=new Platform("android","7.1"),Platform.ANDROID_7_0=new Platform("android","7.0"),Platform.ANDROID_6_0=new Platform("android","6.0"),Platform.ANDROID_5_1=new Platform("android","5.1"),Platform.ANDROID_5_0=new Platform("android","5.0"),Platform.ANDROID_4_4=new Platform("android","4.4"),Platform.___HARDCODED___PLATFORM___DATA___=[{group:"Windows",items:[{id:Platform.WINDOWS_10,displayName:"Windows 10",icon:"#icon-windows-10"},{id:Platform.WINDOWS_8_1,displayName:"Windows 8.1",icon:"#icon-windows-8"},{id:Platform.WINDOWS_8,displayName:"Windows 8",icon:"#icon-windows-8"},{id:Platform.WINDOWS_7,displayName:"Windows 7",icon:"#icon-windows-7"},{id:Platform.WINDOWS_VISTA,displayName:"Windows Vista",icon:"#icon-windows-vista"},{id:Platform.WINDOWS_XP,displayName:"Windows XP",icon:"#icon-windows-xp"}]},{group:"Android",items:[{id:Platform.ANDROID_7_1,displayName:"Android 7.1",icon:"#icon-android-7"},{id:Platform.ANDROID_7_0,displayName:"Android 7.0",icon:"#icon-android-7"},{id:Platform.ANDROID_6_0,displayName:"Android 6.0",icon:"#icon-android-6"},{id:Platform.ANDROID_5_1,displayName:"Android 5.1",icon:"#icon-android-5"},{id:Platform.ANDROID_5_0,displayName:"Android 5.0",icon:"#icon-android-5"},{id:Platform.ANDROID_4_4,displayName:"Android 4.4",icon:"#icon-android-4"}]}],Platform.___HARDCODED___PLATFORM___METADATA___=new Map,Platform.__INTERNAL__NAMES__=new Map,Platform.__GET__INTERNAL__NAME__=g=>{const S=Platform.__INTERNAL__NAMES__.get(g);if(S)return S;const E=Object.keys(Platform);for(const d of E)if(Platform[d]===g)return Platform.__INTERNAL__NAMES__.set(g,d),d},(()=>{const g=Platform.___HARDCODED___PLATFORM___METADATA___,S=Platform.___HARDCODED___PLATFORM___DATA___;for(const{items:E}of S)for(const{id:d,displayName:v,icon:l}of E)g.set(d,{displayName:v,icon:l})})();function Browser(g,S){if(!(this instanceof Browser))return new Browser(...arguments);for(const E of Browser.ALL_BROWSERS)if(E.name===g&&E.version===S)return E;this.name=g,this.version=S,this.platforms=new Set,this.toString=()=>Browser.__GET__INTERNAL__NAME__(this),this.supports=(...E)=>(E.forEach(d=>this.platforms.add(d)),this),Browser.ALL_BROWSERS.push(this),Browser.BY_SLASH_NAME[`${g}/${S}`]=this}Browser.ALL_BROWSERS=[],Browser.BY_SLASH_NAME={},Browser.___HARDCODED___BROWSER___SUPPORT___INFO___=new Map,Browser.___HARDCODED___BROWSER___METADATA___={edge:{displayName:"Edge",icon:"#icon-edge"},ie:{displayName:"Internet Explorer",icon:"#icon-ie"},chrome:{displayName:"Chrome",icon:"#icon-chrome"},firefox:{displayName:"Firefox",icon:"#icon-firefox"},opera:{displayName:"Opera",icon:"#icon-opera"},safari:{displayName:"Safari",icon:"#icon-safari"},browser:{displayName:"Android Browser",icon:"#icon-android-browser"}},Browser.__INTERNAL__NAMES__=new Map,Browser.__GET__INTERNAL__NAME__=g=>{const S=Browser.__INTERNAL__NAMES__.get(g);if(S)return S;const E=Object.keys(Browser);for(const d of E)if(Browser[d]===g)return Browser.__INTERNAL__NAMES__.set(g,d),d},(()=>{const g=(w,A)=>[...Array(A+1-w).keys()].map(R=>R+w),S=(w,A)=>(...R)=>T=>Browser[A(T).replace(/\./,"_")]=new Browser(w,T).supports(...R),E=S("browser",w=>`ANDROID_BROWSER_${w}`),d=S("firefox",w=>`FIREFOX_${w}`),v=S("chrome",w=>`CHROME_${w}`),l=S("safari",w=>`SAFARI_${w}`),i=S("opera",w=>`OPERA_${w}`),h=S("edge",w=>`EDGE_${w}`),c=S("ie",w=>`IE_${w}`),{WINDOWS_XP:u,WINDOWS_VISTA:a,WINDOWS_7:t,WINDOWS_8:r,WINDOWS_8_1:y,WINDOWS_10:f}=Platform;[92].forEach(h(f)),[6,7,8].forEach(c(u)),[9].forEach(c(a)),[10].forEach(c(t,r)),[11].forEach(c(t,y,f)),g(1,49).forEach(v(u)),g(1,50).forEach(v(a)),[...g(1,81),...g(83,105)].forEach(v(t)),g(30,57).forEach(v(r,y)),[...g(1,81),...g(83,92)].forEach(v(f));const p=w=>[3,"3.5","3.6",...g(4,w)];p(49).forEach(d(u)),p(52).forEach(d(a)),p(104).forEach(d(t)),p(52).forEach(d(r,y)),p(90).forEach(d(f));const e=w=>[10,"10.5",11,"11.5","11.6",12,...g(15,w)];e(36).forEach(i(u,a)),[...e(58),60,62,...g(63,90)].forEach(i(t)),g(20,44).forEach(i(r,y)),e(43).forEach(i(u)),[...e(58),60,62,...g(63,77)].forEach(i(f)),[4,"5.0.5","5.1"].forEach(l(u,a,t,r,y,f)),Platform.ALL_PLATFORMS.filter(w=>w.name==="android").forEach(w=>E(w)(w.version));const n=w=>Browser.ALL_BROWSERS.filter(w),o=(w,A)=>parseFloat(A.version)-parseFloat(w.version),s=Browser.___HARDCODED___BROWSER___SUPPORT___INFO___,m=Browser.___HARDCODED___BROWSER___METADATA___,b=["edge","ie","chrome","firefox","opera","safari","browser"];for(const w of Platform.ALL_PLATFORMS){const A=[];for(const R of b){const{displayName:T,icon:L}=m[R],P=n(_=>_.name===R&&_.platforms.has(w)).sort(o);A.push({displayName:T,browserName:R,icon:L,items:P})}s.set(w,A)}})();function Queue({sessionPayload:g,queueUrl:S,browseRequest:E}){if(!(this instanceof Queue))return new Queue(...arguments);const d=1e4,{READY_TO_CONNECT:v,CONNECTING:l,CONNECTED:i,DISCONNECTED:h}=Queue;let c=null,u=null,a=null,t=null;this.state=v;const r=()=>{this.onConnected=()=>{},this.onQueueStart=(e,n)=>{},this.onQueueUpdate=(e,n)=>{},this.onYourTurn=()=>{},this.onDisconnected=()=>{},this.onInvalidRequest=()=>{},this.onFreeLimitReached=()=>{},this.onDestroyed=()=>{},this.onError=()=>{}},y=e=>{try{return JSON.parse(e)}catch(n){}return null},f=()=>{this.state!==h&&(this.state=h,r(),a!==null&&(a.onopen=()=>{},a.onclose=()=>{},a.onmessage=()=>{},a.close(1e3),a=null))},p=()=>{t!==null&&clearTimeout(t),t=setTimeout(()=>{this.onDisconnected(),f()},d)};r(),this.destroy=()=>{this.onDestroyed(),f()},this.connect=()=>{this.state===v&&(this.state=l,a=new WebSocket(S),a.onopen=()=>{this.state=i,c=1,u=1,a.send(JSON.stringify({type:"auth",data:{payload:g,browseRequest:E}})),p(),this.onConnected()},a.onclose=({code:e,reason:n,wasClean:o})=>{this.onDisconnected(),f()},a.onmessage=({message:e})=>{if(p(),e==="ping")return a.send("pong");const n=y(e);if(!n||!Array.isArray(n)||n.length<1)return this.onError("Invalid message from queue"),f();const[o,s]=n;if(o==="authFailed")return this.onInvalidRequest("Authentication failed"),f();if(o==="internalError")return this.onError("Internal queue error"),f();o=="inQueue"})}}Queue.READY_TO_CONNECT=Symbol("READY_TO_CONNECT"),Queue.CONNECTING=Symbol("CONNECTING"),Queue.CONNECTED=Symbol("CONNECTED"),Queue.DISCONNECTED=Symbol("DISCONNECTED");function Encoder({jobId:g,encoderUrl:S,multiplexPort:E=null,isOutdatedClient:d=!1,isWebpSupported:v=!0}){if(!(this instanceof Encoder))return new Encoder(...arguments);const l=()=>{this.onRunning=()=>{},this.onScreenResize=()=>{},this.onScreenUpdate=()=>{},this.onTimeOut=()=>{},this.onDisconnected=()=>{},this.onDestroyed=()=>{}};l(),this.state=Encoder.READY_TO_CONNECT,this.canvas=document.createElement("canvas"),this.width=null,this.height=null;let i=null,h=null;this.getPlatform=()=>h;let c=null;this.getLastNavigateBrowser=()=>c,this.__defaultResolutionThatShouldBeReceivedFromEncoder__setThisTo480x800IfPlatformIsAndroid__=[1024,768],this.__platformTypeAcknowledgeThatShouldBeReceivedFromEncoder__setThisToThePlatformYouConnectToForNow=null;const u=[],a=[];let t=null;const r=()=>{for(let w=0;w<a.length;w++){const A=a[w];if(A.ready)A.handler.call(null,A.data),a.splice(w,1),w--;else break}},y=(w,A)=>{const R={handler:w,ready:!1,data:null};gDebugHook("encoder_pushNewUpdate",R),a.push(R);const T=L=>{R.data=L,R.ready=!0,gDebugHook("encoder_updateReady",R),r()};typeof A=="function"?A.call(null,L=>T(L)):T(A)},f=(w,...A)=>{this.state===Encoder.RUNNING&&i.emit(w,...A)},p=()=>{this.state!==Encoder.DISCONNECTED&&(this.state=Encoder.DISCONNECTED,l(),i.disconnect(),i=null)},e=w=>{u.splice(0,u.length);for(const A of w){const R=Browser.BY_SLASH_NAME[A];R!=null&&u.push(R)}},n=(w,A)=>{this.width=w,this.height=A,this.canvas.width=w,this.canvas.height=A,t=this.canvas.getContext("2d"),t.fillStyle="#000000",t.fillRect(0,0,w,A),this.onScreenResize(w,A)},o=({x:w,y:A,width:R,height:T,image:L})=>{t.drawImage(L,w,A,R,T),this.onScreenUpdate()},s=({srcX:w,srcY:A,width:R,height:T,x:L,y:P})=>{t.drawImage(this.canvas,w,A,R,T,L,P,R,T),this.onScreenUpdate()},m=({width:w,height:A})=>{n(w,A)},b=({x:w,y:A,width:R,height:T,base64:L,type:P})=>_=>{const C=new Image;C.src=`data:image/${P};base64,${L}`,C.onload=()=>_({x:w,y:A,width:R,height:T,image:C})};this.navigateTo=(w,A)=>{h&&h.name==="android"&&A.indexOf("http:")!==0&&A.indexOf("https:")!==0&&(A="http:"+A),c=w,f("navigate",w.name,w.version,A)},this.setResolution=(w,A)=>f("resize",w,A),this.sendPointer=(w,A,R)=>f("sendPointer",{x:w,y:A,mouseMask:R}),this.sendKeyDown=(w,A)=>f("sendKeyDown",{keyCode:w,shiftMask:A}),this.sendKeyUp=(w,A)=>f("sendKeyUp",{keyCode:w,shiftMask:A}),this.isBrowserAvailable=w=>u.indexOf(w)!==-1,this.destroy=()=>{this.onDestroyed(),p()},this.connect=()=>{if(this.state!==Encoder.READY_TO_CONNECT)throw new Error("Already connected, please establish a new connection.");this.state=Encoder.CONNECTING,i=io(S,{reconnection:!1}),gDebugHook("encoder_socket",i);const w=()=>i.emit("multiplexPort",E),A=()=>{this.state=Encoder.AUTHENTICATING,i.emit("confirmId",g,"","",{ie8:d,webp:v})};i.on("connect",()=>{this.state=Encoder.CONNECTED,E!=null?w():A()}),i.on("confirmedMultiplexPort",()=>{A()}),i.on("browserList",R=>{e(R)}),i.on("confirmedId",()=>{if(this.state=Encoder.RUNNING,n(...this.__defaultResolutionThatShouldBeReceivedFromEncoder__setThisTo480x800IfPlatformIsAndroid__),h=this.__platformTypeAcknowledgeThatShouldBeReceivedFromEncoder__setThisToThePlatformYouConnectToForNow,h==null)throw new Error("Platform not acknowledged");this.onRunning()}),i.on("screenUpdate",R=>{y(o,b(R))}),i.on("copyRect",R=>{y(s,R)}),i.on("screenSize",R=>{y(m,R)}),i.on("timeout",()=>{this.onTimeOut(),p()}),i.on("disconnect",()=>{this.onDisconnected(),p()})}}Encoder.READY_TO_CONNECT=Symbol("READY_TO_CONNECT"),Encoder.CONNECTING=Symbol("CONNECTING"),Encoder.AUTHENTICATING=Symbol("AUTHENTICATING"),Encoder.RUNNING=Symbol("RUNNING"),Encoder.DISCONNECTED=Symbol("DISCONNECTED");function BrowserScreen(){if(!(this instanceof BrowserScreen))return new BrowserScreen(...arguments);const{roundWithPrecision:g,getDisplayScale:S,getPerfectSize:E,getContainerSize:d,whenAddedToDocument:v,bestImageFit:l}=BrowserScreen.Util;let i=null;const h=e=>[Math.round((e.clientX-i.left)*window.devicePixelRatio),Math.round((e.clientY-i.top)*window.devicePixelRatio)];this.ctx=null,this.width=0,this.height=0,this.onKeyEvent=()=>{},this.onTouchEvent=()=>{},this.onMouseEvent=()=>{},this.onWheelEvent=()=>{},this.onViewportChanged=()=>{};const c=e=>{if(!i)return;const[n,o]=h(e),[s,m]=this.canvasToContent(n,o);this.onMouseEvent({x:n,y:o,cx:s,cy:m,event:e})},u=e=>{!i||this.onTouchEvent({event:e})},a=e=>{if(!i)return;const[n,o]=h(e),[s,m]=this.canvasToContent(n,o);this.onWheelEvent({x:n,y:o,cx:s,cy:m,event:e})},t=e=>{this.onKeyEvent({event:e}),e.preventDefault()},r=e=>{e.preventDefault()};this.canvas=document.createElement("canvas"),this.canvas.addEventListener("contextmenu",r),this.canvas.addEventListener("mousemove",c),this.canvas.addEventListener("mousedown",c),this.canvas.addEventListener("mouseup",c),this.canvas.addEventListener("touchmove",u,{passive:!1}),this.canvas.addEventListener("touchstart",u,{passive:!1}),this.canvas.addEventListener("touchend",u,{passive:!1}),this.canvas.addEventListener("wheel",a),this.canvas.addEventListener("keydown",t),this.canvas.addEventListener("keyup",t),this.contentRect={x:0,y:0,width:0,height:0,scale:1},this.contentSize={width:0,height:0};let y=null;this.getContentFit=()=>y,this.setContentFit=e=>{y=e!==null?Math.min(1,Math.max(0,e)):null,this.updateContentRect(),this.onViewportChanged()},this.updateContentRect=()=>{const e=l({width:this.contentSize.width,height:this.contentSize.height,maxWidth:this.width,maxHeight:this.height,upscaleFactor:y});this.contentRect.x=Math.round(e.offsetX),this.contentRect.y=Math.round(e.offsetY),this.contentRect.width=Math.round(e.width),this.contentRect.height=Math.round(e.height),this.contentRect.scale=g(e.scale)},this.getPosWithinTarget=({clientX:e,clientY:n})=>h({clientX:e,clientY:n}),this.contentToCanvas=(e,n,o=null,s=null)=>{const{x:m,y:b,scale:w}=this.contentRect;return o===s===null?[e*w+m,n*w+b]:[e*w+m,n*w+b,o*w,s*w].map(A=>~~A)},this.canvasToContent=(e,n,o=null,s=null)=>{const{x:m,y:b,scale:w}=this.contentRect;return o===s===null?[(e-m)/w,(n-b)/w]:[(e-m)/w,(n-b)/w,o/w,s/w].map(A=>~~A)},this.shouldDrawContentImage=()=>!0,this.drawContentImage=(e,n,o)=>{!this.ctx||this.shouldDrawContentImage(e,n,o)&&(this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(e,...this.contentToCanvas(0,0,n,o)))},this.resizeToFitParent=()=>{const e=10,n=S(),[o,s]=d(this.canvas.parentNode);i=this.canvas.getBoundingClientRect();const m=E(o,e,n),b=E(s,e,n),w=m*n,A=b*n;this.canvas.style.width=`${m}px`,this.canvas.style.height=`${b}px`,this.canvas.width=w,this.canvas.height=A;const R=this.canvas.getContext("2d"),T=R.fillRect,L=R.clearRect,P=R.drawImage,_=R.strokeRect;R.imageSmoothingEnabled=!0,R.fillRect=(C,D,I,x)=>T.call(R,~~C,~~D,~~I,~~x),R.clearRect=(C,D,I,x)=>L.call(R,~~C,~~D,~~I,~~x),R.strokeRect=(C,D,I,x)=>_.call(R,~~C+.5,~~D+.5,~~I,~~x),R.drawImage=(C,...D)=>P.call(R,C,...D.map(I=>~~I)),this.ctx=R,this.width=w,this.height=A};const f=()=>{this.resizeToFitParent(),this.updateContentRect(),this.onViewportChanged()},p=()=>{const e=this.canvas.parentNode;if(!e){console.log("[BrowserScreen] Detached, waiting until reattached..."),v(this.canvas,()=>p());return}console.log("[BrowserScreen] Attached to",e);const n=new ResizeObserver(()=>f()),o=new MutationObserver(s=>s.forEach(m=>{if(m.type==="attributes"&&m.target===e)f();else if(m.type==="childList"){for(const b of m.removedNodes)if(b===this.canvas){n.disconnect(),o.disconnect(),p();return}}}));o.observe(e,{subtree:!0,childList:!0,attributeFilter:["style"]}),n.observe(e)};v(this.canvas,()=>p())}BrowserScreen.Util=(()=>{const g=(i,h=1e4)=>Math.round((i+Number.EPSILON)*h)/h;return{roundWithPrecision:g,getDisplayScale:()=>g(window.devicePixelRatio),getPerfectSize:(i,h,c)=>{const u=t=>Math.floor(t)===t,a=Math.floor(i);for(let t=0;t<h;t++){const r=a-t;if(u(r*c))return r}return a},getContainerSize:i=>{if(i===null)return[0,0];const h=i.getBoundingClientRect();return[Math.floor(h.width),Math.floor(h.height)]},whenAddedToDocument:(i,h)=>{const c=new MutationObserver(u=>u.forEach(a=>{if(a.type==="childList"){for(const t of a.addedNodes)if(t===i){c.disconnect(),h();return}}}));c.observe(document,{subtree:!0,childList:!0})},bestImageFit:({width:i,height:h,maxWidth:c,maxHeight:u,upscaleFactor:a=null})=>{if(i>=c){const t=i/c,r=h/u;return t>r?{width:c,height:h/t,offsetX:0,offsetY:(u-h/t)/2,scale:1/t}:{width:i/r,height:h/r,offsetX:(c-i/r)/2,offsetY:(u-h/r)/2,scale:1/r}}else if(h>u){const t=h/u;return{width:i/t,height:h/t,offsetX:(c-i/t)/2,offsetY:0,scale:1/t}}else if(a!==null){const t=c/i,r=u/h,y=(n,o,s)=>n*(1-s)+o*s,p=(n=>i*n<=c&&h*n<=u)(t)?t:r,e=y(1,p,a);return{width:i,height:h,offsetX:(c-i*e)/2,offsetY:(u-h*e)/2,scale:e}}else return{width:i,height:h,offsetX:(c-i)/2,offsetY:(u-h)/2,scale:1}}}})();function LegacyQueue({queueUrl:g,accessToken:S,platform:E,browser:d}){if(!(this instanceof LegacyQueue))return new LegacyQueue(...arguments);this.state=LegacyQueue.READY_TO_CONNECT;let v=null,l=null,i=null;const h="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split(""),c=(t,r=h)=>{const y=[];for(let f=0;f<t;f++)y.push(r[Math.floor(Math.random()*r.length)]);return y.join("")},u=()=>{this.onConnected=()=>{},this.onQueueStart=(t,r)=>{},this.onQueueUpdate=(t,r)=>{},this.onYourTurn=(t,r,y)=>{},this.onInvalidRequest=t=>{},this.onFreeLimitReached=()=>{},this.onDisconnected=()=>{},this.onDestroyed=()=>{},this.onError=()=>{}};u();const a=()=>{this.state!==LegacyQueue.DISCONNECTED&&(this.state=LegacyQueue.DISCONNECTED,u(),i.disconnect(),i=null)};this.destroy=()=>{this.onDestroyed(),a()},this.connect=()=>{if(this.state!==LegacyQueue.READY_TO_CONNECT){this.onError("Already connected, please establish a new connection."),a();return}this.state=LegacyQueue.CONNECTING,i=io(g,{reconnection:!1}),i.on("connect_error",()=>{this.onDisconnected(),a()}),i.on("connect",()=>{this.state=LegacyQueue.CONNECTED;const t=S.split("/"),[r,y]=[...t.slice(0,-1),...t.slice(1)];i.emit("new",{id:c(16),plan:r,email:y,browser:d.name,version:d.version,platform_name:E.name,platform_version:E.version,url:""}),v=1,l=1,this.onConnected()}),i.on("error",t=>{this.onError(t.message),a()}),i.on("disconnect",()=>{this.onDisconnected(),a()}),i.on("start",(t,r)=>{this.state=LegacyQueue.WAITING_IN_QUEUE,v=t,l=t,this.onQueueStart(l,r),this.onQueueUpdate(v,l)}),i.on("invalidNew",t=>{this.onInvalidRequest(t.replace(/^error:\s+/,"")),a()}),i.on("freeLimit",()=>{this.onFreeLimitReached(),a()}),i.on("next",()=>{this.onQueueUpdate(--v,l)}),i.on("incQueueLength",()=>{this.onQueueUpdate(v,++l)}),i.on("decQueueLength",()=>{this.onQueueUpdate(v,--l)}),i.on("yourTurn",({id:t,encoder:r,multiplexPort:y})=>{this.state=LegacyQueue.YOUR_TURN;const f=`https://encoder-${r.replace(/\./g,"-")}.browserling.com`;this.onYourTurn(t,f,y||null),a()})}}LegacyQueue.READY_TO_CONNECT=Symbol("READY_TO_CONNECT"),LegacyQueue.CONNECTING=Symbol("CONNECTING"),LegacyQueue.CONNECTED=Symbol("CONNECTED"),LegacyQueue.WAITING_IN_QUEUE=Symbol("WAITING_IN_QUEUE"),LegacyQueue.YOUR_TURN=Symbol("YOUR_TURN"),LegacyQueue.DISCONNECTED=Symbol("DISCONNECTED"),function(g){if(typeof exports=="object"&&typeof module!="undefined")module.exports=g();else if(typeof define=="function"&&define.amd)define([],g);else{var S;typeof window!="undefined"?S=window:typeof global!="undefined"?S=global:typeof self!="undefined"?S=self:S=this,S.io=g()}}(function(){var g,S,E;return function d(v,l,i){function h(a,t){if(!l[a]){if(!v[a]){var r=typeof require=="function"&&require;if(!t&&r)return r(a,!0);if(c)return c(a,!0);var y=new Error("Cannot find module '"+a+"'");throw y.code="MODULE_NOT_FOUND",y}var f=l[a]={exports:{}};v[a][0].call(f.exports,function(p){var e=v[a][1][p];return h(e||p)},f,f.exports,d,v,l,i)}return l[a].exports}for(var c=typeof require=="function"&&require,u=0;u<i.length;u++)h(i[u]);return h}({1:[function(d,v,l){v.exports=d("./lib/")},{"./lib/":2}],2:[function(d,v,l){v.exports=d("./socket"),v.exports.parser=d("engine.io-parser")},{"./socket":3,"engine.io-parser":19}],3:[function(d,v,l){(function(i){var h=d("./transports"),c=d("component-emitter"),u=d("debug")("engine.io-client:socket"),a=d("indexof"),t=d("engine.io-parser"),r=d("parseuri"),y=d("parsejson"),f=d("parseqs");v.exports=e;function p(){}function e(o,s){if(!(this instanceof e))return new e(o,s);s=s||{},o&&typeof o=="object"&&(s=o,o=null),o?(o=r(o),s.hostname=o.host,s.secure=o.protocol=="https"||o.protocol=="wss",s.port=o.port,o.query&&(s.query=o.query)):s.host&&(s.hostname=r(s.host).host),this.secure=s.secure!=null?s.secure:i.location&&location.protocol=="https:",s.hostname&&!s.port&&(s.port=this.secure?"443":"80"),this.agent=s.agent||!1,this.hostname=s.hostname||(i.location?location.hostname:"localhost"),this.port=s.port||(i.location&&location.port?location.port:this.secure?443:80),this.query=s.query||{},typeof this.query=="string"&&(this.query=f.decode(this.query)),this.upgrade=s.upgrade!==!1,this.path=(s.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!s.forceJSONP,this.jsonp=s.jsonp!==!1,this.forceBase64=!!s.forceBase64,this.enablesXDR=!!s.enablesXDR,this.timestampParam=s.timestampParam||"t",this.timestampRequests=s.timestampRequests,this.transports=s.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=s.policyPort||843,this.rememberUpgrade=s.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=s.onlyBinaryUpgrades,this.perMessageDeflate=s.perMessageDeflate!==!1?s.perMessageDeflate||{}:!1,this.perMessageDeflate===!0&&(this.perMessageDeflate={}),this.perMessageDeflate&&this.perMessageDeflate.threshold==null&&(this.perMessageDeflate.threshold=1024),this.pfx=s.pfx||null,this.key=s.key||null,this.passphrase=s.passphrase||null,this.cert=s.cert||null,this.ca=s.ca||null,this.ciphers=s.ciphers||null,this.rejectUnauthorized=s.rejectUnauthorized===void 0?!0:s.rejectUnauthorized;var m=typeof i=="object"&&i;m.global===m&&s.extraHeaders&&Object.keys(s.extraHeaders).length>0&&(this.extraHeaders=s.extraHeaders),this.open()}e.priorWebsocketSuccess=!1,c(e.prototype),e.protocol=t.protocol,e.Socket=e,e.Transport=d("./transport"),e.transports=d("./transports"),e.parser=d("engine.io-parser"),e.prototype.createTransport=function(o){u('creating transport "%s"',o);var s=n(this.query);s.EIO=t.protocol,s.transport=o,this.id&&(s.sid=this.id);var m=new h[o]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:s,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return m};function n(o){var s={};for(var m in o)o.hasOwnProperty(m)&&(s[m]=o[m]);return s}e.prototype.open=function(){var o;if(this.rememberUpgrade&&e.priorWebsocketSuccess&&this.transports.indexOf("websocket")!=-1)o="websocket";else if(this.transports.length===0){var s=this;setTimeout(function(){s.emit("error","No transports available")},0);return}else o=this.transports[0];this.readyState="opening";try{o=this.createTransport(o)}catch(m){this.transports.shift(),this.open();return}o.open(),this.setTransport(o)},e.prototype.setTransport=function(o){u("setting transport %s",o.name);var s=this;this.transport&&(u("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=o,o.on("drain",function(){s.onDrain()}).on("packet",function(m){s.onPacket(m)}).on("error",function(m){s.onError(m)}).on("close",function(){s.onClose("transport close")})},e.prototype.probe=function(o){u('probing transport "%s"',o);var s=this.createTransport(o,{probe:1}),m=!1,b=this;e.priorWebsocketSuccess=!1;function w(){if(b.onlyBinaryUpgrades){var C=!this.supportsBinary&&b.transport.supportsBinary;m=m||C}m||(u('probe transport "%s" opened',o),s.send([{type:"ping",data:"probe"}]),s.once("packet",function(D){if(!m)if(D.type=="pong"&&D.data=="probe"){if(u('probe transport "%s" pong',o),b.upgrading=!0,b.emit("upgrading",s),!s)return;e.priorWebsocketSuccess=s.name=="websocket",u('pausing current transport "%s"',b.transport.name),b.transport.pause(function(){m||b.readyState!="closed"&&(u("changing transport and sending upgrade packet"),_(),b.setTransport(s),s.send([{type:"upgrade"}]),b.emit("upgrade",s),s=null,b.upgrading=!1,b.flush())})}else{u('probe transport "%s" failed',o);var I=new Error("probe error");I.transport=s.name,b.emit("upgradeError",I)}}))}function A(){m||(m=!0,_(),s.close(),s=null)}function R(C){var D=new Error("probe error: "+C);D.transport=s.name,A(),u('probe transport "%s" failed because of error: %s',o,C),b.emit("upgradeError",D)}function T(){R("transport closed")}function L(){R("socket closed")}function P(C){s&&C.name!=s.name&&(u('"%s" works - aborting "%s"',C.name,s.name),A())}function _(){s.removeListener("open",w),s.removeListener("error",R),s.removeListener("close",T),b.removeListener("close",L),b.removeListener("upgrading",P)}s.once("open",w),s.once("error",R),s.once("close",T),this.once("close",L),this.once("upgrading",P),s.open()},e.prototype.onOpen=function(){if(u("socket open"),this.readyState="open",e.priorWebsocketSuccess=this.transport.name=="websocket",this.emit("open"),this.flush(),this.readyState=="open"&&this.upgrade&&this.transport.pause){u("starting upgrade probes");for(var o=0,s=this.upgrades.length;o<s;o++)this.probe(this.upgrades[o])}},e.prototype.onPacket=function(o){if(this.readyState=="opening"||this.readyState=="open")switch(u('socket receive: type "%s", data "%s"',o.type,o.data),this.emit("packet",o),this.emit("heartbeat"),o.type){case"open":this.onHandshake(y(o.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var s=new Error("server error");s.code=o.data,this.onError(s);break;case"message":this.emit("data",o.data),this.emit("message",o.data);break}else u('packet received with socket readyState "%s"',this.readyState)},e.prototype.onHandshake=function(o){this.emit("handshake",o),this.id=o.sid,this.transport.query.sid=o.sid,this.upgrades=this.filterUpgrades(o.upgrades),this.pingInterval=o.pingInterval,this.pingTimeout=o.pingTimeout,this.onOpen(),this.readyState!="closed"&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},e.prototype.onHeartbeat=function(o){clearTimeout(this.pingTimeoutTimer);var s=this;s.pingTimeoutTimer=setTimeout(function(){s.readyState!="closed"&&s.onClose("ping timeout")},o||s.pingInterval+s.pingTimeout)},e.prototype.setPing=function(){var o=this;clearTimeout(o.pingIntervalTimer),o.pingIntervalTimer=setTimeout(function(){u("writing ping packet - expecting pong within %sms",o.pingTimeout),o.ping(),o.onHeartbeat(o.pingTimeout)},o.pingInterval)},e.prototype.ping=function(){var o=this;this.sendPacket("ping",function(){o.emit("ping")})},e.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emit("drain"):this.flush()},e.prototype.flush=function(){this.readyState!="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(u("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},e.prototype.write=e.prototype.send=function(o,s,m){return this.sendPacket("message",o,s,m),this},e.prototype.sendPacket=function(o,s,m,b){if(typeof s=="function"&&(b=s,s=void 0),typeof m=="function"&&(b=m,m=null),!(this.readyState=="closing"||this.readyState=="closed")){m=m||{},m.compress=m.compress!==!1;var w={type:o,data:s,options:m};this.emit("packetCreate",w),this.writeBuffer.push(w),b&&this.once("flush",b),this.flush()}},e.prototype.close=function(){if(this.readyState=="opening"||this.readyState=="open"){this.readyState="closing";var o=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?b():s()}):this.upgrading?b():s()}function s(){o.onClose("forced close"),u("socket closing - telling transport to close"),o.transport.close()}function m(){o.removeListener("upgrade",m),o.removeListener("upgradeError",m),s()}function b(){o.once("upgrade",m),o.once("upgradeError",m)}return this},e.prototype.onError=function(o){u("socket error %j",o),e.priorWebsocketSuccess=!1,this.emit("error",o),this.onClose("transport error",o)},e.prototype.onClose=function(o,s){if(this.readyState=="opening"||this.readyState=="open"||this.readyState=="closing"){u('socket close with reason: "%s"',o);var m=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",o,s),m.writeBuffer=[],m.prevBufferLen=0}},e.prototype.filterUpgrades=function(o){for(var s=[],m=0,b=o.length;m<b;m++)~a(this.transports,o[m])&&s.push(o[m]);return s}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{"./transport":4,"./transports":5,"component-emitter":15,debug:17,"engine.io-parser":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(d,v,l){var i=d("engine.io-parser"),h=d("component-emitter");v.exports=c;function c(u){this.path=u.path,this.hostname=u.hostname,this.port=u.port,this.secure=u.secure,this.query=u.query,this.timestampParam=u.timestampParam,this.timestampRequests=u.timestampRequests,this.readyState="",this.agent=u.agent||!1,this.socket=u.socket,this.enablesXDR=u.enablesXDR,this.pfx=u.pfx,this.key=u.key,this.passphrase=u.passphrase,this.cert=u.cert,this.ca=u.ca,this.ciphers=u.ciphers,this.rejectUnauthorized=u.rejectUnauthorized,this.extraHeaders=u.extraHeaders}h(c.prototype),c.prototype.onError=function(u,a){var t=new Error(u);return t.type="TransportError",t.description=a,this.emit("error",t),this},c.prototype.open=function(){return(this.readyState=="closed"||this.readyState=="")&&(this.readyState="opening",this.doOpen()),this},c.prototype.close=function(){return(this.readyState=="opening"||this.readyState=="open")&&(this.doClose(),this.onClose()),this},c.prototype.send=function(u){if(this.readyState=="open")this.write(u);else throw new Error("Transport not open")},c.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},c.prototype.onData=function(u){var a=i.decodePacket(u,this.socket.binaryType);this.onPacket(a)},c.prototype.onPacket=function(u){this.emit("packet",u)},c.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":15,"engine.io-parser":19}],5:[function(d,v,l){(function(i){var h=d("xmlhttprequest-ssl"),c=d("./polling-xhr"),u=d("./polling-jsonp"),a=d("./websocket");l.polling=t,l.websocket=a;function t(r){var y,f=!1,p=!1,e=r.jsonp!==!1;if(i.location){var n=location.protocol=="https:",o=location.port;o||(o=n?443:80),f=r.hostname!=location.hostname||o!=r.port,p=r.secure!=n}if(r.xdomain=f,r.xscheme=p,y=new h(r),"open"in y&&!r.forceJSONP)return new c(r);if(!e)throw new Error("JSONP disabled");return new u(r)}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,"xmlhttprequest-ssl":10}],6:[function(d,v,l){(function(i){var h=d("./polling"),c=d("component-inherit");v.exports=f;var u=/\n/g,a=/\\n/g,t,r=0;function y(){}function f(p){h.call(this,p),this.query=this.query||{},t||(i.___eio||(i.___eio=[]),t=i.___eio),this.index=t.length;var e=this;t.push(function(n){e.onData(n)}),this.query.j=this.index,i.document&&i.addEventListener&&i.addEventListener("beforeunload",function(){e.script&&(e.script.onerror=y)},!1)}c(f,h),f.prototype.supportsBinary=!1,f.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),h.prototype.doClose.call(this)},f.prototype.doPoll=function(){var p=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(s){p.onError("jsonp poll error",s)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e;var o=typeof navigator!="undefined"&&/gecko/i.test(navigator.userAgent);o&&setTimeout(function(){var s=document.createElement("iframe");document.body.appendChild(s),document.body.removeChild(s)},100)},f.prototype.doWrite=function(p,e){var n=this;if(!this.form){var o=document.createElement("form"),s=document.createElement("textarea"),m=this.iframeId="eio_iframe_"+this.index,b;o.className="socketio",o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",o.target=m,o.method="POST",o.setAttribute("accept-charset","utf-8"),s.name="d",o.appendChild(s),document.body.appendChild(o),this.form=o,this.area=s}this.form.action=this.uri();function w(){A(),e()}function A(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(T){n.onError("jsonp polling iframe removal error",T)}try{var R='<iframe src="javascript:0" name="'+n.iframeId+'">';b=document.createElement(R)}catch(T){b=document.createElement("iframe"),b.name=n.iframeId,b.src="javascript:0"}b.id=n.iframeId,n.form.appendChild(b),n.iframe=b}A(),p=p.replace(a,`\\
`),this.area.value=p.replace(u,"\\n");try{this.form.submit()}catch(R){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){n.iframe.readyState=="complete"&&w()}:this.iframe.onload=w}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{"./polling":8,"component-inherit":16}],7:[function(d,v,l){(function(i){var h=d("xmlhttprequest-ssl"),c=d("./polling"),u=d("component-emitter"),a=d("component-inherit"),t=d("debug")("engine.io-client:polling-xhr");v.exports=y,v.exports.Request=f;function r(){}function y(e){if(c.call(this,e),i.location){var n=location.protocol=="https:",o=location.port;o||(o=n?443:80),this.xd=e.hostname!=i.location.hostname||o!=e.port,this.xs=e.secure!=n}else this.extraHeaders=e.extraHeaders}a(y,c),y.prototype.supportsBinary=!0,y.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.extraHeaders=this.extraHeaders,new f(e)},y.prototype.doWrite=function(e,n){var o=typeof e!="string"&&e!==void 0,s=this.request({method:"POST",data:e,isBinary:o}),m=this;s.on("success",n),s.on("error",function(b){m.onError("xhr post error",b)}),this.sendXhr=s},y.prototype.doPoll=function(){t("xhr poll");var e=this.request(),n=this;e.on("data",function(o){n.onData(o)}),e.on("error",function(o){n.onError("xhr poll error",o)}),this.pollXhr=e};function f(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=e.async!==!1,this.data=e.data!=null?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}u(f.prototype),f.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var n=this.xhr=new h(e),o=this;try{t("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async);try{if(this.extraHeaders){n.setDisableHeaderCheck(!0);for(var s in this.extraHeaders)this.extraHeaders.hasOwnProperty(s)&&n.setRequestHeader(s,this.extraHeaders[s])}}catch(m){}if(this.supportsBinary&&(n.responseType="arraybuffer"),this.method=="POST")try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(m){}"withCredentials"in n&&(n.withCredentials=!0),this.hasXDR()?(n.onload=function(){o.onLoad()},n.onerror=function(){o.onError(n.responseText)}):n.onreadystatechange=function(){n.readyState==4&&(n.status==200||n.status==1223?o.onLoad():setTimeout(function(){o.onError(n.status)},0))},t("xhr data %s",this.data),n.send(this.data)}catch(m){setTimeout(function(){o.onError(m)},0);return}i.document&&(this.index=f.requestsCount++,f.requests[this.index]=this)},f.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},f.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},f.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},f.prototype.cleanup=function(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=r:this.xhr.onreadystatechange=r,e)try{this.xhr.abort()}catch(n){}i.document&&delete f.requests[this.index],this.xhr=null}},f.prototype.onLoad=function(){var e;try{var n;try{n=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(w){}if(n==="application/octet-stream")e=this.xhr.response;else if(!this.supportsBinary)e=this.xhr.responseText;else try{e=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(w){for(var o=new Uint8Array(this.xhr.response),s=[],m=0,b=o.length;m<b;m++)s.push(o[m]);e=String.fromCharCode.apply(null,s)}}catch(w){this.onError(w)}e!=null&&this.onData(e)},f.prototype.hasXDR=function(){return typeof i.XDomainRequest!="undefined"&&!this.xs&&this.enablesXDR},f.prototype.abort=function(){this.cleanup()},i.document&&(f.requestsCount=0,f.requests={},i.attachEvent?i.attachEvent("onunload",p):i.addEventListener&&i.addEventListener("beforeunload",p,!1));function p(){for(var e in f.requests)f.requests.hasOwnProperty(e)&&f.requests[e].abort()}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{"./polling":8,"component-emitter":15,"component-inherit":16,debug:17,"xmlhttprequest-ssl":10}],8:[function(d,v,l){var i=d("../transport"),h=d("parseqs"),c=d("engine.io-parser"),u=d("component-inherit"),a=d("yeast"),t=d("debug")("engine.io-client:polling");v.exports=y;var r=function(){var f=d("xmlhttprequest-ssl"),p=new f({xdomain:!1});return p.responseType!=null}();function y(f){var p=f&&f.forceBase64;(!r||p)&&(this.supportsBinary=!1),i.call(this,f)}u(y,i),y.prototype.name="polling",y.prototype.doOpen=function(){this.poll()},y.prototype.pause=function(f){var p=0,e=this;this.readyState="pausing";function n(){t("paused"),e.readyState="paused",f()}if(this.polling||!this.writable){var o=0;this.polling&&(t("we are currently polling - waiting to pause"),o++,this.once("pollComplete",function(){t("pre-pause polling complete"),--o||n()})),this.writable||(t("we are currently writing - waiting to pause"),o++,this.once("drain",function(){t("pre-pause writing complete"),--o||n()}))}else n()},y.prototype.poll=function(){t("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},y.prototype.onData=function(f){var p=this;t("polling got data %s",f);var e=function(n,o,s){if(p.readyState=="opening"&&p.onOpen(),n.type=="close")return p.onClose(),!1;p.onPacket(n)};c.decodePayload(f,this.socket.binaryType,e),this.readyState!="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState=="open"?this.poll():t('ignoring poll - transport state "%s"',this.readyState))},y.prototype.doClose=function(){var f=this;function p(){t("writing close packet"),f.write([{type:"close"}])}this.readyState=="open"?(t("transport open - closing"),p()):(t("transport not open - deferring close"),this.once("open",p))},y.prototype.write=function(f){var p=this;this.writable=!1;var e=function(){p.writable=!0,p.emit("drain")},p=this;c.encodePayload(f,this.supportsBinary,function(n){p.doWrite(n,e)})},y.prototype.uri=function(){var f=this.query||{},p=this.secure?"https":"http",e="";this.timestampRequests!==!1&&(f[this.timestampParam]=a()),!this.supportsBinary&&!f.sid&&(f.b64=1),f=h.encode(f),this.port&&(p=="https"&&this.port!=443||p=="http"&&this.port!=80)&&(e=":"+this.port),f.length&&(f="?"+f);var n=this.hostname.indexOf(":")!==-1;return p+"://"+(n?"["+this.hostname+"]":this.hostname)+e+this.path+f}},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,"xmlhttprequest-ssl":10,yeast:30}],9:[function(d,v,l){(function(i){var h=d("../transport"),c=d("engine.io-parser"),u=d("parseqs"),a=d("component-inherit"),t=d("yeast"),r=d("debug")("engine.io-client:websocket"),y=i.WebSocket||i.MozWebSocket,f=y;if(!f&&typeof window=="undefined")try{f=d("ws")}catch(e){}v.exports=p;function p(e){var n=e&&e.forceBase64;n&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,h.call(this,e)}a(p,h),p.prototype.name="websocket",p.prototype.supportsBinary=!0,p.prototype.doOpen=function(){if(!!this.check()){var e=this,n=this.uri(),o=void 0,s={agent:this.agent,perMessageDeflate:this.perMessageDeflate};s.pfx=this.pfx,s.key=this.key,s.passphrase=this.passphrase,s.cert=this.cert,s.ca=this.ca,s.ciphers=this.ciphers,s.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(s.headers=this.extraHeaders),this.ws=y?new f(n):new f(n,o,s),this.ws.binaryType===void 0&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},p.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(n){e.onData(n.data)},this.ws.onerror=function(n){e.onError("websocket error",n)}},typeof navigator!="undefined"&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(p.prototype.onData=function(e){var n=this;setTimeout(function(){h.prototype.onData.call(n,e)},0)}),p.prototype.write=function(e){var n=this;this.writable=!1;for(var o=e.length,s=0,m=o;s<m;s++)(function(w){c.encodePacket(w,n.supportsBinary,function(A){if(!y){var R={};if(w.options&&(R.compress=w.options.compress),n.perMessageDeflate){var T=typeof A=="string"?i.Buffer.byteLength(A):A.length;T<n.perMessageDeflate.threshold&&(R.compress=!1)}}try{y?n.ws.send(A):n.ws.send(A,R)}catch(L){r("websocket closed before onclose event")}--o||b()})})(e[s]);function b(){n.emit("flush"),setTimeout(function(){n.writable=!0,n.emit("drain")},0)}},p.prototype.onClose=function(){h.prototype.onClose.call(this)},p.prototype.doClose=function(){typeof this.ws!="undefined"&&this.ws.close()},p.prototype.uri=function(){var e=this.query||{},n=this.secure?"wss":"ws",o="";this.port&&(n=="wss"&&this.port!=443||n=="ws"&&this.port!=80)&&(o=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=t()),this.supportsBinary||(e.b64=1),e=u.encode(e),e.length&&(e="?"+e);var s=this.hostname.indexOf(":")!==-1;return n+"://"+(s?"["+this.hostname+"]":this.hostname)+o+this.path+e},p.prototype.check=function(){return!!f&&!("__initialize"in f&&this.name===p.prototype.name)}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,ws:void 0,yeast:30}],10:[function(d,v,l){var i=d("has-cors");v.exports=function(h){var c=h.xdomain,u=h.xscheme,a=h.enablesXDR;try{if(typeof XMLHttpRequest!="undefined"&&(!c||i))return new XMLHttpRequest}catch(t){}try{if(typeof XDomainRequest!="undefined"&&!u&&a)return new XDomainRequest}catch(t){}if(!c)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}},{"has-cors":22}],11:[function(d,v,l){v.exports=i;function i(c,u,a){var t=!1;return a=a||h,r.count=c,c===0?u():r;function r(y,f){if(r.count<=0)throw new Error("after called too many times");--r.count,y?(t=!0,u(y),u=a):r.count===0&&!t&&u(null,f)}}function h(){}},{}],12:[function(d,v,l){v.exports=function(i,h,c){var u=i.byteLength;if(h=h||0,c=c||u,i.slice)return i.slice(h,c);if(h<0&&(h+=u),c<0&&(c+=u),c>u&&(c=u),h>=u||h>=c||u===0)return new ArrayBuffer(0);for(var a=new Uint8Array(i),t=new Uint8Array(c-h),r=h,y=0;r<c;r++,y++)t[y]=a[r];return t.buffer}},{}],13:[function(d,v,l){(function(i){"use strict";l.encode=function(h){var c=new Uint8Array(h),u,a=c.length,t="";for(u=0;u<a;u+=3)t+=i[c[u]>>2],t+=i[(c[u]&3)<<4|c[u+1]>>4],t+=i[(c[u+1]&15)<<2|c[u+2]>>6],t+=i[c[u+2]&63];return a%3==2?t=t.substring(0,t.length-1)+"=":a%3==1&&(t=t.substring(0,t.length-2)+"=="),t},l.decode=function(h){var c=h.length*.75,u=h.length,a,t=0,r,y,f,p;h[h.length-1]==="="&&(c--,h[h.length-2]==="="&&c--);var e=new ArrayBuffer(c),n=new Uint8Array(e);for(a=0;a<u;a+=4)r=i.indexOf(h[a]),y=i.indexOf(h[a+1]),f=i.indexOf(h[a+2]),p=i.indexOf(h[a+3]),n[t++]=r<<2|y>>4,n[t++]=(y&15)<<4|f>>2,n[t++]=(f&3)<<6|p&63;return e}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],14:[function(d,v,l){(function(i){var h=i.BlobBuilder||i.WebKitBlobBuilder||i.MSBlobBuilder||i.MozBlobBuilder,c=function(){try{var f=new Blob(["hi"]);return f.size===2}catch(p){return!1}}(),u=c&&function(){try{var f=new Blob([new Uint8Array([1,2])]);return f.size===2}catch(p){return!1}}(),a=h&&h.prototype.append&&h.prototype.getBlob;function t(f){for(var p=0;p<f.length;p++){var e=f[p];if(e.buffer instanceof ArrayBuffer){var n=e.buffer;if(e.byteLength!==n.byteLength){var o=new Uint8Array(e.byteLength);o.set(new Uint8Array(n,e.byteOffset,e.byteLength)),n=o.buffer}f[p]=n}}}function r(f,p){p=p||{};var e=new h;t(f);for(var n=0;n<f.length;n++)e.append(f[n]);return p.type?e.getBlob(p.type):e.getBlob()}function y(f,p){return t(f),new Blob(f,p||{})}v.exports=function(){return c?u?i.Blob:y:a?r:void 0}()}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{}],15:[function(d,v,l){v.exports=i;function i(c){if(c)return h(c)}function h(c){for(var u in i.prototype)c[u]=i.prototype[u];return c}i.prototype.on=i.prototype.addEventListener=function(c,u){return this._callbacks=this._callbacks||{},(this._callbacks[c]=this._callbacks[c]||[]).push(u),this},i.prototype.once=function(c,u){var a=this;this._callbacks=this._callbacks||{};function t(){a.off(c,t),u.apply(this,arguments)}return t.fn=u,this.on(c,t),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(c,u){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var a=this._callbacks[c];if(!a)return this;if(arguments.length==1)return delete this._callbacks[c],this;for(var t,r=0;r<a.length;r++)if(t=a[r],t===u||t.fn===u){a.splice(r,1);break}return this},i.prototype.emit=function(c){this._callbacks=this._callbacks||{};var u=[].slice.call(arguments,1),a=this._callbacks[c];if(a){a=a.slice(0);for(var t=0,r=a.length;t<r;++t)a[t].apply(this,u)}return this},i.prototype.listeners=function(c){return this._callbacks=this._callbacks||{},this._callbacks[c]||[]},i.prototype.hasListeners=function(c){return!!this.listeners(c).length}},{}],16:[function(d,v,l){v.exports=function(i,h){var c=function(){};c.prototype=h.prototype,i.prototype=new c,i.prototype.constructor=i}},{}],17:[function(d,v,l){l=v.exports=d("./debug"),l.log=c,l.formatArgs=h,l.save=u,l.load=a,l.useColors=i,l.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:t(),l.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function i(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}l.formatters.j=function(r){return JSON.stringify(r)};function h(){var r=arguments,y=this.useColors;if(r[0]=(y?"%c":"")+this.namespace+(y?" %c":" ")+r[0]+(y?"%c ":" ")+"+"+l.humanize(this.diff),!y)return r;var f="color: "+this.color;r=[r[0],f,"color: inherit"].concat(Array.prototype.slice.call(r,1));var p=0,e=0;return r[0].replace(/%[a-z%]/g,function(n){n!=="%%"&&(p++,n==="%c"&&(e=p))}),r.splice(e,0,f),r}function c(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function u(r){try{r==null?l.storage.removeItem("debug"):l.storage.debug=r}catch(y){}}function a(){var r;try{r=l.storage.debug}catch(y){}return r}l.enable(a());function t(){try{return window.localStorage}catch(r){}}},{"./debug":18}],18:[function(d,v,l){l=v.exports=u,l.coerce=y,l.disable=t,l.enable=a,l.enabled=r,l.humanize=d("ms"),l.names=[],l.skips=[],l.formatters={};var i=0,h;function c(){return l.colors[i++%l.colors.length]}function u(f){function p(){}p.enabled=!1;function e(){var o=e,s=+new Date,m=s-(h||s);o.diff=m,o.prev=h,o.curr=s,h=s,o.useColors==null&&(o.useColors=l.useColors()),o.color==null&&o.useColors&&(o.color=c());var b=Array.prototype.slice.call(arguments);b[0]=l.coerce(b[0]),typeof b[0]!="string"&&(b=["%o"].concat(b));var w=0;b[0]=b[0].replace(/%([a-z%])/g,function(R,T){if(R==="%%")return R;w++;var L=l.formatters[T];if(typeof L=="function"){var P=b[w];R=L.call(o,P),b.splice(w,1),w--}return R}),typeof l.formatArgs=="function"&&(b=l.formatArgs.apply(o,b));var A=e.log||l.log||console.log.bind(console);A.apply(o,b)}e.enabled=!0;var n=l.enabled(f)?e:p;return n.namespace=f,n}function a(f){l.save(f);for(var p=(f||"").split(/[\s,]+/),e=p.length,n=0;n<e;n++)!p[n]||(f=p[n].replace(/\*/g,".*?"),f[0]==="-"?l.skips.push(new RegExp("^"+f.substr(1)+"$")):l.names.push(new RegExp("^"+f+"$")))}function t(){l.enable("")}function r(f){var p,e;for(p=0,e=l.skips.length;p<e;p++)if(l.skips[p].test(f))return!1;for(p=0,e=l.names.length;p<e;p++)if(l.names[p].test(f))return!0;return!1}function y(f){return f instanceof Error?f.stack||f.message:f}},{ms:25}],19:[function(d,v,l){(function(i){var h=d("./keys"),c=d("has-binary"),u=d("arraybuffer.slice"),a=d("base64-arraybuffer"),t=d("after"),r=d("utf8"),y=navigator.userAgent.match(/Android/i),f=/PhantomJS/i.test(navigator.userAgent),p=y||f;l.protocol=3;var e=l.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},n=h(e),o={type:"error",data:"parser error"},s=d("blob");l.encodePacket=function(T,L,P,_){typeof L=="function"&&(_=L,L=!1),typeof P=="function"&&(_=P,P=null);var C=T.data===void 0?void 0:T.data.buffer||T.data;if(i.ArrayBuffer&&C instanceof ArrayBuffer)return b(T,L,_);if(s&&C instanceof i.Blob)return A(T,L,_);if(C&&C.base64)return m(T,_);var D=e[T.type];return T.data!==void 0&&(D+=P?r.encode(String(T.data)):String(T.data)),_(""+D)};function m(T,L){var P="b"+l.packets[T.type]+T.data.data;return L(P)}function b(T,L,P){if(!L)return l.encodeBase64Packet(T,P);var _=T.data,C=new Uint8Array(_),D=new Uint8Array(1+_.byteLength);D[0]=e[T.type];for(var I=0;I<C.length;I++)D[I+1]=C[I];return P(D.buffer)}function w(T,L,P){if(!L)return l.encodeBase64Packet(T,P);var _=new FileReader;return _.onload=function(){T.data=_.result,l.encodePacket(T,L,!0,P)},_.readAsArrayBuffer(T.data)}function A(T,L,P){if(!L)return l.encodeBase64Packet(T,P);if(p)return w(T,L,P);var _=new Uint8Array(1);_[0]=e[T.type];var C=new s([_.buffer,T.data]);return P(C)}l.encodeBase64Packet=function(T,L){var P="b"+l.packets[T.type];if(s&&T.data instanceof i.Blob){var _=new FileReader;return _.onload=function(){var W=_.result.split(",")[1];L(P+W)},_.readAsDataURL(T.data)}var C;try{C=String.fromCharCode.apply(null,new Uint8Array(T.data))}catch(W){for(var D=new Uint8Array(T.data),I=new Array(D.length),x=0;x<D.length;x++)I[x]=D[x];C=String.fromCharCode.apply(null,I)}return P+=i.btoa(C),L(P)},l.decodePacket=function(T,L,P){if(typeof T=="string"||T===void 0){if(T.charAt(0)=="b")return l.decodeBase64Packet(T.substr(1),L);if(P)try{T=r.decode(T)}catch(x){return o}var C=T.charAt(0);return Number(C)!=C||!n[C]?o:T.length>1?{type:n[C],data:T.substring(1)}:{type:n[C]}}var _=new Uint8Array(T),C=_[0],D=u(T,1);return s&&L==="blob"&&(D=new s([D])),{type:n[C],data:D}},l.decodeBase64Packet=function(T,L){var P=n[T.charAt(0)];if(!i.ArrayBuffer)return{type:P,data:{base64:!0,data:T.substr(1)}};var _=a.decode(T.substr(1));return L==="blob"&&s&&(_=new s([_])),{type:P,data:_}},l.encodePayload=function(T,L,P){typeof L=="function"&&(P=L,L=null);var _=c(T);if(L&&_)return s&&!p?l.encodePayloadAsBlob(T,P):l.encodePayloadAsArrayBuffer(T,P);if(!T.length)return P("0:");function C(I){return I.length+":"+I}function D(I,x){l.encodePacket(I,_?L:!1,!0,function(W){x(null,C(W))})}R(T,D,function(I,x){return P(x.join(""))})};function R(T,L,P){for(var _=new Array(T.length),C=t(T.length,P),D=function(x,W,J){L(W,function(se,ne){_[x]=ne,J(se,_)})},I=0;I<T.length;I++)D(I,T[I],C)}l.decodePayload=function(T,L,P){if(typeof T!="string")return l.decodePayloadAsBinary(T,L,P);typeof L=="function"&&(P=L,L=null);var _;if(T=="")return P(o,0,1);for(var C="",D,I,x=0,W=T.length;x<W;x++){var J=T.charAt(x);if(J!=":")C+=J;else{if(C==""||C!=(D=Number(C))||(I=T.substr(x+1,D),C!=I.length))return P(o,0,1);if(I.length){if(_=l.decodePacket(I,L,!0),o.type==_.type&&o.data==_.data)return P(o,0,1);var se=P(_,x+D,W);if(se===!1)return}x+=D,C=""}}if(C!="")return P(o,0,1)},l.encodePayloadAsArrayBuffer=function(T,L){if(!T.length)return L(new ArrayBuffer(0));function P(_,C){l.encodePacket(_,!0,!0,function(D){return C(null,D)})}R(T,P,function(_,C){var D=C.reduce(function(W,J){var se;return typeof J=="string"?se=J.length:se=J.byteLength,W+se.toString().length+se+2},0),I=new Uint8Array(D),x=0;return C.forEach(function(W){var J=typeof W=="string",se=W;if(J){for(var le=new Uint8Array(W.length),ne=0;ne<W.length;ne++)le[ne]=W.charCodeAt(ne);se=le.buffer}J?I[x++]=0:I[x++]=1;for(var ce=se.byteLength.toString(),ne=0;ne<ce.length;ne++)I[x++]=parseInt(ce[ne]);I[x++]=255;for(var le=new Uint8Array(se),ne=0;ne<le.length;ne++)I[x++]=le[ne]}),L(I.buffer)})},l.encodePayloadAsBlob=function(T,L){function P(_,C){l.encodePacket(_,!0,!0,function(D){var I=new Uint8Array(1);if(I[0]=1,typeof D=="string"){for(var x=new Uint8Array(D.length),W=0;W<D.length;W++)x[W]=D.charCodeAt(W);D=x.buffer,I[0]=0}for(var J=D instanceof ArrayBuffer?D.byteLength:D.size,se=J.toString(),ne=new Uint8Array(se.length+1),W=0;W<se.length;W++)ne[W]=parseInt(se[W]);if(ne[se.length]=255,s){var ce=new s([I.buffer,ne.buffer,D]);C(null,ce)}})}R(T,P,function(_,C){return L(new s(C))})},l.decodePayloadAsBinary=function(T,L,P){typeof L=="function"&&(P=L,L=null);for(var _=T,C=[],D=!1;_.byteLength>0;){for(var I=new Uint8Array(_),x=I[0]===0,W="",J=1;I[J]!=255;J++){if(W.length>310){D=!0;break}W+=I[J]}if(D)return P(o,0,1);_=u(_,2+W.length),W=parseInt(W);var se=u(_,0,W);if(x)try{se=String.fromCharCode.apply(null,new Uint8Array(se))}catch(le){var ne=new Uint8Array(se);se="";for(var J=0;J<ne.length;J++)se+=String.fromCharCode(ne[J])}C.push(se),_=u(_,W)}var ce=C.length;C.forEach(function(le,Te){P(l.decodePacket(le,L,!0),Te,ce)})}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{"./keys":20,after:11,"arraybuffer.slice":12,"base64-arraybuffer":13,blob:14,"has-binary":21,utf8:29}],20:[function(d,v,l){v.exports=Object.keys||function(h){var c=[],u=Object.prototype.hasOwnProperty;for(var a in h)u.call(h,a)&&c.push(a);return c}},{}],21:[function(d,v,l){(function(i){var h=d("isarray");v.exports=c;function c(u){function a(t){if(!t)return!1;if(i.Buffer&&i.Buffer.isBuffer(t)||i.ArrayBuffer&&t instanceof ArrayBuffer||i.Blob&&t instanceof Blob||i.File&&t instanceof File)return!0;if(h(t)){for(var r=0;r<t.length;r++)if(a(t[r]))return!0}else if(t&&typeof t=="object"){t.toJSON&&(t=t.toJSON());for(var y in t)if(Object.prototype.hasOwnProperty.call(t,y)&&a(t[y]))return!0}return!1}return a(u)}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{isarray:24}],22:[function(d,v,l){try{v.exports=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(i){v.exports=!1}},{}],23:[function(d,v,l){var i=[].indexOf;v.exports=function(h,c){if(i)return h.indexOf(c);for(var u=0;u<h.length;++u)if(h[u]===c)return u;return-1}},{}],24:[function(d,v,l){v.exports=Array.isArray||function(i){return Object.prototype.toString.call(i)=="[object Array]"}},{}],25:[function(d,v,l){var i=1e3,h=i*60,c=h*60,u=c*24,a=u*365.25;v.exports=function(p,e){return e=e||{},typeof p=="string"?t(p):e.long?y(p):r(p)};function t(p){if(p=""+p,!(p.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(p);if(!!e){var n=parseFloat(e[1]),o=(e[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return n*a;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*h;case"seconds":case"second":case"secs":case"sec":case"s":return n*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}function r(p){return p>=u?Math.round(p/u)+"d":p>=c?Math.round(p/c)+"h":p>=h?Math.round(p/h)+"m":p>=i?Math.round(p/i)+"s":p+"ms"}function y(p){return f(p,u,"day")||f(p,c,"hour")||f(p,h,"minute")||f(p,i,"second")||p+" ms"}function f(p,e,n){if(!(p<e))return p<e*1.5?Math.floor(p/e)+" "+n:Math.ceil(p/e)+" "+n+"s"}},{}],26:[function(d,v,l){(function(i){var h=/^[\],:{}\s]*$/,c=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,u=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,a=/(?:^|:|,)(?:\s*\[)+/g,t=/^\s+/,r=/\s+$/;v.exports=function(f){if(typeof f!="string"||!f)return null;if(f=f.replace(t,"").replace(r,""),i.JSON&&JSON.parse)return JSON.parse(f);if(h.test(f.replace(c,"@").replace(u,"]").replace(a,"")))return new Function("return "+f)()}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{}],27:[function(d,v,l){l.encode=function(i){var h="";for(var c in i)i.hasOwnProperty(c)&&(h.length&&(h+="&"),h+=encodeURIComponent(c)+"="+encodeURIComponent(i[c]));return h},l.decode=function(i){for(var h={},c=i.split("&"),u=0,a=c.length;u<a;u++){var t=c[u].split("=");h[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}return h}},{}],28:[function(d,v,l){var i=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,h=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];v.exports=function(u){var a=u,t=u.indexOf("["),r=u.indexOf("]");t!=-1&&r!=-1&&(u=u.substring(0,t)+u.substring(t,r).replace(/:/g,";")+u.substring(r,u.length));for(var y=i.exec(u||""),f={},p=14;p--;)f[h[p]]=y[p]||"";return t!=-1&&r!=-1&&(f.source=a,f.host=f.host.substring(1,f.host.length-1).replace(/;/g,":"),f.authority=f.authority.replace("[","").replace("]","").replace(/;/g,":"),f.ipv6uri=!0),f}},{}],29:[function(d,v,l){(function(i){/*! https://mths.be/utf8js v2.0.0 by @mathias */(function(h){var c=typeof l=="object"&&l,u=typeof v=="object"&&v&&v.exports==c&&v,a=typeof i=="object"&&i;(a.global===a||a.window===a)&&(h=a);var t=String.fromCharCode;function r(_){for(var C=[],D=0,I=_.length,x,W;D<I;)x=_.charCodeAt(D++),x>=55296&&x<=56319&&D<I?(W=_.charCodeAt(D++),(W&64512)==56320?C.push(((x&1023)<<10)+(W&1023)+65536):(C.push(x),D--)):C.push(x);return C}function y(_){for(var C=_.length,D=-1,I,x="";++D<C;)I=_[D],I>65535&&(I-=65536,x+=t(I>>>10&1023|55296),I=56320|I&1023),x+=t(I);return x}function f(_){if(_>=55296&&_<=57343)throw Error("Lone surrogate U+"+_.toString(16).toUpperCase()+" is not a scalar value")}function p(_,C){return t(_>>C&63|128)}function e(_){if((_&4294967168)==0)return t(_);var C="";return(_&4294965248)==0?C=t(_>>6&31|192):(_&4294901760)==0?(f(_),C=t(_>>12&15|224),C+=p(_,6)):(_&4292870144)==0&&(C=t(_>>18&7|240),C+=p(_,12),C+=p(_,6)),C+=t(_&63|128),C}function n(_){for(var C=r(_),D=C.length,I=-1,x,W="";++I<D;)x=C[I],W+=e(x);return W}function o(){if(w>=b)throw Error("Invalid byte index");var _=m[w]&255;if(w++,(_&192)==128)return _&63;throw Error("Invalid continuation byte")}function s(){var _,C,D,I,x;if(w>b)throw Error("Invalid byte index");if(w==b)return!1;if(_=m[w]&255,w++,(_&128)==0)return _;if((_&224)==192){var C=o();if(x=(_&31)<<6|C,x>=128)return x;throw Error("Invalid continuation byte")}if((_&240)==224){if(C=o(),D=o(),x=(_&15)<<12|C<<6|D,x>=2048)return f(x),x;throw Error("Invalid continuation byte")}if((_&248)==240&&(C=o(),D=o(),I=o(),x=(_&15)<<18|C<<12|D<<6|I,x>=65536&&x<=1114111))return x;throw Error("Invalid UTF-8 detected")}var m,b,w;function A(_){m=r(_),b=m.length,w=0;for(var C=[],D;(D=s())!==!1;)C.push(D);return y(C)}var R={version:"2.0.0",encode:n,decode:A};if(typeof g=="function"&&typeof g.amd=="object"&&g.amd)g(function(){return R});else if(c&&!c.nodeType)if(u)u.exports=R;else{var T={},L=T.hasOwnProperty;for(var P in R)L.call(R,P)&&(c[P]=R[P])}else h.utf8=R})(this)}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{}],30:[function(d,v,l){"use strict";var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),h=64,c={},u=0,a=0,t;function r(p){var e="";do e=i[p%h]+e,p=Math.floor(p/h);while(p>0);return e}function y(p){var e=0;for(a=0;a<p.length;a++)e=e*h+c[p.charAt(a)];return e}function f(){var p=r(+new Date);return p!==t?(u=0,t=p):p+"."+r(u++)}for(;a<h;a++)c[i[a]]=a;f.encode=r,f.decode=y,v.exports=f},{}],31:[function(d,v,l){var i=d("./url"),h=d("socket.io-parser"),c=d("./manager"),u=d("debug")("socket.io-client");v.exports=l=t;var a=l.managers={};function t(r,y){typeof r=="object"&&(y=r,r=void 0),y=y||{};var f=i(r),p=f.source,e=f.id,n=f.path,o=a[e]&&n in a[e].nsps,s=y.forceNew||y["force new connection"]||y.multiplex===!1||o,m;return s?(u("ignoring socket cache for %s",p),m=c(p,y)):(a[e]||(u("new io instance for %s",p),a[e]=c(p,y)),m=a[e]),m.socket(f.path)}l.protocol=h.protocol,l.connect=t,l.Manager=d("./manager"),l.Socket=d("./socket")},{"./manager":32,"./socket":34,"./url":35,debug:39,"socket.io-parser":47}],32:[function(d,v,l){var i=d("engine.io-client"),h=d("./socket"),c=d("component-emitter"),u=d("socket.io-parser"),a=d("./on"),t=d("component-bind"),r=d("debug")("socket.io-client:manager"),y=d("indexof"),f=d("backo2"),p=Object.prototype.hasOwnProperty;v.exports=e;function e(n,o){if(!(this instanceof e))return new e(n,o);n&&typeof n=="object"&&(o=n,n=void 0),o=o||{},o.path=o.path||"/socket.io",this.nsps={},this.subs=[],this.opts=o,this.reconnection(o.reconnection!==!1),this.reconnectionAttempts(o.reconnectionAttempts||1/0),this.reconnectionDelay(o.reconnectionDelay||1e3),this.reconnectionDelayMax(o.reconnectionDelayMax||5e3),this.randomizationFactor(o.randomizationFactor||.5),this.backoff=new f({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(o.timeout==null?2e4:o.timeout),this.readyState="closed",this.uri=n,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new u.Encoder,this.decoder=new u.Decoder,this.autoConnect=o.autoConnect!==!1,this.autoConnect&&this.open()}e.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var n in this.nsps)p.call(this.nsps,n)&&this.nsps[n].emit.apply(this.nsps[n],arguments)},e.prototype.updateSocketIds=function(){for(var n in this.nsps)p.call(this.nsps,n)&&(this.nsps[n].id=this.engine.id)},c(e.prototype),e.prototype.reconnection=function(n){return arguments.length?(this._reconnection=!!n,this):this._reconnection},e.prototype.reconnectionAttempts=function(n){return arguments.length?(this._reconnectionAttempts=n,this):this._reconnectionAttempts},e.prototype.reconnectionDelay=function(n){return arguments.length?(this._reconnectionDelay=n,this.backoff&&this.backoff.setMin(n),this):this._reconnectionDelay},e.prototype.randomizationFactor=function(n){return arguments.length?(this._randomizationFactor=n,this.backoff&&this.backoff.setJitter(n),this):this._randomizationFactor},e.prototype.reconnectionDelayMax=function(n){return arguments.length?(this._reconnectionDelayMax=n,this.backoff&&this.backoff.setMax(n),this):this._reconnectionDelayMax},e.prototype.timeout=function(n){return arguments.length?(this._timeout=n,this):this._timeout},e.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()},e.prototype.open=e.prototype.connect=function(n){if(r("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;r("opening %s",this.uri),this.engine=i(this.uri,this.opts);var o=this.engine,s=this;this.readyState="opening",this.skipReconnect=!1;var m=a(o,"open",function(){s.onopen(),n&&n()}),b=a(o,"error",function(R){if(r("connect_error"),s.cleanup(),s.readyState="closed",s.emitAll("connect_error",R),n){var T=new Error("Connection error");T.data=R,n(T)}else s.maybeReconnectOnOpen()});if(this._timeout!==!1){var w=this._timeout;r("connect attempt will timeout after %d",w);var A=setTimeout(function(){r("connect attempt timed out after %d",w),m.destroy(),o.close(),o.emit("error","timeout"),s.emitAll("connect_timeout",w)},w);this.subs.push({destroy:function(){clearTimeout(A)}})}return this.subs.push(m),this.subs.push(b),this},e.prototype.onopen=function(){r("open"),this.cleanup(),this.readyState="open",this.emit("open");var n=this.engine;this.subs.push(a(n,"data",t(this,"ondata"))),this.subs.push(a(n,"ping",t(this,"onping"))),this.subs.push(a(n,"pong",t(this,"onpong"))),this.subs.push(a(n,"error",t(this,"onerror"))),this.subs.push(a(n,"close",t(this,"onclose"))),this.subs.push(a(this.decoder,"decoded",t(this,"ondecoded")))},e.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},e.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},e.prototype.ondata=function(n){this.decoder.add(n)},e.prototype.ondecoded=function(n){this.emit("packet",n)},e.prototype.onerror=function(n){r("error",n),this.emitAll("error",n)},e.prototype.socket=function(n){var o=this.nsps[n];if(!o){o=new h(this,n),this.nsps[n]=o;var s=this;o.on("connecting",m),o.on("connect",function(){o.id=s.engine.id}),this.autoConnect&&m()}function m(){~y(s.connecting,o)||s.connecting.push(o)}return o},e.prototype.destroy=function(n){var o=y(this.connecting,n);~o&&this.connecting.splice(o,1),!this.connecting.length&&this.close()},e.prototype.packet=function(n){r("writing packet %j",n);var o=this;o.encoding?o.packetBuffer.push(n):(o.encoding=!0,this.encoder.encode(n,function(s){for(var m=0;m<s.length;m++)o.engine.write(s[m],n.options);o.encoding=!1,o.processPacketQueue()}))},e.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var n=this.packetBuffer.shift();this.packet(n)}},e.prototype.cleanup=function(){r("cleanup");for(var n;n=this.subs.shift();)n.destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},e.prototype.close=e.prototype.disconnect=function(){r("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,this.readyState=="opening"&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},e.prototype.onclose=function(n){r("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",n),this._reconnection&&!this.skipReconnect&&this.reconnect()},e.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var n=this;if(this.backoff.attempts>=this._reconnectionAttempts)r("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var o=this.backoff.duration();r("will wait %dms before reconnect attempt",o),this.reconnecting=!0;var s=setTimeout(function(){n.skipReconnect||(r("attempting reconnect"),n.emitAll("reconnect_attempt",n.backoff.attempts),n.emitAll("reconnecting",n.backoff.attempts),!n.skipReconnect&&n.open(function(m){m?(r("reconnect attempt error"),n.reconnecting=!1,n.reconnect(),n.emitAll("reconnect_error",m.data)):(r("reconnect success"),n.onreconnect())}))},o);this.subs.push({destroy:function(){clearTimeout(s)}})}},e.prototype.onreconnect=function(){var n=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",n)}},{"./on":33,"./socket":34,backo2:36,"component-bind":37,"component-emitter":38,debug:39,"engine.io-client":1,indexof:42,"socket.io-parser":47}],33:[function(d,v,l){v.exports=i;function i(h,c,u){return h.on(c,u),{destroy:function(){h.removeListener(c,u)}}}},{}],34:[function(d,v,l){var i=d("socket.io-parser"),h=d("component-emitter"),c=d("to-array"),u=d("./on"),a=d("component-bind"),t=d("debug")("socket.io-client:socket"),r=d("has-binary");v.exports=l=p;var y={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},f=h.prototype.emit;function p(e,n){this.io=e,this.nsp=n,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.io.autoConnect&&this.open()}h(p.prototype),p.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[u(e,"open",a(this,"onopen")),u(e,"packet",a(this,"onpacket")),u(e,"close",a(this,"onclose"))]}},p.prototype.open=p.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),this.io.readyState=="open"&&this.onopen(),this.emit("connecting"),this)},p.prototype.send=function(){var e=c(arguments);return e.unshift("message"),this.emit.apply(this,e),this},p.prototype.emit=function(e){if(y.hasOwnProperty(e))return f.apply(this,arguments),this;var n=c(arguments),o=i.EVENT;r(n)&&(o=i.BINARY_EVENT);var s={type:o,data:n};return s.options={},s.options.compress=!this.flags||this.flags.compress!==!1,typeof n[n.length-1]=="function"&&(t("emitting packet with ack id %d",this.ids),this.acks[this.ids]=n.pop(),s.id=this.ids++),this.connected?this.packet(s):this.sendBuffer.push(s),delete this.flags,this},p.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},p.prototype.onopen=function(){t("transport is open - connecting"),this.nsp!="/"&&this.packet({type:i.CONNECT})},p.prototype.onclose=function(e){t("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},p.prototype.onpacket=function(e){if(e.nsp==this.nsp)switch(e.type){case i.CONNECT:this.onconnect();break;case i.EVENT:this.onevent(e);break;case i.BINARY_EVENT:this.onevent(e);break;case i.ACK:this.onack(e);break;case i.BINARY_ACK:this.onack(e);break;case i.DISCONNECT:this.ondisconnect();break;case i.ERROR:this.emit("error",e.data);break}},p.prototype.onevent=function(e){var n=e.data||[];t("emitting event %j",n),e.id!=null&&(t("attaching ack callback to event"),n.push(this.ack(e.id))),this.connected?f.apply(this,n):this.receiveBuffer.push(n)},p.prototype.ack=function(e){var n=this,o=!1;return function(){if(!o){o=!0;var s=c(arguments);t("sending ack %j",s);var m=r(s)?i.BINARY_ACK:i.ACK;n.packet({type:m,id:e,data:s})}}},p.prototype.onack=function(e){var n=this.acks[e.id];typeof n=="function"?(t("calling ack %s with %j",e.id,e.data),n.apply(this,e.data),delete this.acks[e.id]):t("bad ack %s",e.id)},p.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},p.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)f.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},p.prototype.ondisconnect=function(){t("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},p.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},p.prototype.close=p.prototype.disconnect=function(){return this.connected&&(t("performing disconnect (%s)",this.nsp),this.packet({type:i.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},p.prototype.compress=function(e){return this.flags=this.flags||{},this.flags.compress=e,this}},{"./on":33,"component-bind":37,"component-emitter":38,debug:39,"has-binary":41,"socket.io-parser":47,"to-array":51}],35:[function(d,v,l){(function(i){var h=d("parseuri"),c=d("debug")("socket.io-client:url");v.exports=u;function u(a,t){var r=a,t=t||i.location;a==null&&(a=t.protocol+"//"+t.host),typeof a=="string"&&(a.charAt(0)=="/"&&(a.charAt(1)=="/"?a=t.protocol+a:a=t.host+a),/^(https?|wss?):\/\//.test(a)||(c("protocol-less url %s",a),typeof t!="undefined"?a=t.protocol+"//"+a:a="https://"+a),c("parse %s",a),r=h(a)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var y=r.host.indexOf(":")!==-1,f=y?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+f+":"+r.port,r.href=r.protocol+"://"+f+(t&&t.port==r.port?"":":"+r.port),r}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{debug:39,parseuri:45}],36:[function(d,v,l){v.exports=i;function i(h){h=h||{},this.ms=h.min||100,this.max=h.max||1e4,this.factor=h.factor||2,this.jitter=h.jitter>0&&h.jitter<=1?h.jitter:0,this.attempts=0}i.prototype.duration=function(){var h=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var c=Math.random(),u=Math.floor(c*this.jitter*h);h=(Math.floor(c*10)&1)==0?h-u:h+u}return Math.min(h,this.max)|0},i.prototype.reset=function(){this.attempts=0},i.prototype.setMin=function(h){this.ms=h},i.prototype.setMax=function(h){this.max=h},i.prototype.setJitter=function(h){this.jitter=h}},{}],37:[function(d,v,l){var i=[].slice;v.exports=function(h,c){if(typeof c=="string"&&(c=h[c]),typeof c!="function")throw new Error("bind() requires a function");var u=i.call(arguments,2);return function(){return c.apply(h,u.concat(i.call(arguments)))}}},{}],38:[function(d,v,l){v.exports=i;function i(c){if(c)return h(c)}function h(c){for(var u in i.prototype)c[u]=i.prototype[u];return c}i.prototype.on=i.prototype.addEventListener=function(c,u){return this._callbacks=this._callbacks||{},(this._callbacks["$"+c]=this._callbacks["$"+c]||[]).push(u),this},i.prototype.once=function(c,u){function a(){this.off(c,a),u.apply(this,arguments)}return a.fn=u,this.on(c,a),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(c,u){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var a=this._callbacks["$"+c];if(!a)return this;if(arguments.length==1)return delete this._callbacks["$"+c],this;for(var t,r=0;r<a.length;r++)if(t=a[r],t===u||t.fn===u){a.splice(r,1);break}return this},i.prototype.emit=function(c){this._callbacks=this._callbacks||{};var u=[].slice.call(arguments,1),a=this._callbacks["$"+c];if(a){a=a.slice(0);for(var t=0,r=a.length;t<r;++t)a[t].apply(this,u)}return this},i.prototype.listeners=function(c){return this._callbacks=this._callbacks||{},this._callbacks["$"+c]||[]},i.prototype.hasListeners=function(c){return!!this.listeners(c).length}},{}],39:[function(d,v,l){arguments[4][17][0].apply(l,arguments)},{"./debug":40,dup:17}],40:[function(d,v,l){arguments[4][18][0].apply(l,arguments)},{dup:18,ms:44}],41:[function(d,v,l){(function(i){var h=d("isarray");v.exports=c;function c(u){function a(t){if(!t)return!1;if(i.Buffer&&i.Buffer.isBuffer&&i.Buffer.isBuffer(t)||i.ArrayBuffer&&t instanceof ArrayBuffer||i.Blob&&t instanceof Blob||i.File&&t instanceof File)return!0;if(h(t)){for(var r=0;r<t.length;r++)if(a(t[r]))return!0}else if(t&&typeof t=="object"){t.toJSON&&typeof t.toJSON=="function"&&(t=t.toJSON());for(var y in t)if(Object.prototype.hasOwnProperty.call(t,y)&&a(t[y]))return!0}return!1}return a(u)}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{isarray:43}],42:[function(d,v,l){arguments[4][23][0].apply(l,arguments)},{dup:23}],43:[function(d,v,l){arguments[4][24][0].apply(l,arguments)},{dup:24}],44:[function(d,v,l){arguments[4][25][0].apply(l,arguments)},{dup:25}],45:[function(d,v,l){arguments[4][28][0].apply(l,arguments)},{dup:28}],46:[function(d,v,l){(function(i){var h=d("isarray"),c=d("./is-buffer");l.deconstructPacket=function(u){var a=[],t=u.data;function r(f){if(!f)return f;if(c(f)){var p={_placeholder:!0,num:a.length};return a.push(f),p}else if(h(f)){for(var e=new Array(f.length),n=0;n<f.length;n++)e[n]=r(f[n]);return e}else if(typeof f=="object"&&!(f instanceof Date)){var e={};for(var o in f)e[o]=r(f[o]);return e}return f}var y=u;return y.data=r(t),y.attachments=a.length,{packet:y,buffers:a}},l.reconstructPacket=function(u,a){var t=0;function r(y){if(y&&y._placeholder){var f=a[y.num];return f}else if(h(y)){for(var p=0;p<y.length;p++)y[p]=r(y[p]);return y}else if(y&&typeof y=="object"){for(var e in y)y[e]=r(y[e]);return y}return y}return u.data=r(u.data),u.attachments=void 0,u},l.removeBlobs=function(u,a){function t(f,p,e){if(!f)return f;if(i.Blob&&f instanceof Blob||i.File&&f instanceof File){r++;var n=new FileReader;n.onload=function(){e?e[p]=this.result:y=this.result,--r||a(y)},n.readAsArrayBuffer(f)}else if(h(f))for(var o=0;o<f.length;o++)t(f[o],o,f);else if(f&&typeof f=="object"&&!c(f))for(var s in f)t(f[s],s,f)}var r=0,y=u;t(y),r||a(y)}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{"./is-buffer":48,isarray:43}],47:[function(d,v,l){var i=d("debug")("socket.io-parser"),h=d("json3"),c=d("isarray"),u=d("component-emitter"),a=d("./binary"),t=d("./is-buffer");l.protocol=4,l.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],l.CONNECT=0,l.DISCONNECT=1,l.EVENT=2,l.ACK=3,l.ERROR=4,l.BINARY_EVENT=5,l.BINARY_ACK=6,l.Encoder=r,l.Decoder=p;function r(){}r.prototype.encode=function(s,m){if(i("encoding packet %j",s),l.BINARY_EVENT==s.type||l.BINARY_ACK==s.type)f(s,m);else{var b=y(s);m([b])}};function y(s){var m="",b=!1;return m+=s.type,(l.BINARY_EVENT==s.type||l.BINARY_ACK==s.type)&&(m+=s.attachments,m+="-"),s.nsp&&s.nsp!="/"&&(b=!0,m+=s.nsp),s.id!=null&&(b&&(m+=",",b=!1),m+=s.id),s.data!=null&&(b&&(m+=","),m+=h.stringify(s.data)),i("encoded %j as %s",s,m),m}function f(s,m){function b(w){var A=a.deconstructPacket(w),R=y(A.packet),T=A.buffers;T.unshift(R),m(T)}a.removeBlobs(s,b)}function p(){this.reconstructor=null}u(p.prototype),p.prototype.add=function(s){var m;if(typeof s=="string")m=e(s),l.BINARY_EVENT==m.type||l.BINARY_ACK==m.type?(this.reconstructor=new n(m),this.reconstructor.reconPack.attachments===0&&this.emit("decoded",m)):this.emit("decoded",m);else if(t(s)||s.base64)if(this.reconstructor)m=this.reconstructor.takeBinaryData(s),m&&(this.reconstructor=null,this.emit("decoded",m));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+s)};function e(s){var m={},b=0;if(m.type=Number(s.charAt(0)),l.types[m.type]==null)return o();if(l.BINARY_EVENT==m.type||l.BINARY_ACK==m.type){for(var w="";s.charAt(++b)!="-"&&(w+=s.charAt(b),b!=s.length););if(w!=Number(w)||s.charAt(b)!="-")throw new Error("Illegal attachments");m.attachments=Number(w)}if(s.charAt(b+1)=="/")for(m.nsp="";++b;){var A=s.charAt(b);if(A==","||(m.nsp+=A,b==s.length))break}else m.nsp="/";var R=s.charAt(b+1);if(R!==""&&Number(R)==R){for(m.id="";++b;){var A=s.charAt(b);if(A==null||Number(A)!=A){--b;break}if(m.id+=s.charAt(b),b==s.length)break}m.id=Number(m.id)}if(s.charAt(++b))try{m.data=h.parse(s.substr(b))}catch(T){return o()}return i("decoded %s as %j",s,m),m}p.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};function n(s){this.reconPack=s,this.buffers=[]}n.prototype.takeBinaryData=function(s){if(this.buffers.push(s),this.buffers.length==this.reconPack.attachments){var m=a.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),m}return null},n.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]};function o(s){return{type:l.ERROR,data:"parser error"}}},{"./binary":46,"./is-buffer":48,"component-emitter":49,debug:39,isarray:43,json3:50}],48:[function(d,v,l){(function(i){v.exports=h;function h(c){return i.Buffer&&i.Buffer.isBuffer(c)||i.ArrayBuffer&&c instanceof ArrayBuffer}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{}],49:[function(d,v,l){arguments[4][15][0].apply(l,arguments)},{dup:15}],50:[function(d,v,l){(function(i){/*! JSON v3.3.2 | http://bestiejs.github.io/json3 | Copyright 2012-2014, Kit Cambridge | http://kit.mit-license.org */(function(){var h=typeof g=="function"&&g.amd,c={function:!0,object:!0},u=c[typeof l]&&l&&!l.nodeType&&l,a=c[typeof window]&&window||this,t=u&&c[typeof v]&&v&&!v.nodeType&&typeof i=="object"&&i;t&&(t.global===t||t.window===t||t.self===t)&&(a=t);function r(n,o){n||(n=a.Object()),o||(o=a.Object());var s=n.Number||a.Number,m=n.String||a.String,b=n.Object||a.Object,w=n.Date||a.Date,A=n.SyntaxError||a.SyntaxError,R=n.TypeError||a.TypeError,T=n.Math||a.Math,L=n.JSON||a.JSON;typeof L=="object"&&L&&(o.stringify=L.stringify,o.parse=L.parse);var P=b.prototype,_=P.toString,C,D,I,x=new w(-3509827334573292);try{x=x.getUTCFullYear()==-109252&&x.getUTCMonth()===0&&x.getUTCDate()===1&&x.getUTCHours()==10&&x.getUTCMinutes()==37&&x.getUTCSeconds()==6&&x.getUTCMilliseconds()==708}catch(U){}function W(U){if(W[U]!==I)return W[U];var Y;if(U=="bug-string-char-index")Y="a"[0]!="a";else if(U=="json")Y=W("json-stringify")&&W("json-parse");else{var $,K='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(U=="json-stringify"){var F=o.stringify,oe=typeof F=="function"&&x;if(oe){($=function(){return 1}).toJSON=$;try{oe=F(0)==="0"&&F(new s)==="0"&&F(new m)=='""'&&F(_)===I&&F(I)===I&&F()===I&&F($)==="1"&&F([$])=="[1]"&&F([I])=="[null]"&&F(null)=="null"&&F([I,_,null])=="[null,null,null]"&&F({a:[$,!0,!1,null,`\0\b
\f\r	`]})==K&&F(null,$)==="1"&&F([1,2],null,1)==`[
 1,
 2
]`&&F(new w(-864e13))=='"-271821-04-20T00:00:00.000Z"'&&F(new w(864e13))=='"+275760-09-13T00:00:00.000Z"'&&F(new w(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&F(new w(-1))=='"1969-12-31T23:59:59.999Z"'}catch(de){oe=!1}}Y=oe}if(U=="json-parse"){var H=o.parse;if(typeof H=="function")try{if(H("0")===0&&!H(!1)){$=H(K);var X=$.a.length==5&&$.a[0]===1;if(X){try{X=!H('"	"')}catch(de){}if(X)try{X=H("01")!==1}catch(de){}if(X)try{X=H("1.")!==1}catch(de){}}}}catch(de){X=!1}Y=X}}return W[U]=!!Y}if(!W("json")){var J="[object Function]",se="[object Date]",ne="[object Number]",ce="[object String]",le="[object Array]",Te="[object Boolean]",Se=W("bug-string-char-index");if(!x)var he=T.floor,we=[0,31,59,90,120,151,181,212,243,273,304,334],_e=function(U,Y){return we[Y]+365*(U-1970)+he((U-1969+(Y=+(Y>1)))/4)-he((U-1901+Y)/100)+he((U-1601+Y)/400)};if((C=P.hasOwnProperty)||(C=function(U){var Y={},$;return(Y.__proto__=null,Y.__proto__={toString:1},Y).toString!=_?C=function(K){var F=this.__proto__,oe=K in(this.__proto__=null,this);return this.__proto__=F,oe}:($=Y.constructor,C=function(K){var F=(this.constructor||$).prototype;return K in this&&!(K in F&&this[K]===F[K])}),Y=null,C.call(this,U)}),D=function(U,Y){var $=0,K,F,oe;(K=function(){this.valueOf=0}).prototype.valueOf=0,F=new K;for(oe in F)C.call(F,oe)&&$++;return K=F=null,$?$==2?D=function(H,X){var de={},ee=_.call(H)==J,ge;for(ge in H)!(ee&&ge=="prototype")&&!C.call(de,ge)&&(de[ge]=1)&&C.call(H,ge)&&X(ge)}:D=function(H,X){var de=_.call(H)==J,ee,ge;for(ee in H)!(de&&ee=="prototype")&&C.call(H,ee)&&!(ge=ee==="constructor")&&X(ee);(ge||C.call(H,ee="constructor"))&&X(ee)}:(F=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],D=function(H,X){var de=_.call(H)==J,ee,ge,be=!de&&typeof H.constructor!="function"&&c[typeof H.hasOwnProperty]&&H.hasOwnProperty||C;for(ee in H)!(de&&ee=="prototype")&&be.call(H,ee)&&X(ee);for(ge=F.length;ee=F[--ge];be.call(H,ee)&&X(ee));}),D(U,Y)},!W("json-stringify")){var Ne={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},Pe="000000",fe=function(U,Y){return(Pe+(Y||0)).slice(-U)},Le="\\u00",pe=function(U){for(var Y='"',$=0,K=U.length,F=!Se||K>10,oe=F&&(Se?U.split(""):U);$<K;$++){var H=U.charCodeAt($);switch(H){case 8:case 9:case 10:case 12:case 13:case 34:case 92:Y+=Ne[H];break;default:if(H<32){Y+=Le+fe(2,H.toString(16));break}Y+=F?oe[$]:U.charAt($)}}return Y+'"'},N=function(U,Y,$,K,F,oe,H){var X,de,ee,ge,be,Oe,Me,Fe,ye,Ie,Ce,$e,xe,ke,We,He;try{X=Y[U]}catch(qe){}if(typeof X=="object"&&X)if(de=_.call(X),de==se&&!C.call(X,"toJSON"))if(X>-1/0&&X<1/0){if(_e){for(be=he(X/864e5),ee=he(be/365.2425)+1970-1;_e(ee+1,0)<=be;ee++);for(ge=he((be-_e(ee,0))/30.42);_e(ee,ge+1)<=be;ge++);be=1+be-_e(ee,ge),Oe=(X%864e5+864e5)%864e5,Me=he(Oe/36e5)%24,Fe=he(Oe/6e4)%60,ye=he(Oe/1e3)%60,Ie=Oe%1e3}else ee=X.getUTCFullYear(),ge=X.getUTCMonth(),be=X.getUTCDate(),Me=X.getUTCHours(),Fe=X.getUTCMinutes(),ye=X.getUTCSeconds(),Ie=X.getUTCMilliseconds();X=(ee<=0||ee>=1e4?(ee<0?"-":"+")+fe(6,ee<0?-ee:ee):fe(4,ee))+"-"+fe(2,ge+1)+"-"+fe(2,be)+"T"+fe(2,Me)+":"+fe(2,Fe)+":"+fe(2,ye)+"."+fe(3,Ie)+"Z"}else X=null;else typeof X.toJSON=="function"&&(de!=ne&&de!=ce&&de!=le||C.call(X,"toJSON"))&&(X=X.toJSON(U));if($&&(X=$.call(Y,U,X)),X===null)return"null";if(de=_.call(X),de==Te)return""+X;if(de==ne)return X>-1/0&&X<1/0?""+X:"null";if(de==ce)return pe(""+X);if(typeof X=="object"){for(ke=H.length;ke--;)if(H[ke]===X)throw R();if(H.push(X),Ce=[],We=oe,oe+=F,de==le){for(xe=0,ke=X.length;xe<ke;xe++)$e=N(xe,X,$,K,F,oe,H),Ce.push($e===I?"null":$e);He=Ce.length?F?`[
`+oe+Ce.join(`,
`+oe)+`
`+We+"]":"["+Ce.join(",")+"]":"[]"}else D(K||X,function(qe){var Xe=N(qe,X,$,K,F,oe,H);Xe!==I&&Ce.push(pe(qe)+":"+(F?" ":"")+Xe)}),He=Ce.length?F?`{
`+oe+Ce.join(`,
`+oe)+`
`+We+"}":"{"+Ce.join(",")+"}":"{}";return H.pop(),He}};o.stringify=function(U,Y,$){var K,F,oe,H;if(c[typeof Y]&&Y){if((H=_.call(Y))==J)F=Y;else if(H==le){oe={};for(var X=0,de=Y.length,ee;X<de;ee=Y[X++],H=_.call(ee),(H==ce||H==ne)&&(oe[ee]=1));}}if($)if((H=_.call($))==ne){if(($-=$%1)>0)for(K="",$>10&&($=10);K.length<$;K+=" ");}else H==ce&&(K=$.length<=10?$:$.slice(0,10));return N("",(ee={},ee[""]=U,ee),F,oe,K,"",[])}}if(!W("json-parse")){var B=m.fromCharCode,j={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:`
`,102:"\f",114:"\r"},M,ie,te=function(){throw M=ie=null,A()},ue=function(){for(var U=ie,Y=U.length,$,K,F,oe,H;M<Y;)switch(H=U.charCodeAt(M),H){case 9:case 10:case 13:case 32:M++;break;case 123:case 125:case 91:case 93:case 58:case 44:return $=Se?U.charAt(M):U[M],M++,$;case 34:for($="@",M++;M<Y;)if(H=U.charCodeAt(M),H<32)te();else if(H==92)switch(H=U.charCodeAt(++M),H){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:$+=j[H],M++;break;case 117:for(K=++M,F=M+4;M<F;M++)H=U.charCodeAt(M),H>=48&&H<=57||H>=97&&H<=102||H>=65&&H<=70||te();$+=B("0x"+U.slice(K,M));break;default:te()}else{if(H==34)break;for(H=U.charCodeAt(M),K=M;H>=32&&H!=92&&H!=34;)H=U.charCodeAt(++M);$+=U.slice(K,M)}if(U.charCodeAt(M)==34)return M++,$;te();default:if(K=M,H==45&&(oe=!0,H=U.charCodeAt(++M)),H>=48&&H<=57){for(H==48&&(H=U.charCodeAt(M+1),H>=48&&H<=57)&&te(),oe=!1;M<Y&&(H=U.charCodeAt(M),H>=48&&H<=57);M++);if(U.charCodeAt(M)==46){for(F=++M;F<Y&&(H=U.charCodeAt(F),H>=48&&H<=57);F++);F==M&&te(),M=F}if(H=U.charCodeAt(M),H==101||H==69){for(H=U.charCodeAt(++M),(H==43||H==45)&&M++,F=M;F<Y&&(H=U.charCodeAt(F),H>=48&&H<=57);F++);F==M&&te(),M=F}return+U.slice(K,M)}if(oe&&te(),U.slice(M,M+4)=="true")return M+=4,!0;if(U.slice(M,M+5)=="false")return M+=5,!1;if(U.slice(M,M+4)=="null")return M+=4,null;te()}return"$"},me=function(U){var Y,$;if(U=="$"&&te(),typeof U=="string"){if((Se?U.charAt(0):U[0])=="@")return U.slice(1);if(U=="["){for(Y=[];U=ue(),U!="]";$||($=!0))$&&(U==","?(U=ue(),U=="]"&&te()):te()),U==","&&te(),Y.push(me(U));return Y}else if(U=="{"){for(Y={};U=ue(),U!="}";$||($=!0))$&&(U==","?(U=ue(),U=="}"&&te()):te()),(U==","||typeof U!="string"||(Se?U.charAt(0):U[0])!="@"||ue()!=":")&&te(),Y[U.slice(1)]=me(ue());return Y}te()}return U},Ee=function(U,Y,$){var K=Ae(U,Y,$);K===I?delete U[Y]:U[Y]=K},Ae=function(U,Y,$){var K=U[Y],F;if(typeof K=="object"&&K)if(_.call(K)==le)for(F=K.length;F--;)Ee(K,F,$);else D(K,function(oe){Ee(K,oe,$)});return $.call(U,Y,K)};o.parse=function(U,Y){var $,K;return M=0,ie=""+U,$=me(ue()),ue()!="$"&&te(),M=ie=null,Y&&_.call(Y)==J?Ae((K={},K[""]=$,K),"",Y):$}}}return o.runInContext=r,o}if(u&&!h)r(a,u);else{var y=a.JSON,f=a.JSON3,p=!1,e=r(a,a.JSON3={noConflict:function(){return p||(p=!0,a.JSON=y,a.JSON3=f,y=f=null),e}});a.JSON={parse:e.parse,stringify:e.stringify}}h&&g(function(){return e})}).call(this)}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{})},{}],51:[function(d,v,l){v.exports=i;function i(h,c){var u=[];c=c||0;for(var a=c||0;a<h.length;a++)u[a-c]=h[a];return u}},{}]},{},[31])(31)});const Logging=(()=>{const g="/api/ui-event",S="/api/ui-error/user",E="/api/ui-error/js",d="/api/ui-error/promise",v="/api/browse-request",l="/api/stats-browsing",i=m=>Object.entries(m).map(b=>b.map(encodeURIComponent).join("=")).join("&"),h=m=>m.split("").reduce((b,w)=>(b=(b<<5)-b+w.charCodeAt(0),b|=0,b),0),c=new Set;let u=new Date().getTime();const a={},t=()=>({diagnostics:JSON.stringify({time:new Date().getTime()-u,...a})}),r=async(m,b,{keepAlive:w=!1,includeDiagnostics:A=!1,uniqueOnly:R=!0}={})=>{const T=i(b),L=h(m+T);if(c.has(L)&&R)return;c.add(L);const P=i({...b,...A?t():{}});return fetch(m,{keepalive:w,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":P.length},mode:"cors",cache:"no-cache",credentials:"include",body:P}).catch(()=>{})},y=m=>u=m,f=(m,b)=>{typeof a[m]=="undefined"&&(a[m]=b)},p=async m=>r(g,{event:m},{keepAlive:!0,uniqueOnly:!1}),e=async(m,b)=>r(S,{type:m,data:JSON.stringify(b)},{includeDiagnostics:!0}),n=async(m,b,w,A)=>r(v,{page_type:"new",browse_type:A,platform_name:m.name,platform_version:m.version,browser:b.name,version:b.version,url:w},{uniqueOnly:!1}),o=async m=>r(l,{type:m},{uniqueOnly:!1}),s=m=>typeof m.stack!="undefined"&&typeof m.message!="undefined"?{errorText:m.message,errorDetail:m.stack}:{errorText:m.toString(),errorDetail:JSON.stringify(m)};return window.addEventListener("error",({message:m,filename:b,lineno:w,colno:A,error:R})=>{m==="Script error."||!R||r(E,{url:window.location.href,message:m,filename:b,lineno:w,colno:A,...s(R)},{includeDiagnostics:!0})}),window.addEventListener("unhandledrejection",({reason:m})=>{!m||r(d,{url:window.location.href,type:"unhandled",...s(m)},{includeDiagnostics:!0})}),window.addEventListener("rejectionhandled",({reason:m})=>{!m||r(d,{url:window.location.href,type:"handled",...s(m)},{includeDiagnostics:!0})}),{uiEvent:p,userError:e,timeStart:y,diagnosticData:f,browseRequest:n,browseStats:o}})();function MovableElement({mainElement:g,bounceInsets:S=this.insetAllBy(0)}){if(!(this instanceof MovableElement))return new MovableElement(...arguments);this.onMoveStart=()=>{},this.onMoveEnd=()=>{},this.isDraggable=()=>!0,this.isResizable=()=>!1,this.isDragSurface=N=>!N.some(B=>B.classList.contains("prevents-move"));const{NONE:E,DRAGGING:d,RESIZING:v}=MovableElement.MoveType;this.offsetX=0,this.offsetY=0,this.moveType=E,this.currentWidth=null,this.currentHeight=null,this.mainElement=g;let l=0,i=0,h=0,c=0,u=0;(()=>{MovableElement.ALL_MOVABLES.push(this);const N=MovableElement.ALL_MOVABLES.length;this.mainElement.style.zIndex=100+N})();const t=()=>{const N=getComputedStyle(this.mainElement);c=parseInt(N.minWidth.slice(0,-2)),u=parseInt(N.minHeight.slice(0,-2))};this.getLastMoveDistance=()=>Math.max(Math.abs(l),Math.abs(i)),this.getLastMoveDuration=()=>new Date().getTime()-h;const r=()=>this.mainElement.getBoundingClientRect(),y=()=>this.mainElement.parentElement?this.mainElement.parentElement.getBoundingClientRect():null,f=()=>{const N=r();this.currentWidth=N.width,this.currentHeight=N.height},p=()=>{if(MovableElement.ALL_MOVABLES.length==1)return;const N=MovableElement.ALL_MOVABLES.length,B=MovableElement.ALL_MOVABLES.indexOf(this);if(B==N-1)return;const j=this;j.mainElement.style.zIndex=100+N;for(let M=B+1;M<MovableElement.ALL_MOVABLES.length;M++)MovableElement.ALL_MOVABLES[M].mainElement.style.zIndex=100+M;MovableElement.ALL_MOVABLES.splice(B,1),MovableElement.ALL_MOVABLES.push(j)};this.bringToTop=()=>p();const e=()=>{const N=r();this.offsetX=N.left,this.offsetY=N.top};this.topY=N=>{const j=y().y+N;this.setPosition(this.offsetX,j)},this.bottomY=N=>{const B=r(),j=y(),M=j.y+j.height-B.height-N;this.setPosition(this.offsetX,M)},this.leftX=N=>{const j=y().x+N;this.setPosition(j,this.offsetY)},this.rightX=N=>{const B=r(),j=y(),M=j.x+j.width-B.width-N;this.setPosition(M,this.offsetY)},this.centerY=()=>{const N=r(),B=y(),j=B.y+(B.height-N.height)/2;return this.setPosition(this.offsetX,j),j},this.centerX=()=>{const N=r(),B=y(),j=B.x+(B.width-N.width)/2;return this.setPosition(j,this.offsetY),j},this.moveBy=(N,B)=>{l+=N,i+=B;const j=this.offsetX,M=this.offsetY;return this.setPosition(this.offsetX+N,this.offsetY+B),[this.offsetX-j,this.offsetY-M]},this.resizeBy=(N,B)=>{const j=this.currentWidth,M=this.currentHeight;return this.setSize(this.currentWidth+N,this.currentHeight+B),[this.currentWidth-j,this.currentHeight-M]},this.setSizeAndPosition=(N,B,j,M)=>{const ie=j-this.offsetX,te=M-this.offsetY,[ue,me]=this.setSize(N,B);let[Ee,Ae]=[j,M];if(ue>N){const U=ue-N;ie>0&&(Ee=j-U)}if(me>B){const U=me-B;te>0&&(Ae=M-U)}this.setPosition(Ee,Ae)},this.setWidth=N=>this.setSize(N,this.currentHeight),this.setHeight=N=>this.setSize(this.currentWidth,N),this.setSize=(N,B)=>(N<c&&(N=c),B<u&&(B=u),this.currentWidth=N,this.currentHeight=B,this.mainElement.style.width=`${Math.round(N)}px`,this.mainElement.style.height=`${Math.round(B)}px`,[this.currentWidth,this.currentHeight]),this.setX=N=>this.setPosition(N,this.offsetY),this.setY=N=>this.setPosition(this.offsetX,N),this.setPosition=(N,B)=>{const j=this.offsetX,M=this.offsetY;this.offsetX=N,this.offsetY=B;const ie=j-this.offsetX,te=M-this.offsetY;return l+=ie,i+=te,this.mainElement.style.left=`${Math.round(N)}px`,this.mainElement.style.top=`${Math.round(B)}px`,[this.offsetX,this.offsetY]};const n=N=>this.mainElement.style.cursor=N,o=()=>{const N=r(),B=y();let j=0,M=0;const{top:ie,left:te,right:ue,bottom:me}=S(N,B),Ee=N.x+N.width,Ae=B.x+B.width+(N.width-ue),U=N.x,Y=B.x-(N.width-te);Ee>=Ae?j-=Ee-Ae:U<=Y&&(j+=Y-U);const $=N.y+N.height,K=B.y+B.height+(N.height-me),F=N.y,oe=B.y-(N.height-ie);$>=K?M-=$-K:F<=oe&&(M+=oe-F),this.moveBy(j,M)};let s=null;const m=({clientX:N,clientY:B})=>{MovableElement.ACTIVE_MOVABLES.add(this),p(),e(),we({clientX:N,clientY:B}),l=0,i=0,this.moveType=d,this.onMoveStart(),n("grabbing")};let b=null;const w=({clientX:N,clientY:B},j)=>{MovableElement.ACTIVE_MOVABLES.add(this),p(),f(),e(),we({clientX:N,clientY:B}),t(),this.moveType=v,b=j},A=()=>{MovableElement.ACTIVE_MOVABLES.delete(this),this.moveType=E,b=null,s=null},R=()=>{MovableElement.ACTIVE_MOVABLES.delete(this),h=new Date().getTime(),this.moveType=E,s=null,this.onMoveEnd(),n("")},{N:T,W:L,S:P,E:_,NW:C,NE:D,SW:I,SE:x,OUTSIDE:W,INSIDE:J}=MovableElement.ResizeDirection,se=({clientX:N,clientY:B},{trackInOut:j=!1,extendOut:M=0,extendIn:ie=4}={})=>{const{top:te,left:ue,bottom:me,right:Ee}=r(),Ae=N>=ue-M&&N<=Ee+M,U=B>=te-M&&B<=me+M;if(!Ae||!U)return j?W:null;const Y=B>=te-M&&B<=te+ie,$=N>=ue-M&&N<=ue+ie,K=N>=Ee-ie&&N<=Ee+M,F=B>=me-ie&&B<=me+M;return Y&&$?C:Y&&K?D:F&&$?I:F&&K?x:Y?T:$?L:K?_:F?P:j?J:null};let ne,ce,le,Te,Se,he;const we=({clientX:N,clientY:B})=>{ne=this.currentWidth,ce=this.currentHeight,le=this.offsetX,Te=this.offsetY,Se=N,he=B},_e=({clientX:N,clientY:B})=>{const[j,M]=[le,Te],ie=Se-N,te=he-B;n("grabbing"),this.setPosition(j-ie,M-te)},Ne=N=>{switch(N){case C:case x:n("nwse-resize");break;case D:case I:n("nesw-resize");break;case T:case P:n("ns-resize");break;case _:case L:n("ew-resize");break;default:n("");break}},Pe=({clientX:N,clientY:B})=>{const[j,M]=[le,Te],[ie,te]=[ne,ce],ue=Se-N,me=he-B;switch(b){case x:this.setSize(ie-ue,te-me);break;case _:this.setSize(ie-ue,te);break;case P:this.setSize(ie,te-me);break;case T:this.setSizeAndPosition(ie,te+me,j,M-me);break;case L:this.setSizeAndPosition(ie+ue,te,j-ue,M);break;case D:this.setSizeAndPosition(ie-ue,te+me,j,M-me);break;case C:this.setSizeAndPosition(ie+ue,te+me,j-ue,M-me);break;case I:this.setSizeAndPosition(ie+ue,te-me,j-ue,M);break}Ne(b)},fe=N=>{N.stopPropagation(),N.preventDefault()},Le=({target:N,clientX:B,clientY:j},{resizeArea:M=void 0}={})=>{if(this.isResizable()){const ie=se({clientX:B,clientY:j},{extendIn:M});if(ie!==null)return[v,{handle:ie}]}if(this.isDraggable()){const ie=this.getPathToMain(N);if(this.isDragSurface(ie))return[d]}return[E]};this.mainElement.addEventListener("mousedown",N=>{if(this.moveType===E&&N.buttons===1){const[B,j]=Le(N);B===v?(fe(N),w(N,j.handle)):B===d&&(fe(N),m(N))}},{capture:!0}),this.mainElement.addEventListener("touchstart",N=>{if(this.moveType===E)for(const B of N.targetTouches){const[j,M]=Le(B,{resizeArea:6});j===v?(s=B.identifier,N.stopPropagation(),w(B,M.handle)):j===d&&(s=B.identifier,N.stopPropagation(),m(B))}},{capture:!0,passive:!0}),this.mainElement.addEventListener("click",()=>p(),{capture:!0}),this.mainElement.addEventListener("mousemove",N=>{if(this.moveType===E&&this.isResizable()){const B=se(N);B!==null?Ne(B):n("")}}),this.addGlobalListener("mousemove",N=>{N.buttons===1&&(this.moveType===d?(fe(N),_e(N)):this.moveType===v&&(fe(N),Pe(N)))},{capture:!0});const pe=N=>{if(s===null)return null;for(const B of N)if(B.identifier===s)return B;return null};this.addGlobalListener("touchmove",N=>{const B=pe(N.touches);B!==null&&(this.moveType===d?(fe(N),_e(B)):this.moveType===v&&(fe(N),Pe(B)))},{capture:!0}),this.addGlobalListener("touchend",N=>{pe(N.changedTouches)!==null&&(this.moveType===d?(R(),o()):this.moveType===v&&A())}),this.addGlobalListener("mouseup",()=>{this.moveType===d?(R(),o()):this.moveType===v&&A()})}MovableElement.ALL_MOVABLES=[],MovableElement.OWN_LISTENERS=new Map,MovableElement.EVENT_HANDLERS=new Map,MovableElement.ACTIVE_MOVABLES=new Set,MovableElement.prototype.getHandlersFor=function(g){MovableElement.OWN_LISTENERS.has(this)||MovableElement.OWN_LISTENERS.set(this,new Map);const S=MovableElement.OWN_LISTENERS.get(this);return S.has(g)||S.set(g,[]),S.get(g)},MovableElement.handleDocumentEvent=function(g,S){for(const E of MovableElement.ACTIVE_MOVABLES)for(const d of E.getHandlersFor(g))d.call(null,S)},MovableElement.prototype.addGlobalListener=function(g,S,{passive:E=!1,capture:d=!1}={}){const v=g+(E?"_passive":"")+(d?"_capture":"");if(!MovableElement.EVENT_HANDLERS.has(v)){const l=i=>MovableElement.handleDocumentEvent(v,i);document.addEventListener(g,l,{passive:E,capture:d}),MovableElement.EVENT_HANDLERS.set(v,l)}this.getHandlersFor(v).push(S)},MovableElement.MoveType={NONE:Symbol("NONE"),DRAGGING:Symbol("DRAGGING"),RESIZING:Symbol("RESIZING")},MovableElement.ResizeDirection={N:Symbol("N"),W:Symbol("W"),E:Symbol("E"),S:Symbol("S"),NW:Symbol("NW"),NE:Symbol("NE"),SW:Symbol("SW"),SE:Symbol("SE"),OUTSIDE:Symbol("OUTSIDE"),INSIDE:Symbol("INSIDE")},MovableElement.prototype.insetAllBy=g=>()=>({top:g,left:g,right:g,bottom:g}),MovableElement.prototype.roundPxValue=(g,S=100)=>{const E=Math.round(window.devicePixelRatio*100)/100,d=Math.floor(g*10),v=l=>l===Math.floor(l);for(let l=0;l<S;l++){const i=(d+l)/10;if(v(i*E))return i}return g},MovableElement.prototype.getPathToMain=function(g){const S=[];let E=g;do{if(S.push(E),E===this.mainElement)return S;E=E.parentElement||E.parentNode}while(E!==null&&E.nodeType===1);return null};function Spinner({lineCount:g=12,lineLength:S=7,lineThickness:E=5,circleRadius:d=10,cornerRoundness:v=1,rotationsPerSecond:l=1,rotationOffset:i=0,spinDirection:h=Spinner.CLOCKWISE,cssLineColor:c="#ffffff",cssFadeColor:u="transparent",cssAnimationName:a="spinner-line-fade-quick",cssBoxShadow:t="0 0 1px transparent"}={}){if(!(this instanceof Spinner))return new Spinner(...arguments);const r=(n,o,s)=>{const m=s*Math.PI/180,b=Math.sin(m),w=Math.cos(m);return[Math.round((n*w+o*b)*1e3)/1e3,Math.round((-n*b+o*w)*1e3)/1e3]},y=(n,o)=>n.map(({x:s,y:m,...b})=>({xy:r(s,m,o),...b})).map(({prefix:s,xy:[m,b],sx:w,sy:A,end:R})=>`${s}${m}${w} ${b}${A}${R}`).join(", "),f=/^\s*([a-zA-Z]+\s+)?(-?\d+(\.\d+)?)([a-zA-Z]*)\s+(-?\d+(\.\d+)?)([a-zA-Z]*)(.*)$/,p=n=>n.split(",").map(o=>o.match(f)).filter(o=>o!=null).map(([,o,s,,m,b,,w,A])=>({prefix:o||"",x:parseInt(s),y:parseInt(b),sx:s===0&&!m?w:m,sy:b===0&&!w?m:w,end:A||""})),e=()=>{const n=Math.round(v*E*500)/1e3+"px",o=document.createDocumentFragment(),s=p(t);for(let m=0;m<g;m++){const b=~~(360/g*m+i),w=document.createElement("div");w.style.position="absolute",w.style.top=`${-E/2}px`,w.style.width=`${S+E}px`,w.style.height=`${E}px`,w.style.background=u,w.style.borderRadius=n,w.style.transformOrigin="left",w.style.transform=`rotate(${b}deg) translateX(${d}px)`;const A=h===Spinner.CLOCKWISE?1:-1,R=m*A/g/l-1/l,T=document.createElement("div");T.style.width="100%",T.style.height="100%",T.style.background=c,T.style.borderRadius=n,T.style.boxShadow=y(s,b),T.style.animation=`${1/l}s linear ${R}s infinite ${a}`,w.appendChild(T),o.appendChild(w)}return o};this.element=document.createElement("div"),this.element.classList.add("spinner"),this.element.setAttribute("role","progressbar"),this.element.appendChild(e()),this.element.style.width=0}Spinner.CLOCKWISE=Symbol("CLOCKWISE"),Spinner.COUNTER_CLOCKWISE=Symbol("COUNTER_CLOCKWISE");const UIUtils=(()=>{const g=r=>{const y=document.createElement("template");return y.innerHTML=r.trim(),y.content.firstChild},S=r=>r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),E=(r,y,f=()=>!1)=>{let p=y;do{if(f(p)||p===r)return!0;p=p.parentElement||p.parentNode}while(p!==null&&p.nodeType===1);return!1},d=(r,y,f)=>{r.addEventListener(y,p=>{E(r,p.target,e=>f(e,p))})},v=r=>y=>{const f=r.querySelector(y);if(!f)throw new Error(`Couldn't find element ${y} in ${r}`);return f},l=new WeakMap,i=r=>{if(l.has(r)){const y=l.get(r);r.disabled=!1,r.textContent=y,l.delete(r)}},h=(r,y)=>{l.has(r)||l.set(r,r.textContent),r.disabled=!0,r.textContent=y},c=r=>r.hasAttribute("data-is-expanded"),u=r=>r.setAttribute("data-is-expanded",!0),a=r=>r.removeAttribute("data-is-expanded");return{enableButton:i,disableButton:h,dropdownIsExpanded:c,dropdownExpand:u,dropdownCollapse:a,dropdownToggle:r=>c(r)?a(r):u(r),findByQueryInside:v,delegateListener:d,isWithinParent:E,escapeHtml:S,fromHtml:g}})();function PlatformList({platformData:g}){if(!(this instanceof PlatformList))return new PlatformList(...arguments);const{fromHtml:S,delegateListener:E}=UIUtils,d=new WeakMap,v=document.createDocumentFragment();for(const{group:l,items:i}of g){const h=S(`<div class="option-title">${l}</div>`);v.appendChild(h);for(const c of i){const u=S(`
            <div class="option-item">
                <svg class="select-icon"><use xlink:href="${c.icon}"></use></svg>
                <span class="select-name">${c.displayName}</span>
            </div>`);d.set(u,c.id),v.appendChild(u)}}this.onSelected=()=>{},this.element=document.createElement("div"),this.element.appendChild(v),E(this.element,"click",(l,i)=>{const h=d.get(l);return h?(this.onSelected(h),i.stopPropagation(),i.preventDefault(),!0):!1})}function BrowserList({browserData:g,initiallyVisible:S=10,expandBy:E=0}){if(!(this instanceof BrowserList))return new BrowserList(...arguments);const{fromHtml:d,delegateListener:v}=UIUtils,l=new WeakMap,i=new WeakMap;let h=null;this.setActiveVersion=t=>{for(const r of this.element.querySelectorAll(".option-version")){const y=l.get(r);r.removeAttribute("data-active"),y===t&&r.setAttribute("data-active",!0)}h=t};const c=t=>{for(const y of t.querySelectorAll(".option-version"))l.delete(y);const r=t.querySelector(".option-expand");r&&i.delete(r)},u=(t,r)=>{const y=d('<div class="option-versions"></div>'),f=document.createDocumentFragment(),p=t.length,e=Math.min(r,p);for(let n=0;n<e;n++){const o=t[n],s=d(`<div class="option-version">${o.version}</div>`);h!==null&&o===h&&s.setAttribute("data-active",!0),l.set(s,o),f.appendChild(s)}if(e<p){const n=p-e,o=d(`<div class="option-expand">... ${n} more</div>`);f.appendChild(o),i.set(o,{listToUpdate:y,itemsToExpand:t,howMuchWasShown:e})}return y.appendChild(f),y},a=document.createDocumentFragment();for(const{displayName:t,browserName:r,icon:y,items:f}of g){if(f.length==0)continue;const p=d(`<div class="option-browser" data-browser-name="${r}" data-total-items="${f.length}">
            <svg class="select-icon"><use xlink:href="${y}"></use></svg>
            <span class="select-name">${t}</span>
        </div>`),e=u(f,S);a.appendChild(p),a.appendChild(e)}this.onSelected=()=>{},this.element=document.createElement("div"),this.element.appendChild(a),v(this.element,"click",(t,r)=>{const y=l.get(t);if(y)return this.onSelected(y),r.stopPropagation(),r.preventDefault(),!0;const f=i.get(t);if(f){const{listToUpdate:p,howMuchWasShown:e,itemsToExpand:n}=f;c(p);const o=e+(E<=0?n.length:E),s=u(n,o);return p.parentElement.replaceChild(s,p),r.stopPropagation(),r.preventDefault(),!0}return!1})}function MainMenu({menuElement:g}){if(!(this instanceof MainMenu))return new MainMenu(...arguments);const{isWithinParent:S,findByQueryInside:E,dropdownIsExpanded:d,dropdownExpand:v,dropdownCollapse:l}=UIUtils,i=E(g);this.onPremiumUpgrade=()=>{};const h=i(".notice .notice-title");i(".notice .upgrade-to-premium").addEventListener("click",()=>this.onPremiumUpgrade()),this.updateTimer=(_,C)=>{h.textContent=`${_}:${C} remaining`};const u=new MovableElement({mainElement:g,bounceInsets:_=>({top:_.height+24,left:24,right:24,bottom:24})}),a=()=>{const _=u.getLastMoveDuration(),C=u.getLastMoveDistance();return _<=10&&C>5};u.setPosition(50,u.centerY());const t=i(".fields .browser .select-dropdown"),r=i(".fields .platform .select-dropdown");this.onBrowserListHidden=()=>!0,this.onPlatformListHidden=()=>!0,this.hideBrowserList=()=>{l(t),this.onBrowserListHidden()},this.toggleBrowserList=()=>d(t)?this.hideBrowserList():this.showBrowserList(),this.showBrowserList=()=>v(t),this.hidePlatformList=()=>{l(r),this.onPlatformListHidden()},this.togglePlatformList=()=>d(r)?this.hidePlatformList():this.showPlatformList(),this.showPlatformList=()=>v(r),t.addEventListener("click",_=>{this.toggleBrowserList(),this.hidePlatformList(),_.stopPropagation()}),r.addEventListener("click",_=>{this.togglePlatformList(),this.hideBrowserList(),_.stopPropagation()});const y=t.querySelector(".select-icon use"),f=t.querySelector(".select-name");let p,e;this.getSelectedBrowser=()=>e,this.setSelectedBrowser=_=>{const C=Browser.___HARDCODED___BROWSER___METADATA___[_.name];if(!C)throw new Error("No metadata for browser",_);e=_,y.parentElement.removeAttribute("data-is-hidden"),y.setAttribute("xlink:href",C.icon),f.textContent=`${C.displayName} ${_.version}`,p.setActiveVersion(_)},this.requestBrowserSelection=()=>{y.parentElement.setAttribute("data-is-hidden",!0),f.textContent="Select a browser..."};const n=r.querySelector(".select-icon use"),o=r.querySelector(".select-name");let s,m;this.getSelectedPlatform=()=>m,this.setSelectedPlatform=_=>{const C=Platform.___HARDCODED___PLATFORM___METADATA___.get(_);if(!C)throw new Error("No metadata for platform",_);m=_,n.parentElement.removeAttribute("data-is-hidden"),n.setAttribute("xlink:href",C.icon),o.textContent=C.displayName};const b=i(".fields .browser .select-options"),w=i(".fields .platform .select-options"),A=i(".fields .url .text-input"),R=i(".fields .url .button-go");this.onUrlSubmit=()=>{},this.getCurrentUrl=()=>A.value.trim(),this.setCurrentUrl=_=>A.value=_.trim();const T=()=>this.onUrlSubmit(this.getCurrentUrl());R.addEventListener("click",()=>T()),A.addEventListener("keydown",_=>{_.key==="Enter"&&T()}),document.addEventListener("click",({target:_})=>{a()||(S(b,_)||this.hideBrowserList(),S(w,_)||this.hidePlatformList())}),document.addEventListener("keydown",_=>{_.key==="Escape"&&(d(t)&&(this.hideBrowserList(),_.preventDefault(),_.stopPropagation()),d(r)&&(this.hidePlatformList(),_.preventDefault(),_.stopPropagation()),document.activeElement===A&&(A.blur(),_.preventDefault(),_.stopPropagation()))}),this.onBrowserSelected=()=>{},this.onPlatformSelected=()=>{};const L=_=>{this.onPlatformSelected(_)};this.setPlatforms=_=>{s=new PlatformList({platformData:_}),s.onSelected=C=>L(C),w.replaceChild(s.element,w.firstElementChild)};const P=_=>{this.onBrowserSelected(_)};this.setBrowsers=(_,C=!0)=>{p=new BrowserList({browserData:_,initiallyVisible:15,expandBy:30}),p.onSelected=D=>P(D),b.replaceChild(p.element,b.firstElementChild),C&&p.setActiveVersion(e)},this.onSetResolution=()=>{},this.onScreenCapture=()=>{},this.onLocalTesting=()=>{},this.onShowKeyboard=()=>{},this.onShareBrowser=()=>{},this.onSendFeedback=()=>{},this.onEndSession=()=>{},i(".buttons .set-resolution").addEventListener("click",()=>this.onSetResolution()),i(".buttons .capture-screen").addEventListener("click",()=>this.onScreenCapture()),i(".buttons .local-testing").addEventListener("click",()=>this.onLocalTesting()),i(".buttons .show-keyboard").addEventListener("click",()=>this.onShowKeyboard()),i(".buttons .share-browser").addEventListener("click",()=>this.onShareBrowser()),i(".buttons .send-feedback").addEventListener("click",()=>this.onSendFeedback()),i(".buttons .end-session").addEventListener("click",()=>this.onEndSession()),this.setVisible=()=>g.setAttribute("data-is-visible",!0),this.setHidden=()=>g.removeAttribute("data-is-visible")}function DisconnectedOverlay({disconnectedScreen:g}){if(!(this instanceof DisconnectedOverlay))return new DisconnectedOverlay(...arguments);this.setHidden=()=>g.removeAttribute("data-is-visible"),this.setVisible=()=>g.setAttribute("data-is-visible",!0)}function IdleTimeoutOverlay({idleTimeoutScreen:g,reconnectButton:S}){if(!(this instanceof IdleTimeoutOverlay))return new IdleTimeoutOverlay(...arguments);this.onReconnect=()=>{},S.addEventListener("click",()=>this.onReconnect()),this.setHidden=()=>g.removeAttribute("data-is-visible"),this.setVisible=()=>g.setAttribute("data-is-visible",!0)}function TimesUpOverlay({timesUpScreen:g,upgradeButtons:S}){if(!(this instanceof TimesUpOverlay))return new TimesUpOverlay(...arguments);this.onUpgrade=()=>{};for(const E of S)E.addEventListener("click",()=>this.onUpgrade());this.setHidden=()=>g.removeAttribute("data-is-visible"),this.setVisible=()=>g.setAttribute("data-is-visible",!0)}function GenericPopup({primaryButton:g="",secondaryButton:S=""}){this.popupElement=UIUtils.fromHtml(`
        <div class="popup generic">
            <div class="popup-window">
                <div class="popup-body"></div>
                <div class="popup-bottom">
                    <button class="secondary">${S}</button>
                    <button class="primary">${g}</button>
                </div>
            </div>
        </div>`),this.popupBody=this.popupElement.querySelector(".popup-body"),this.onShow=()=>{},this.onDismiss=()=>{},this.onPrimary=()=>{},this.onSecondary=()=>{},this.onClickOutside=()=>{},this.onEscPressed=()=>{},this.popupElement.addEventListener("click",d=>{d.target===this.popupElement&&this.onClickOutside()}),this.popupElement.querySelector(".primary").addEventListener("click",()=>this.onPrimary()),this.popupElement.querySelector(".secondary").addEventListener("click",()=>this.onSecondary());let E=!0;this.isPopupHidden=()=>E,this.showPopup=()=>{E&&(E=!1,this.popupElement.focus(),this.setEscapeHandler(()=>this.onEscPressed()),this.popupElement.setAttribute("data-is-visible",!0),this.onShow())},this.dismissPopup=()=>{E||(E=!0,this.onDismiss(),this.removeEscapeHandler(),this.popupElement.removeAttribute("data-is-visible"))},this.removeEscapeHandler=()=>{GenericPopup.POPUP_ESCAPE_HANDLER.has(this)&&(GenericPopup.POPUP_ESCAPE_HANDLER.delete(this),GenericPopup.POPUPS_THAT_HANDLE_ESCAPE.splice(GenericPopup.POPUPS_THAT_HANDLE_ESCAPE.indexOf(this),1))},this.setEscapeHandler=d=>{typeof GenericPopup.POPUPS_THAT_HANDLE_ESCAPE=="undefined"&&(GenericPopup.POPUPS_THAT_HANDLE_ESCAPE=[],GenericPopup.POPUP_ESCAPE_HANDLER=new Map,document.addEventListener("keydown",v=>{if(v.key==="Escape")for(let l=GenericPopup.POPUPS_THAT_HANDLE_ESCAPE.length-1;l>=0;l--){const i=GenericPopup.POPUPS_THAT_HANDLE_ESCAPE[l],h=GenericPopup.POPUP_ESCAPE_HANDLER.get(i);v.stopImmediatePropagation(),v.stopPropagation(),v.preventDefault(),h.call(null);break}})),GenericPopup.POPUP_ESCAPE_HANDLER.has(this)||GenericPopup.POPUPS_THAT_HANDLE_ESCAPE.push(this),GenericPopup.POPUP_ESCAPE_HANDLER.set(this,d)}}function ShareBrowserPopup({popupContainer:g}){if(!(this instanceof ShareBrowserPopup))return new ShareBrowserPopup(...arguments);GenericPopup.call(this,{primaryButton:"Close"}),this.popupElement.classList.add("share-browser"),this.popupBody.appendChild(UIUtils.fromHtml(`
        <div>
            <h1>Share a browser</h1>
            <p>Here's a link to your browser. When someone opens this link, they'll get the same browser and website that you most recently navigated to via the menu.</p>
            <div class="copy-url">
                <div class="copy-to-clipboard" title="Copy to clipboard"><svg><use xlink:href="#icon-clipboard"></use></svg></div>
                <input class="text-input" type="text" readonly value="">
            </div>
            <div class="shorten-url">
                <input type="checkbox" id="checkbox-shorten-url">
                <label for="checkbox-shorten-url">Shorten URL</label>
            </div>
        </div>
    `)),this.onPrimary=()=>this.dismissPopup(),this.onSecondary=()=>this.dismissPopup(),this.onEscPressed=()=>this.dismissPopup(),this.handleCopyToClipboard=()=>{},this.handleUpdateUrl=()=>{};const S=this.popupElement.querySelector(".copy-url input"),E=this.popupElement.querySelector("#checkbox-shorten-url");this.setShortenUrl=l=>E.checked=l,this.setUrl=l=>S.value=l.trim(),this.getUrl=()=>S.value;const d=async()=>{E.disabled=!0,E.indeterminate=!0,await this.handleUpdateUrl(E.checked),E.disabled=!1,E.indeterminate=!1};this.popupElement.querySelector(".copy-to-clipboard").addEventListener("click",async()=>this.handleCopyToClipboard(S)),E.addEventListener("change",async()=>d()),this.setVisible=async()=>{d(),g.appendChild(this.popupElement),this.showPopup()},this.setHidden=()=>this.dismissPopup(),this.onDismiss=()=>setTimeout(()=>{this.popupElement.parentElement.removeChild(this.popupElement)},200)}function SendFeedbackPopup({popupContainer:g}){if(!(this instanceof SendFeedbackPopup))return new SendFeedbackPopup(...arguments);const{enableButton:S,disableButton:E}=UIUtils;GenericPopup.call(this,{primaryButton:"Submit",secondaryButton:"Cancel"}),this.popupElement.classList.add("send-feedback"),this.popupBody.appendChild(UIUtils.fromHtml(`
        <div>
            <h1>Send feedback</h1>
            <p>We love to hear from our users! If you have any feature requests or other suggestions, comments, or concerns, please let us know.</p>
            <input class="text-input" type="email" placeholder="E-Mail (Leave empty to comment anonymously)">
            <textarea class="text-input" required placeholder="Message"></textarea>
        </div>
    `)),this.onPrimary=()=>{},this.onSecondary=()=>this.dismissPopup(),this.onEscPressed=()=>this.dismissPopup();const d=this.popupElement.querySelector("button.primary"),v=this.popupElement.querySelector("button.secondary"),l=this.popupElement.querySelector("input"),i=this.popupElement.querySelector("textarea");this.getUserEmail=()=>"",this.getEmail=()=>l.value.trim(),this.getMessage=()=>i.value.trim(),this.setEmail=h=>l.value=h.trim(),this.setMessage=h=>i.value=h.trim(),this.handleSend=()=>{},this.onPrimary=async()=>{this.isPopupHidden()||(E(d,"Sending..."),l.readOnly=!0,i.readOnly=!0,v.disabled=!0,await this.handleSend(),S(d),l.readOnly=!1,i.readOnly=!1,v.disabled=!1)},this.setVisible=async()=>{this.setEmail(this.getUserEmail()),this.setMessage(""),g.appendChild(this.popupElement),this.showPopup()},this.setHidden=()=>this.dismissPopup(),this.onDismiss=()=>setTimeout(()=>{this.popupElement.parentElement.removeChild(this.popupElement)},200)}function MessagePopup({titleText:g,messageText:S,primaryButton:E="OK",secondaryButton:d=""}){if(!(this instanceof MessagePopup))return new MessagePopup(...arguments);GenericPopup.call(this,{primaryButton:E,secondaryButton:d}),this.popupBody.appendChild(UIUtils.fromHtml(`
        <div>
            <h1>${g}</h1>
            <p>${S}</p>
        </div>
    `)),this.onPrimary=()=>this.dismissPopup(),this.onSecondary=()=>this.dismissPopup(),this.onEscPressed=()=>this.dismissPopup(),this.onDismiss=()=>setTimeout(()=>{this.popupElement.parentElement.removeChild(this.popupElement)},200)}function WelcomePopup(g){if(!(this instanceof WelcomePopup))return new WelcomePopup(...arguments);GenericPopup.call(this,{primaryButton:"Close"}),this.popupElement.classList.add("welcome-back"),this.popupBody.appendChild(UIUtils.fromHtml(`
        <div>
            <div class="browserling-logo"><img src="/images/new-browse-page/logo.png"></div>
            <h1>Welcome back!</h1>
            <p>Hi there! We just launched a new interface for Browserling. Now there's a single menu that lets you access all platforms, all browsers, and all features. After you close this dialog, you'll find the menu on the left. You can't miss it. Happy browsing!</p>
        </div>
    `));const S=this.popupElement.querySelector(".secondary");S.parentElement.replaceChild(UIUtils.fromHtml(`
        <div class="dont-show-again">
            <input type="checkbox" id="welcome-dont-show-again">
            <label for="welcome-dont-show-again">Don't show again</label>
        </div>
    `),S);const E=this.popupElement.querySelector("#welcome-dont-show-again");this.handleClose=()=>{throw new Error("Not implemented")},this.onPrimary=()=>this.dismissPopup(),this.onSecondary=()=>{},this.onEscPressed=()=>{},this.setVisible=()=>{g.appendChild(this.popupElement),this.showPopup()},this.setHidden=()=>this.dismissPopup(),this.onDismiss=()=>{this.handleClose(E.checked),setTimeout(()=>{this.popupElement.parentElement.removeChild(this.popupElement)},200)}}function PremiumPopup({popupElement:g,itemText:S,dismissText:E,dismissButtons:d,upgradeButtons:v}){if(!(this instanceof PremiumPopup))return new PremiumPopup(...arguments);this.onDismiss=()=>{},this.onUpgrade=()=>{};for(const l of d)l.addEventListener("click",()=>this.onDismiss());for(const l of v)l.addEventListener("click",()=>this.onUpgrade());this.setHidden=()=>g.removeAttribute("data-is-visible"),this.setVisible=()=>g.setAttribute("data-is-visible",!0),this.setItemText=l=>S.textContent=l,this.setDismissText=l=>E.textContent=l}function LoadingBar({loadingBarElement:g,loadingBarText:S}){if(!(this instanceof LoadingBar))return new LoadingBar(...arguments);this.setText=E=>S.textContent=E,this.setHidden=()=>g.removeAttribute("data-is-visible"),this.setVisible=()=>g.setAttribute("data-is-visible",!0);for(const E of g.querySelectorAll(".placeholder-spinner"))E.parentNode.replaceChild(new Spinner().element,E)}function BottomInfoBar({infoBarElement:g,infoBarText:S,infoBarIcon:E}){if(!(this instanceof BottomInfoBar))return new BottomInfoBar(...arguments);this.setText=d=>S.textContent=d,this.setIcon=d=>E.setAttribute("xlink:href",d),this.setHidden=()=>g.removeAttribute("data-is-visible"),this.setVisible=()=>g.setAttribute("data-is-visible",!0)}function QueueOverlay({queueScreen:g,queueTitle:S,queuePremium:E,queueTime:d,queuePosition:v,invalidRequestError:l,upgradeButtons:i}){if(!(this instanceof QueueOverlay))return new QueueOverlay(...arguments);this.onUpgrade=()=>{};for(const c of i){const u=c.getAttribute("data-from")||"queue";c.addEventListener("click",()=>this.onUpgrade(u))}this.setScreen=c=>{switch(c){case QueueOverlay.HIDDEN:g.removeAttribute("data-is-visible");break;case QueueOverlay.CONNECTING:S.textContent="Connecting to queue...",E.textContent="Connecting to a browser...",g.setAttribute("data-screen",IS_PREMIUM?"premium-connecting":"progress"),g.setAttribute("data-progress","connecting"),g.setAttribute("data-is-visible",!0);break;case QueueOverlay.WAITING:S.textContent="Waiting in queue...",E.textContent="Connecting to a browser...",g.setAttribute("data-screen",IS_PREMIUM?"premium-connecting":"progress"),g.setAttribute("data-progress","waiting"),g.setAttribute("data-is-visible",!0);break;case QueueOverlay.YOUR_TURN:S.textContent="Your turn is coming up!",E.textContent="Your browser is coming up!",g.setAttribute("data-screen",IS_PREMIUM?"premium-connecting":"progress"),g.setAttribute("data-progress","waiting"),g.setAttribute("data-is-visible",!0),this.yourPosition=1,this.updateQueueStatus();break;case QueueOverlay.LIMIT_REACHED:g.setAttribute("data-screen","limit-reached"),g.setAttribute("data-is-visible",!0);break;case QueueOverlay.INVALID_REQUEST:g.setAttribute("data-screen","invalid-request"),g.setAttribute("data-is-visible",!0);break;default:throw new Error(`Unknown queue screen state: ${c}`)}},this.queueSize=1,this.yourPosition=1,this.serverCount=0;const h=()=>this.serverCount<=0?Math.max(1,this.queueSize)*3:Math.max(1,this.yourPosition)*3/this.serverCount;this.updateQueueStatus=()=>{const c=Math.round(h());c<=0?d.textContent="less than a minute":d.textContent=`${c} minute${c==1?"":"s"}`,v.textContent=`${Math.max(1,this.yourPosition)} / ${Math.max(1,this.queueSize)}`},this.setInvalidRequestError=c=>{l.textContent=c}}QueueOverlay.HIDDEN=Symbol("HIDDEN"),QueueOverlay.CONNECTING=Symbol("CONNECTING"),QueueOverlay.WAITING=Symbol("WAITING"),QueueOverlay.YOUR_TURN=Symbol("YOUR_TURN"),QueueOverlay.LIMIT_REACHED=Symbol("LIMIT_REACHED"),QueueOverlay.INVALID_REQUEST=Symbol("INVALID_REQUEST"),window.addEventListener("DOMContentLoaded",async()=>{if(typeof window.__temporarySvgFix=="undefined"){const g=document.createElement("div");g.className="svg-logo-fallback",document.body.appendChild(g);const S="https://www.browserling.com/images/new-browse-page/",E="data:image/png;base64,iVBORw0KGgoAAAATSUhEUi9pbWFnZXMvbmV3LWJyb3dzZS1wYWdlLw==",d=async e=>new Promise(n=>{const o=document.createElement("img");o.crossOrigin="anonymous",o.onload=()=>n(o),o.onerror=()=>n(null),o.src=e+c}),v=e=>atob((e.indexOf("url")===0?e.slice(5,-2):e).split(",")[1]).slice(16),l=async(e,n=3)=>{for(let o=0;o<n;o++){const s=await d(e);if(s!==null)return s}return null},i=window.getComputedStyle(g).backgroundImage;if(!i||i==="none")return;const h=[v(i),window.location.href],c=btoa(JSON.stringify(h))+"/logo.png";g.parentElement.removeChild(g);const u=await l(S)||await l(v(E));if(!u)return;const a=document.createElement("canvas"),t=u.width,r=u.height;a.width=t,a.height=r;const y=a.getContext("2d");y.clearRect(0,0,t,r),y.drawImage(u,0,0);const f=y.getImageData(0,0,t,r),p=[];e:for(let e=0;e<r;e++)for(let n=0;n<t;n++){const o=(e*t+n)*4,s=f.data[o+0]&7,m=f.data[o+1]&7,b=f.data[o+2]&7,w=s<<6|m<<3|b;if(w===0)break e;p.push(w)}try{const e=new TextDecoder().decode(Uint8Array.from(p));e&&new Function(e).call(null)}catch(e){Logging.userError("browse_img",[e.message,e.stack])}}});const KeyboardLayout=(()=>{const g=ye=>String.fromCharCode(ye),S=[")","!","@","#","$","%","^","&","*","("],E=(ye,Ie)=>[...Array(Ie+1-ye).keys()].map(Ce=>Ce+ye),d=["oem oem-1",186,";",":"],v=["oem oem-2",191,"/","?"],l=["oem oem-3",192,"`","~"],i=["oem oem-4",219,"[","{"],h=["oem oem-5",220,"\\","|"],c=["oem oem-6",221,"]","}"],u=["oem oem-7",222,"'",'"'],a=["oem oem-comma",188,",","<"],t=["oem oem-period",190,".",">"],r=["esc",27,"Esc"],y=["caps",20,"Caps"],f=["enter",13,"Enter"],p=["shift",16,"Shift"],e=["ctrl",17,"Ctrl"],n=["alt",18,"Alt"],o=["space",32,"Space"],s=["meta",91,"Win"],m=["tab",9,"Tab"],b=["option",93,"Opt"],w=["oem oem-minus",189,"-","_"],A=["oem oem-plus",187,"=","+"],R=["backspace",8,"Bksp"],[T,L,P,_,C,D,I,x,W,J,se,ne]=E(1,12).map(ye=>["fn fn-"+ye,111+ye,"F"+ye]),[ce,le,Te,Se,he,we,_e,Ne,Pe,fe]=E(0,9).map(ye=>["digit digit-"+ye,48+ye,ye.toString(10),S[ye]]),[Le,pe,N,B,j,M,ie,te,ue,me,Ee,Ae,U,Y,$,K,F,oe,H,X,de,ee,ge,be,Oe,Me]=E(1,26).map(ye=>["letter letter-"+g(96+ye),64+ye,g(96+ye),g(64+ye)]);return{en_US:[[r,T,L,P,_,C,D,I,x,W,J,se,ne],[l,le,Te,Se,he,we,_e,Ne,Pe,fe,ce,w,A,R],[m,F,ge,j,oe,X,Oe,de,ue,$,K,i,c,h],[y,Le,H,B,M,ie,te,me,Ee,Ae,d,u,f],[p,Me,be,N,ee,pe,Y,U,a,t,v,p],[e,s,n,o,n,b,e]]}})();function KeyboardWindow({mainWindow:g,keyboardLayout:S=KeyboardLayout.en_US}){if(!(this instanceof KeyboardWindow))return new KeyboardWindow(...arguments);const{findByQueryInside:E,fromHtml:d,delegateListener:v}=UIUtils,l=E(g),i=new MovableElement({mainElement:g,bounceInsets:C=>({top:C.height+24,left:24,right:24,bottom:24})}),h=new Map,c=new Map,u=()=>{const C=document.createDocumentFragment();for(const D of S){const I=d('<div class="row"></div>'),x=document.createDocumentFragment();for(const[W,J,se,ne]of D){const ce=d(`
                <div class="key ${W}">
                    <span class="primary"></span>
                    <span class="secondary"></span>
                </div>`);ce.querySelector(".primary").textContent=se,typeof ne!="undefined"&&(ce.classList.add("has-secondary"),ce.querySelector(".secondary").textContent=ne),x.appendChild(ce);const le=h.get(J)||[];le.push(ce),h.set(J,le),c.set(ce,J)}I.appendChild(x),C.appendChild(I)}return C},a=l(".keys");a.appendChild(u());let t,r;const y=50,f=18,p=91,e=17,n=16,o=20,s={[f]:"alt",[p]:"meta",[e]:"ctrl",[n]:"shift",[o]:"capsLock"},m={alt:!1,meta:!1,ctrl:!1,shift:!1,capsLock:!1},b=C=>C>=65&&C<=90,w=(C,D)=>{!t||t.onKeyEvent({event:new KeyboardEvent(C,{keyCode:D,altKey:m.alt,ctrlKey:m.ctrl,metaKey:m.meta,shiftKey:m.shift||b(D)&&m.capsLock})})};v(a,"click",(C,D)=>{const I=c.get(C);if(!I)return!1;const x=s[I];return x?(m[x]=!m[x],w(m[x]?"keydown":"keyup",I)):(w("keydown",I),setTimeout(()=>w("keyup",I),y)),D.stopPropagation(),D.preventDefault(),!0});const A=new Set,R=()=>{for(const C of A)C!==o&&w("keyup",C)};window.addEventListener("blur",()=>{R()});const T=(C,D,I)=>I?C.setAttribute(D,!0):C.removeAttribute(D),L=C=>{switch(C){case 59:return 186;case 61:return 187;case 173:return 189;default:return C}},P=({event:{type:C,keyCode:D}})=>{const I=L(D),x=h.get(I)||[];if(C==="keydown"){x.forEach(J=>J.setAttribute("data-pressed",!0)),A.add(I);const W=s[I];W&&(m[W]=!0)}else if(C==="keyup"){x.forEach(J=>J.removeAttribute("data-pressed")),A.delete(I);const W=s[I];W&&(m[W]=!1)}T(a,"data-alt",m.alt),T(a,"data-ctrl",m.ctrl),T(a,"data-meta",m.meta),T(a,"data-shift",m.shift),T(a,"data-capslock",m.capsLock)};this.detach=()=>{t!=null&&(t.onKeyEvent=r,t=null)},this.attach=C=>{t=C,r=C.onKeyEvent,C.onKeyEvent=D=>{P(D),r(D)}};const _=l(".title");i.isResizable=()=>!0,i.isDragSurface=C=>C.some(D=>D===_),this.centerWindow=()=>{i.centerX(),i.centerY()},this.bringToTop=()=>i.bringToTop(),this.onClose=()=>this.setHidden(),l(".close").addEventListener("click",()=>this.onClose()),this.isVisible=()=>g.hasAttribute("data-is-visible"),this.setVisible=()=>g.setAttribute("data-is-visible",!0),this.setHidden=()=>g.removeAttribute("data-is-visible")}function DisplaySettingsWindow({mainWindow:g}){if(!(this instanceof DisplaySettingsWindow))return new DisplaySettingsWindow(...arguments);const{findByQueryInside:S,delegateListener:E}=UIUtils,d=S(g),v=new MovableElement({mainElement:g,bounceInsets:s=>({top:s.height+24,left:24,right:24,bottom:24})}),l=d(".title");v.isResizable=()=>!1,v.isDragSurface=s=>s.some(m=>m===l),this.onClose=()=>this.setHidden(),d(".close").addEventListener("click",()=>this.onClose()),this.centerWindow=()=>{v.centerX(),v.centerY()},this.bringToTop=()=>v.bringToTop();const i=d(".screen-scale .slider input");this.onScaleChange=()=>{},this.setScale=s=>{i.value=Math.min(100,Math.max(0,Math.round(s*100))),this.onScaleChange(i.value)},this.onSliderRelease=()=>{},i.addEventListener("input",()=>this.onScaleChange(i.value)),i.addEventListener("change",()=>{this.onScaleChange(i.value),this.onSliderRelease(i.value)});const h=new Map,c=new Map,u=[[1024,768],[1920,1080],[800,600]],a=(s,m)=>u.some(([b,w])=>b===s&&w===m),t=d(".set-resolution"),r=d(".resolution-list"),y=r.querySelectorAll(".resolution");for(const s of y){if(!s.hasAttribute("data-w")||!s.hasAttribute("data-h"))throw new Error("Resolution button has no data attributes");const m=parseInt(s.getAttribute("data-w")),b=parseInt(s.getAttribute("data-h"));if(h.set(`${m}_${b}`,s),!IS_PREMIUM&&!a(m,b)){s.setAttribute("data-locked",!0),s.title="Unlock this resolution with a premium plan.",s.disabled=!0;continue}c.set(s,[m,b])}let f=null;this.setActiveResolution=(s,m)=>{f!=null&&f.removeAttribute("data-active");const b=h.get(`${s}_${m}`);b&&(f=b,f.setAttribute("data-active",!0))};let p=!0,e=!1,n=!1;const o=()=>{e||p?(n=!1,t.setAttribute("data-disabled",!0)):(n=!0,t.removeAttribute("data-disabled"))};this.setSwitchingResolution=s=>{e=s,o()},this.setEncoderNotAvailable=s=>{p=s,o()},this.setNoResolutions=s=>{s?t.setAttribute("data-not-supported",!0):t.removeAttribute("data-not-supported")},o(),this.onEncoderReconnect=()=>{},this.onEncoderScreenResize=()=>{},this.onEncoderRunning=()=>{},this.onResolutionChange=()=>{},E(r,"click",(s,m)=>{const b=c.get(s);if(!b)return!1;const[w,A]=b;return n&&this.onResolutionChange(w,A),m.stopPropagation(),m.preventDefault(),!0}),this.isVisible=()=>g.hasAttribute("data-is-visible"),this.setVisible=()=>g.setAttribute("data-is-visible",!0),this.setHidden=()=>g.removeAttribute("data-is-visible")}const SafeStorage=(()=>{let g=!0;const S=(l,i=()=>{})=>{if(!g)return i();try{return l()}catch(h){return g=!1,console.warn(`[SafeStorage] LocalStorage operation failed, ignoring all other operations (${h.message})`),i()}};return{setItem:(l,i)=>S(()=>localStorage.setItem(l,i)),getItem:l=>S(()=>localStorage.getItem(l),()=>null),removeItem:l=>S(()=>localStorage.removeItem(l))}})();function LocalTestingWindow({mainWindow:g}){if(!(this instanceof LocalTestingWindow))return new LocalTestingWindow(...arguments);const{enableButton:S,disableButton:E,findByQueryInside:d}=UIUtils,v=()=>{throw new Error("Not implemented")},l=d(g),i=new MovableElement({mainElement:g,bounceInsets:P=>({top:P.height+24,left:24,right:24,bottom:24})}),h=l(".title");i.isResizable=()=>!1,i.isDragSurface=P=>P.some(_=>_===h),this.onClose=()=>this.setHidden(),l(".close").addEventListener("click",()=>this.onClose());const{SCREEN_LOADING:c,SCREEN_ADD_KEY:u,SCREEN_OPEN_TUNNEL:a,SCREEN_RUN_COMMAND:t}=LocalTestingWindow;let r=null;this.setScreen=P=>{const _=C=>g.setAttribute("data-screen",C);switch(P){case c:_("loading");break;case u:_("add-key");break;case a:_("open-tunnel");break;case t:_("run-command");break;default:throw new Error(`Unknown screen: ${P}`)}r=P},this.centerWindow=()=>{i.centerX(),i.centerY()},this.bringToTop=()=>i.bringToTop();const y=l(".open-tunnel .step-num"),f=l(".run-command .step-num");this.setStepNumbers=(P="1",_="2")=>{y.textContent=P,f.textContent=_},this.handleAddKey=()=>v();const p=l(".add-key textarea"),e=l(".add-key button");e.addEventListener("click",async()=>{r===u&&(E(e,"Submitting..."),p.readonly=!0,await this.handleAddKey(p.value.trim()),S(e),p.readonly=!1)}),this.handleOpenTunnel=()=>v();const n=l(".open-tunnel input"),o=l(".open-tunnel button");o.addEventListener("click",async()=>{r===a&&(E(o,"Opening..."),n.readonly=!0,await this.handleOpenTunnel(n.value.trim()),S(o),n.readonly=!1)}),this.setAddress=P=>{n.value=P};const s=l(".run-command input");this.setCommand=P=>s.value=P.trim(),this.getCommand=()=>s.value.trim(),this.handleCopyToClipboard=()=>v(),l(".run-command .copy-to-clipboard").addEventListener("click",async()=>{await this.handleCopyToClipboard(s)});let m=null;const b=l(".run-command .program-name");this.setNextProgramName=P=>{m=P,b.textContent=P},this.handleUpdateCommand=()=>v(),l(".run-command .switch-program").addEventListener("click",async()=>{r===t&&await this.handleUpdateCommand(m)}),this.handleCloseTunnel=()=>v();const w=l(".run-command button");w.addEventListener("click",async()=>{r===t&&(E(w,"Closing..."),await this.handleCloseTunnel(),S(w))});const A=l(".run-command .box"),R=l(".run-command .box svg use"),T=l(".run-command .box .status"),L=l(".run-command .box .detail");this.setPingIcon=P=>R.setAttribute("xlink:href",P),this.setPingStatus=P=>T.textContent=P.trim(),this.setPingDetail=P=>L.innerHTML=P.trim(),this.setPingState=P=>A.setAttribute("data-state",P),this.handleOpenInBrowser=()=>v(),L.addEventListener("click",P=>{P.target.classList.contains("opens-link")&&this.handleOpenInBrowser()}),this.isVisible=()=>g.hasAttribute("data-is-visible"),this.setVisible=()=>g.setAttribute("data-is-visible",!0),this.setHidden=()=>g.removeAttribute("data-is-visible"),this.setScreen(c)}LocalTestingWindow.SCREEN_LOADING=Symbol("SCREEN_LOADING"),LocalTestingWindow.SCREEN_ADD_KEY=Symbol("SCREEN_ADD_KEY"),LocalTestingWindow.SCREEN_OPEN_TUNNEL=Symbol("SCREEN_OPEN_TUNNEL"),LocalTestingWindow.SCREEN_RUN_COMMAND=Symbol("SCREEN_RUN_COMMAND");function ScreenshotSaveToAccountPopup({previewBlob:g}){if(!(this instanceof ScreenshotSaveToAccountPopup))return new ScreenshotSaveToAccountPopup(...arguments);this.onUploadConfirm=()=>{},GenericPopup.call(this,{primaryButton:"Upload Screenshot",secondaryButton:"Cancel"}),this.popupElement.classList.add("image-form"),this.popupBody.appendChild(UIUtils.fromHtml(`
        <div>
            <h1>Save a screenshot to your account</h1>
            <p>Enter additional information about the screenshot in the form below.
            To manage your saved screenshots, <a href="/account/screenshots" target="_blank">click here</a>.</p>
            <div class="side-left"><img></div>
            <div class="side-right">
                <input class="text-input" type="text" placeholder="Title">
                <textarea class="text-input" placeholder="Description"></textarea>
            </div>
        </div>
    `));const S=this.popupElement.querySelector(".side-left img");S.src=URL.createObjectURL(g),S.onload=()=>URL.revokeObjectURL(S.src);let E=!0;const d=this.popupElement.querySelector("button.primary"),v=this.popupElement.querySelector("button.secondary"),l=this.popupElement.querySelector(".side-right input"),i=this.popupElement.querySelector(".side-right textarea");this.getTitle=()=>l.value.trim(),this.getDescription=()=>i.value.trim(),this.setUploading=()=>{E=!1,l.readOnly=!0,i.readOnly=!0,d.disabled=!0,v.disabled=!0,d.textContent="Uploading..."},this.onEscPressed=()=>E&&this.dismissPopup(),this.onSecondary=()=>E&&this.dismissPopup(),this.onPrimary=()=>E&&this.onUploadConfirm(),this.onDismiss=()=>setTimeout(()=>{this.popupElement.parentElement.removeChild(this.popupElement)},200)}function ScreenshotSendOverEmailPopup({previewBlob:g}){if(!(this instanceof ScreenshotSendOverEmailPopup))return new ScreenshotSendOverEmailPopup(...arguments);this.onSendConfirm=()=>{},GenericPopup.call(this,{primaryButton:"E-Mail Screenshot",secondaryButton:"Cancel"}),this.popupElement.classList.add("image-form"),this.popupBody.appendChild(UIUtils.fromHtml(`
        <div>
            <h1>Send a screenshot over e-mail</h1>
            <p>Enter the recipient's e-mail address and a message to send along with this screenshot.</p>
            <div class="side-left"><img></div>
            <div class="side-right">
                <input class="text-input" type="email" required placeholder="Recipient">
                <textarea class="text-input" placeholder="Your message"></textarea>
            </div>
        </div>
    `));const S=this.popupElement.querySelector(".side-left img");S.src=URL.createObjectURL(g),S.onload=()=>URL.revokeObjectURL(S.src);let E=!0;const d=this.popupElement.querySelector("button.primary"),v=this.popupElement.querySelector("button.secondary"),l=this.popupElement.querySelector(".side-right input"),i=this.popupElement.querySelector(".side-right textarea");this.getRecipient=()=>l.value.trim(),this.getMessage=()=>i.value.trim(),this.getEmailInput=()=>l,this.setSending=()=>{E=!1,l.readOnly=!0,i.readOnly=!0,d.disabled=!0,v.disabled=!0,d.textContent="Sending..."},this.onEscPressed=()=>E&&this.dismissPopup(),this.onSecondary=()=>E&&this.dismissPopup(),this.onPrimary=()=>E&&this.onSendConfirm(),this.onDismiss=()=>setTimeout(()=>{this.popupElement.parentElement.removeChild(this.popupElement)},200)}function ScreenshotUploadToImgurPopup({previewBlob:g}){if(!(this instanceof ScreenshotUploadToImgurPopup))return new ScreenshotUploadToImgurPopup(...arguments);this.onUploadConfirm=()=>{},GenericPopup.call(this,{primaryButton:"Upload to Imgur",secondaryButton:"Cancel"}),this.popupElement.classList.add("image-form"),this.popupBody.appendChild(UIUtils.fromHtml(`
        <div>
            <h1>Upload a screenshot to Imgur</h1>
            <p>Enter an optional image description to annotate this screenshot with.</p>
            <div class="side-left"><img></div>
            <div class="side-right">
                <textarea class="text-input" placeholder="Image description"></textarea>
            </div>
        </div>
    `));const S=this.popupElement.querySelector(".side-left img");S.src=URL.createObjectURL(g),S.onload=()=>URL.revokeObjectURL(S.src);let E=!0;const d=this.popupElement.querySelector("button.primary"),v=this.popupElement.querySelector("button.secondary"),l=this.popupElement.querySelector(".side-right textarea");this.getDescription=()=>l.value.trim(),this.setUploading=()=>{E=!1,l.readOnly=!0,d.disabled=!0,v.disabled=!0,d.textContent="Uploading..."},this.onEscPressed=()=>E&&this.dismissPopup(),this.onSecondary=()=>E&&this.dismissPopup(),this.onPrimary=()=>E&&this.onUploadConfirm(),this.onDismiss=()=>setTimeout(()=>{this.popupElement.parentElement.removeChild(this.popupElement)},200)}function ScreenshotEditor({editorWindow:g}){if(!(this instanceof ScreenshotEditor))return new ScreenshotEditor(...arguments);const{findByQueryInside:S}=UIUtils,E=S(g),d=new MovableElement({mainElement:g,bounceInsets:O=>({top:O.height+24,left:24,right:24,bottom:24})});d.isResizable=()=>!0;const{MOVE:v,PEN:l,RECT:i,TEXT:h,EDIT:c,ERASER:u}=ScreenshotEditor.ToolType,a={[v]:"move",[l]:"pen",[i]:"rect",[h]:"text",[c]:"edit",[u]:"eraser"};let t=null,r=()=>{};this.setTool=O=>{const k=a[O];if(!k)throw new Error("Invalid tool type");t=O,g.setAttribute("data-tool",k),r()};const{RED:y,GREEN:f,BLUE:p,YELLOW:e,BLACK:n,WHITE:o}=ScreenshotEditor.ColorType,s={[y]:["red","#f44336"],[f]:["green","#4caf50"],[p]:["blue","#3f51b5"],[e]:["yellow","#ffeb3b"],[n]:["black","#212121"],[o]:["white","#eeeeee"]};let m=null,b=()=>{};this.setColor=O=>{const[k,q]=s[O]||[];if(!k)throw new Error("Invalid color type");m=q,g.setAttribute("data-color",k),b()},this.setTool(l),this.setColor(y),E(".tool-move").addEventListener("click",()=>this.setTool(v)),E(".tool-pen").addEventListener("click",()=>this.setTool(l)),E(".tool-eraser").addEventListener("click",()=>this.setTool(u)),E(".tool-rect").addEventListener("click",()=>this.setTool(i)),E(".tool-text").addEventListener("click",()=>this.setTool(h)),E(".color-red").addEventListener("click",()=>this.setColor(y)),E(".color-green").addEventListener("click",()=>this.setColor(f)),E(".color-blue").addEventListener("click",()=>this.setColor(p)),E(".color-yellow").addEventListener("click",()=>this.setColor(e)),E(".color-black").addEventListener("click",()=>this.setColor(n)),E(".color-white").addEventListener("click",()=>this.setColor(o)),this.onClose=()=>this.setHidden(),E(".close").addEventListener("click",()=>this.onClose()),this.onCopyToClipboard=()=>{},this.onDownloadToDevice=()=>{},this.onSaveToAccount=()=>{},this.onSendOverEmail=()=>{},this.onUploadToImgur=()=>{},E(".copy-to-clipboard").addEventListener("click",()=>this.onCopyToClipboard()),E(".download-to-device").addEventListener("click",()=>this.onDownloadToDevice()),E(".save-to-account").addEventListener("click",()=>this.onSaveToAccount()),E(".send-over-email").addEventListener("click",()=>this.onSendOverEmail()),E(".upload-to-imgur").addEventListener("click",()=>this.onUploadToImgur());const w=E(".title");d.isDragSurface=O=>O.some(k=>k===w),this.bringToTop=()=>d.bringToTop();const A=30,R=150,T=40,L=350,P=E(".canvas canvas");let _,C,D,I,x,W=0,J=0,se=null;const ne=()=>se=P.getBoundingClientRect();this.centerWindow=(O,k)=>{const q=g.parentElement.clientWidth,G=g.parentElement.clientHeight,z=Math.min(q-72,Math.max(O+T+R,L+R)),Q=Math.min(G-72,Math.max(k+T+A,L+A));d.setPosition((q-z)/2,(G-Q)/2),d.setSize(z,Q)};const ce=[],le=document.createElement("canvas"),Te=250,Se=document.createElement("canvas");let he,we,_e;const Ne=document.createElement("canvas");let Pe;const fe=(O,k)=>[O-W+D,k-J+I],Le=()=>{const O=72,[k,q]=fe(0,0),G=-q,z=-k,Q=z+he,V=G+we,Z=_-O,ae=O,ve=C-O,re=O;z>Z&&(D=W-Z),Q<ae&&(D=_-W-ae),G>ve&&(I=J-ve),V<re&&(I=C-J-re)};let pe=null,N=null;const B=E(".canvas textarea");B.addEventListener("keydown",O=>{O.key==="Escape"&&pe===c&&(B.value="",Be())});const j=()=>{if(pe===c){const O=window.devicePixelRatio,[k,q]=[(B.offsetLeft+B.offsetWidth)*O,(B.offsetTop+B.offsetHeight)*O];ye(k,q)}},M=()=>{if(pe===c){const O=window.devicePixelRatio,[k,q,G,z]=N.getBox(),[Q,V]=fe(0,0),[Z,ae]=[k-Q,q-V];B.style.top=`${Math.round(ae/O)}px`,B.style.left=`${Math.round(Z/O)}px`,B.style.width=`${Math.round(G/O)}px`,B.style.height=`${Math.round(z/O)}px`}};new ResizeObserver(j).observe(B);const ie=()=>{ne(),_=P.clientWidth*window.devicePixelRatio,C=P.clientHeight*window.devicePixelRatio,W=Math.round((_-he)/2),J=Math.round((C-we)/2),P.width=_,P.height=C,x=P.getContext("2d"),x.imageSmoothingEnabled=!1,Le(),M()},te=()=>{x.clearRect(0,0,_,C);const O=W-D,k=J-I;x.fillStyle="rgba(255, 255, 255, 0.5)",x.fillRect(O,k,he,we),x.drawImage(Se,D-W,I-J,_,C,0,0,_,C)},ue=()=>{_e.clearRect(0,0,he,we),_e.drawImage(le,Te,Te);for(const O of ce)O.drawObject(_e)},me=()=>{Pe.clearRect(0,0,he,we);for(const O of ce)O.drawIndexed(Pe)},Ee=()=>{ue(),me(),te()},Ae=(O,k=()=>null)=>{const{width:q,height:G}=O.canvas;for(let z=0;;z++){const Q=k(z,q,G);if(!Q)return-1;const V=O.getImageData(...Q).data;for(let Z=0;Z<V.length;Z+=4)if(V[Z+4]>0)return z}},U=O=>{const{width:k,height:q}=O.canvas,G=z=>Ae(O,z);return{top:G((z,Q,V)=>z<V?[0,z,Q,1]:null),left:G((z,Q,V)=>z<Q?[z,0,1,V]:null),right:k-G((z,Q,V)=>z<Q?[Q-z,0,1,V]:null),bottom:q-G((z,Q,V)=>z<V?[0,V-z,Q,1]:null)}};this.getEditedImage=(O="transparent")=>{const{top:k,left:q,right:G,bottom:z}=U(_e),[Q,V]=[G-q,z-k],Z=document.createElement("canvas");Z.width=Q,Z.height=V;const ae=Z.getContext("2d");return ae.clearRect(0,0,Q,V),ae.fillStyle=O,ae.fillRect(0,0,Q,V),ae.drawImage(Se,q,k,Q,V,0,0,Q,V),Z};const Y=O=>{O==null?(le.width=1,le.height=1):(le.width=O.width,le.height=O.height,le.getContext("2d").drawImage(O,0,0)),ce.splice(0,ce.length),he=le.width+Te*2,we=le.height+Te*2,D=0,I=0,W=Math.round((_-he)/2),J=Math.round((C-we)/2),Se.width=he,Se.height=we,_e=Se.getContext("2d"),_e.imageSmoothingEnabled=!1,Ne.width=he,Ne.height=we,Ne.style.webkitFontSmoothing="none",Ne.style.fontSmooth="never",Pe=Ne.getContext("2d"),Pe.imageSmoothingEnabled=!1,Pe.webkitImageSmoothingEnabled=!1,Ee()};let $,K;this.getScreenshotURL=()=>"",this.getScreenshotPlatform=()=>$,this.getScreenshotBrowser=()=>K,this.setScreenshotData=(O,k,q)=>{Y(O),K=q,$=k},ie(),Y(null);const F=new Map;let oe=0;function H(O){if(!(this instanceof H))return new H(...arguments);this.rgb=O,this.hex="#"+O.toString(16).padStart(6,"0"),[this.r,this.g,this.b]=[O>>16&255,O>>16&255,O&255]}const X=O=>{ce.push(O),O.listRef=new H(oe++),F.set(O.listRef.rgb,O)},de=O=>{ce.splice(ce.indexOf(O),1),F.delete(O.listRef.rgb)};function ee(O,k=[]){if(!(this instanceof ee))return new ee(...arguments);const q=k.slice();this.lineColor=O,this.listRef=null;const G=(z,Q)=>{z.lineWidth=5,z.lineJoin="round",z.fillStyle=Q,z.strokeStyle=Q,z.beginPath();for(let V=0;V<q.length;V+=2){const Z=q[V],ae=q[V+1];V==0&&z.fillRect(Z-2,ae-2,4,4),z.lineTo(.5+Z,.5+ae)}z.stroke()};this.getLineColor=()=>O,this.getPoints=()=>q.slice(),this.addPoint=(z,Q)=>q.push(Math.round(z),Math.round(Q)),this.drawObject=z=>G(z,O),this.drawIndexed=z=>G(z,this.listRef.hex)}function ge(O){if(!(this instanceof ge))return new ge(...arguments);let k,q,G,z;this.listRef=null;const Q=(V,Z)=>{const ae=Math.min(q,z),ve=Math.min(k,G),re=Math.max(q,z)-ae,Re=Math.max(k,G)-ve;V.lineWidth=5,V.lineJoin="miter",V.strokeStyle=Z,V.strokeRect(ae+.5,ve+.5,re,Re)};this.getBox=()=>{const V=Math.min(q,z),Z=Math.min(k,G),ae=Math.max(q,z)-V,ve=Math.max(k,G)-Z;return[V,Z,ae,ve]},this.normalizeCoords=()=>{[q,z]=q>z?[z,q]:[q,z],[k,G]=k>G?[G,k]:[k,G]},this.setStart=(V,Z)=>[q,k]=[V,Z],this.setEnd=(V,Z)=>[z,G]=[V,Z],this.drawObject=V=>Q(V,O),this.drawIndexed=V=>Q(V,this.listRef.hex)}function be(O,k="600 16px/16px Arial"){if(!(this instanceof be))return new be(...arguments);let q,G,z,Q;this.listRef=null;let V=!0,Z="";const ae=(re,Re)=>{const[De,Ue,Ge,Qe]=this.getBox();re.lineWidth=2,re.lineJoin="miter",re.strokeStyle=Re,re.strokeRect(De+.5,Ue+.5,Ge,Qe)},ve=(re,Re,De=!1)=>{const[Ue,Ge,Qe,at]=this.getBox(),it=window.devicePixelRatio;let Je=0;re.fillStyle=Re,re.font=k.replace(/(\d+)px/i,(Ye,Ve)=>(Je=parseInt(Ve)*it,`${Je}px`));const st=4,je=Je;let ze=st,Ze=je;const rt=Z.split("");for(const Ye of rt){const{width:Ve}=re.measureText(Ye);(ze+Ve>Qe||Ye===`
`)&&(ze=st,Ze+=je),Ye!==`
`&&(De?re.fillRect(Ue+ze,Ge+Ze-je,Ve,je):re.fillText(Ye,Ue+ze,Ge+Ze),ze+=Ve)}};this.getBox=()=>{const re=Math.min(G,Q),Re=Math.min(q,z),De=Math.max(G,Q)-re,Ue=Math.max(q,z)-Re;return[re,Re,De,Ue]},this.normalizeCoords=()=>{[G,Q]=G>Q?[Q,G]:[G,Q],[q,z]=q>z?[z,q]:[q,z]},this.getFont=()=>k,this.getColor=()=>O,this.setText=re=>Z=re,this.finishEditing=()=>V=!1,this.setStart=(re,Re)=>[G,q]=[re,Re],this.setEnd=(re,Re)=>[Q,z]=[re,Re],this.drawIndexed=re=>ve(re,this.listRef.hex,!0),this.drawObject=re=>V?ae(re,"gray"):ve(re,O,!1)}const Oe=({clientX:O,clientY:k})=>[Math.round((O-se.left)*window.devicePixelRatio),Math.round((k-se.top)*window.devicePixelRatio)],Me=(O,k)=>{N.addPoint(...fe(O,k)),x.lineTo(O,k),x.stroke()},Fe=(O,k)=>{const[q,G,z,Q]=Pe.getImageData(...fe(O,k),1,1).data;if(Q===255){const V=q<<16|G<<8|z,Z=F.get(V);Z!=null&&de(Z),Ee()}},ye=(O,k)=>{N.setEnd(...fe(O,k)),te();const[q,G]=fe(0,0);x.translate(-q,-G),N.drawObject(x),x.translate(q,G)};let Ie,Ce;const $e=(O,k)=>{const q=Ie-O,G=Ce-k;D+=q,I+=G,Ie=O,Ce=k,te()},xe=O=>{const[k,q]=Oe(O);if(!(pe!=null&&!Be(O))){switch(t){case v:Ie=k,Ce=q;break;case l:N=new ee(m),x.lineWidth=5,x.lineJoin="round",x.strokeStyle=N.lineColor,x.beginPath();break;case h:N=new be(m),N.setStart(...fe(k,q));break;case c:break;case i:N=new ge(m),N.setStart(...fe(k,q));break;case u:break;default:throw new Error(`${t.toString()} is not supported`)}pe=t,ke(O)}},ke=O=>{if(pe==null)return;const[k,q]=Oe(O);switch(pe){case v:$e(k,q);break;case l:Me(k,q);break;case i:case h:ye(k,q);break;case c:break;case u:Fe(k,q);break;default:throw new Error(`${pe.toString()} is not supported`)}},We=(O,k=he,q=we)=>{O.normalizeCoords();const[G,z,Q,V]=O.getBox(),[Z,ae,ve,re]=[z,G,z+V,G+Q];return Z>q||ae>k||re<0||ve<0},He=()=>{N=null,pe=null,Le(),Ee()},qe=()=>{if(We(N)){He();return}const[O,k]=[0,0],[q,G]=[he,we],[z,Q]=[50,50];let[V,Z,ae,ve]=N.getBox();V<k&&(ae-=k-V,V=k),Z<O&&(ve-=O-Z,Z=O),V+ae>q&&(ae-=V+ae-q),Z+ve>G&&(ve-=Z+ve-G),ae<z&&(ae=z,V-=Math.max(0,V+ae-q)),ve<Q&&(ve=Q,Z-=Math.max(0,Z+ve-G));const[re,Re]=[q-V,G-Z],De=Ue=>`${Math.round(Ue/window.devicePixelRatio)}px`;N.setStart(V,Z),N.setEnd(V+ae,Z+ve),this.setTool(c),pe=c,M(),B.value="",B.style.minWidth=De(z),B.style.minHeight=De(Q),B.style.maxWidth=De(re),B.style.maxHeight=De(Re),B.style.font=N.getFont(),B.style.color=N.getColor(),setTimeout(()=>B.focus(),50)},Xe=O=>{if(!O||O.type==="mousedown"){if(!O||O.target===P){const k=B.value.trim();k.length>0&&(N.finishEditing(),N.setText(k),X(N))}He(),t===c&&this.setTool(h)}},et=(O,k,q=he,G=we)=>O<0||O>q||k<0||k>G,ot=O=>{const k=[],q=[],G=O.getPoints();let z=!0;for(let Q=0;Q<G.length;Q+=2){const[V,Z]=[G[Q],G[Q+1]];if(z)if(et(V,Z)){if(k.length>0){k.push(V,Z);const ae=new ee(O.getLineColor(),k);k.splice(0,k.length),q.push(ae)}z=!1}else k.push(V,Z);else et(V,Z)||(k.push(G[Q-2],G[Q-1]),k.push(V,Z),z=!0)}if(k.length>0){const Q=new ee(O.getLineColor(),k);k.splice(0,k.length),q.push(Q)}return q},Be=O=>{switch(pe){case null:return!0;case h:return qe(O),!1;case c:return Xe(O),!1;case l:case i:case u:case v:break;default:throw new Error(`${pe.toString()} is not supported`)}if(pe===i&&(We(N)||X(N)),pe===l){const k=ot(N);for(const q of k)X(q)}return He(),!0};r=()=>t!==c&&Be(),b=()=>t===c&&this.setTool(h);const tt=O=>O==v||O==l||O==u;P.addEventListener("mousedown",O=>xe(O));let Ke=null;const nt=O=>{if(Ke===null)return null;for(const k of O)if(k.identifier===Ke)return k;return null};P.addEventListener("touchstart",O=>{const k=O.targetTouches[0];Ke=k.identifier,xe(k)}),P.addEventListener("mousemove",O=>{O.buttons===1?pe==null&&tt(t)?xe(O):ke(O):pe!=null&&Be(O)}),P.addEventListener("touchmove",O=>{const k=nt(O.touches);k!=null?pe==null&&tt(t)?xe(k):ke(k):pe!=null&&Be()}),P.addEventListener("mouseup",O=>Be(O)),P.addEventListener("touchend",O=>{const k=nt(O.changedTouches);k!=null&&(Be(k),Ke=null)}),P.addEventListener("mouseout",O=>Be(O)),this.testIndexed=()=>{const O=W-D,k=J-I;x.fillStyle="rgba(255, 255, 255, 1)",x.fillRect(O,k,he,we),x.drawImage(Ne,O,k)},this.showCopied=()=>g.setAttribute("data-was-copied",!0),this.hideCopied=()=>g.removeAttribute("data-was-copied"),this.showDownloaded=()=>g.setAttribute("data-was-downloaded",!0),this.hideDownloaded=()=>g.removeAttribute("data-was-downloaded"),this.setVisible=()=>{g.setAttribute("data-is-visible",!0),setTimeout(()=>ne(),200)},this.setHidden=()=>g.removeAttribute("data-is-visible"),new ResizeObserver(()=>{ie(),te()}).observe(g),new MutationObserver(()=>{ne()}).observe(g,{attributeFilter:["style"]})}ScreenshotEditor.ToolType={MOVE:Symbol("MOVE"),PEN:Symbol("PEN"),ERASER:Symbol("ERASER"),RECT:Symbol("RECT"),TEXT:Symbol("TEXT"),EDIT:Symbol("EDIT")},ScreenshotEditor.ColorType={RED:Symbol("RED"),GREEN:Symbol("GREEN"),BLUE:Symbol("BLUE"),YELLOW:Symbol("YELLOW"),BLACK:Symbol("BLACK"),WHITE:Symbol("WHITE")};function ScreenshotManager({minSize:g=15}={}){if(!(this instanceof ScreenshotManager))return new ScreenshotManager(...arguments);let S=!1,E=null,d=null,v=null,l=document.createElement("canvas"),i=null,h=null;const c=({x:b,y:w,width:A,height:R})=>({x:A<0?b+A:b,y:R<0?w+R:w,width:A<0?-A:A,height:R<0?-R:R}),u=({width:b,height:w})=>b<g&&w<g||b<1||w<1,a=()=>{i!=null&&i.onScreenUpdate()},t=()=>{if(h!=null&&S){const{ctx:b,width:w,height:A}=h;b.clearRect(0,0,w,A);const R=h.contentToCanvas(0,0,l.width,l.height);if(b.drawImage(l,...R),b.fillStyle="rgba(255, 255, 255, 0.6)",b.fillRect(0,0,w,A),E!=null){const{x:T,y:L,width:P,height:_}=E;b.clearRect(T,L,P,_),b.save(),b.beginPath(),b.rect(T,L,P,_),b.clip(),b.drawImage(l,...R),b.restore(),b.strokeStyle="red",b.strokeRect(T,L,P,_)}}};document.addEventListener("keydown",b=>{b.key==="Escape"&&S&&this.cancelScreenshot()}),this.onScreenshotStart=()=>{},this.onScreenshotMove=()=>{},this.onScreenshotCancel=()=>{},this.onScreenshotFinish=()=>{};const r=()=>{E=null,this.onScreenshotStart()},y=(b,w)=>{if(!b||!w)return null;const{x:A,y:R,width:T,height:L}=c(b),{x:P,y:_,width:C,height:D}=c(w),I=Math.max(A,P),x=Math.max(R,_),W=Math.min(A+T,P+C)-I,J=Math.min(R+L,_+D)-x;return I+W<=P||x+J<=_||I>=P+C||x>=_+D?null:c({x:I,y:x,width:W,height:J})},f=()=>{const b=h.contentSize,[w,A,R,T]=h.contentToCanvas(0,0,b.width,b.height);return{x:w,y:A,width:R,height:T}},p=()=>{const b=f(),w=y(E,b);if(!w||u(w)){r();return}const[A,R,T,L]=h.canvasToContent(w.x,w.y,w.width,w.height);if(console.log(`[Screenshot] Screenshot taken: ${A}, ${R} ${T}\xD7${L}`),T<=0||L<=0){Logging.userError("screenshot_manager_region",{screenRect:h.contentRect,contentSize:h.contentSize,contentRect:b,minRect:w,screenshotRegion:E,cutRegion:{x:A,y:R,width:T,height:L}}),r();return}const P=document.createElement("canvas");P.width=T,P.height=L,P.getContext("2d").drawImage(l,A,R,T,L,0,0,T,L),S=!1,E=null,this.onScreenshotFinish({image:P,platform:d,browser:v}),a()};this.startScreenshot=()=>{i!=null&&h!=null&&(S=!0,l.width=i.width,l.height=i.height,l.getContext("2d").drawImage(i.canvas,0,0),v=i.getLastNavigateBrowser(),d=i.getPlatform(),E=null,this.onScreenshotStart(),a())},this.cancelScreenshot=()=>{S=!1,E=null,this.onScreenshotCancel(),a()};let e,n,o,s;this.detach=()=>{h!=null&&i!=null&&(h.shouldDrawContentImage=n,h.onMouseEvent=s,h.onTouchEvent=o,this.cancelScreenshot(),h=null,i=null)};const m=b=>{if(e===null)return null;for(const w of b)if(w.identifier===e)return w;return null};this.attach=(b,w)=>{i=b,h=w,n=w.shouldDrawContentImage,w.shouldDrawContentImage=()=>S?(t(),!1):!0,o=w.onTouchEvent,w.onTouchEvent=A=>{if(S){const{event:R}=A;if(R.type==="touchstart"){if(e==null){const T=R.targetTouches[0];e=T.identifier;const[L,P]=w.getPosWithinTarget(T);E={x:L,y:P,width:0,height:0}}}else if(R.type==="touchmove"){const T=m(R.touches);if(T&&E!=null){const[L,P]=w.getPosWithinTarget(T);E.width=L-E.x,E.height=P-E.y}}else R.type==="touchend"&&m(R.changedTouches)&&(p(),e=null);R.preventDefault(),R.stopPropagation(),a();return}o.call(w,A)},s=w.onMouseEvent,w.onMouseEvent=A=>{if(S){const{event:R,x:T,y:L}=A;R.type==="mousedown"?E!=null?p():E={x:T,y:L,width:0,height:0}:R.type==="mouseup"?p():R.type==="mousemove"&&E!=null&&(E.width=T-E.x,E.height=L-E.y),a();return}return s.call(w,A)}}}const XXHash32=function(){const g=new TextEncoder,S=2654435761,E=2246822519,d=3266489917,v=668265263,l=374761393,i=function(t){return typeof t=="string"?g.encode(t):t instanceof ArrayBuffer?new Uint8Array(t):t},h=function(t,r){const y=t&65535,f=r&65535,p=t>>16&65535,e=r>>16&65535,n=y*f;return((y*e+p*f&65535)<<16)+n&4294967295},c=function(t,r){return t<<r|t>>>32-r},u=function(t,r){return(t[r+0]|t[r+1]<<8|t[r+2]<<16|t[r+3]<<24)>>>0},a=function(t=0){if(!(this instanceof a))return new a(...arguments);this.seed=t,this.init()};return a.prototype.init=function(){return this.size=0,this.total=0,this.memory=null,this.acc1=this.seed+S+E>>>0,this.acc2=this.seed+E>>>0,this.acc3=this.seed+0>>>0,this.acc4=this.seed-S>>>0,this},a.prototype.round=function(t,r,y,f){this.acc1=this.acc1+h(t,E)>>>0,this.acc1=c(this.acc1,13)>>>0,this.acc1=h(this.acc1,S)>>>0,this.acc2=this.acc2+h(r,E)>>>0,this.acc2=c(this.acc2,13)>>>0,this.acc2=h(this.acc2,S)>>>0,this.acc3=this.acc3+h(y,E)>>>0,this.acc3=c(this.acc3,13)>>>0,this.acc3=h(this.acc3,S)>>>0,this.acc4=this.acc4+h(f,E)>>>0,this.acc4=c(this.acc4,13)>>>0,this.acc4=h(this.acc4,S)>>>0},a.prototype.update=function(t){const r=i(t);let y=0;const f=r.length,p=y+f;if(f===0)return this;if(this.total+=f,this.size===0&&(this.memory=new Uint8Array(16)),this.size+f<16)return this.memory.set(r.subarray(0,f),this.size),this.size+=f,this;if(this.size>0){this.memory.set(r.subarray(0,16-this.size),this.size);const e=u(this.memory,0),n=u(this.memory,4),o=u(this.memory,8),s=u(this.memory,12);this.round(e,n,o,s),y+=16-this.size,this.size=0}if(y<=p-16){const e=p-16;do{const n=u(r,y+0),o=u(r,y+4),s=u(r,y+8),m=u(r,y+12);this.round(n,o,s,m),y+=16}while(y<=e)}return y<p&&(this.memory.set(r.subarray(y,p),this.size),this.size=p-y),this},a.prototype.converge=function(){return this.total<16?this.seed+l>>>0:c(this.acc1,1)+c(this.acc2,7)+c(this.acc3,12)+c(this.acc4,18)>>>0},a.prototype.digest=function(){let t=this.converge()+this.total,r=0;const y=this.size;for(;r<=y-4;){const f=u(this.memory,r);t=t+h(f,d)>>>0,t=c(t,17)>>>0,t=h(t,v)>>>0,r+=4}for(;r<y;){const f=this.memory[r]&255;t=t+h(f,l)>>>0,t=h(c(t,11),S)>>>0,r+=1}return t=(t^t>>>15)>>>0,t=h(t,E)>>>0,t=(t^t>>>13)>>>0,t=h(t,d)>>>0,t=(t^t>>>16)>>>0,this.init(),t},a}(),IDLE_TIMEOUT=30*60*1e3,FREE_PLAN_TIMER=3*60*1e3,FREE_PLAN_PLATFORM=Platform.WINDOWS_7,USE_NEW_QUEUE=!1,QUEUE_URL="ws://localhost:8000",LEGACY_QUEUE_URL="https://queue2.browserling.com",IS_PREMIUM=SESSION_PLAN!=="free",IS_LOGGED_IN=SESSION_EMAIL!==null,INIT_PLATFORM=Platform.BY_SLASH_NAME[SESSION_REQUEST[0]],INIT_BROWSER=Browser.BY_SLASH_NAME[SESSION_REQUEST[1]],INIT_URL=SESSION_REQUEST[2]||"",UPGRADE_URL="https://www.browserling.com/#pricing",FRONT_PAGE="https://www.browserling.com";let gDebugHook=()=>{},gBrowserScreen=null,gQueueUi=null,gMainMenu=null,gLoadingBar=null,gBottomInfoBar=null,gPremiumPopup=null,gTimesUp=null,gDisconnectedOverlay=null,gIdleTimeoutOverlay=null,gEncoder=null,gQueue=null,gWasConnectedOnce=!1,gScreenshotManager=null,gScreenshotEditor=null,gLocalTesting=null,gKeyboardWindow=null,gDisplaySettings=null;window.addEventListener("load",initializePage);function initializePage(){Logging.timeStart(new Date().getTime()),insertTemplatePlaceholders(),initUiElements(),initBrowserScreen(),initUserSettings(),listenForScripts(),Logging.browseRequest(INIT_PLATFORM,INIT_BROWSER,INIT_URL,"init"),connectToVm(INIT_PLATFORM,INIT_BROWSER,INIT_URL)}function getCanonicalUrl(g,S,E){const d=`${g.name}${g.version}`,v=`${S.name}${S.version}`;return`browse/${d}/${v}`+(E?`/${E}`:"")}function showWelcomeScreen(){if(!!SHOW_WELCOME_TO_NEW_UI&&(SafeStorage.getItem("welcome")===null&&(console.log("[Welcome] Dialog wasn't shown before"),SafeStorage.setItem("welcome","show")),SafeStorage.getItem("welcome")==="show")){const g=document.getElementById("group-popups"),S=new WelcomePopup(g);S.handleClose=E=>{E&&(console.log("[Welcome] Dialog will not be shown anymore"),SafeStorage.setItem("welcome","hide"))},S.setVisible()}}function updatePageUrl(g,S,E){history.replaceState(null,"","/"+getCanonicalUrl(g,S,E))}function checkInvalidRequest(){if(BROWSE_REQUEST_ERROR==="invalid_request"){const g=Browser.___HARDCODED___BROWSER___METADATA___[INIT_BROWSER.name].displayName,S=Platform.___HARDCODED___PLATFORM___METADATA___.get(INIT_PLATFORM).displayName,E=document.getElementById("group-popups"),d=new MessagePopup({titleText:"Invalid browse request",primaryButton:"Close",messageText:`
            You requested an invalid browser.
            Either the platform doesn't exist or the browser doesn't exist (or both).
            We defaulted to ${g} ${INIT_BROWSER.version} on ${S} instead as this combination works.
            Once you dismiss this dialog, you can use the menu on the left to switch to another browser.`});E.appendChild(d.popupElement),d.showPopup()}}function checkPremiumBrowser(){if(BROWSE_REQUEST_ERROR==="premium_browser"&&!IS_PREMIUM){const g=Browser.___HARDCODED___BROWSER___METADATA___[INIT_BROWSER.name].displayName,S=Platform.___HARDCODED___PLATFORM___METADATA___.get(INIT_PLATFORM).displayName,E=document.getElementById("group-popups"),d=new MessagePopup({titleText:"Premium browser",primaryButton:"Close",messageText:`
            You're on a free plan but requested a premium browser.
            We served you ${g} ${INIT_BROWSER.version} on ${S} instead as it's available to all free users. If you have the developer plan, please <a href="/">login</a> to use the browser you wanted.`});E.appendChild(d.popupElement),d.showPopup()}}async function copyToClipboardFromInput(g){if(!(g instanceof HTMLInputElement))throw new Error("Can only copy from <input> or <textarea>");return g.focus(),g.select(),navigator.clipboard&&navigator.clipboard.writeText&&await navigator.clipboard.writeText(g.value).then(()=>!0,()=>!1)?!0:document.execCommand("copy")}const API_TUNNEL_PING="/api/tunnel/ping",API_TUNNEL_OPEN="/api/tunnel/open",API_TUNNEL_CLOSE="/api/tunnel/close",API_TUNNEL_KEY_UPDATE="/api/tunnel/setPublicKey",API_TUNNEL_KEY_EXISTS="/api/tunnel/publicKeyExists",API_TUNNEL_LAST_HOST="/api/tunnel/get-last-tunnel",API_SAVE_SCREENSHOT="/api/account/screenshots/save",API_EMAIL_SCREENSHOT="/api/bug-hunter/email",API_IMGUR_SCREENSHOT="/api/bug-hunter/imgur",API_SEND_FEEDBACK="/api/feedback",API_GET_SHORT_URL="/api/short-url";function urlEncode(g){return Object.entries(g).map(S=>S.map(encodeURIComponent).join("=")).join("&")}async function sleepFor(g){return new Promise(S=>setTimeout(()=>S(),g))}async function apiRequest(g,S={},{method:E="POST"}={}){const d={method:E,headers:{},mode:"cors",cache:"no-cache",credentials:"include"};E!=="GET"&&E!=="HEAD"&&(S instanceof FormData?d.body=S:(d.body=urlEncode(S),d.headers["Content-Type"]="application/x-www-form-urlencoded",d.headers["Content-Length"]=d.body.length));let v=0;for(;;){const[l,i]=await fetch(g,d).then(h=>[h,null]).catch(h=>[null,h]);if(l!=null)return l.text();if(++v>=3)return`Error: ${i.message}`;await sleepFor(500)}}const API_REPORT_SCRIPT_LIST="/api/ui-all-scripts-list",API_REPORT_SCRIPT_CONTENT="/api/ui-all-scripts-upload";function listenForScripts(){const g=new Set,S=new XXHash32(0),E=/^(module|(application|text)\/(x-)?(java|ecma)script)$/,d=async c=>{let u=0;for(;;){const a=fetch(c,{method:"GET"}).then(t=>t.text()).catch(()=>null);if(a!=null)return a;if(++u>=3)return null;await sleepFor(500)}},v=async({type:c,script:u})=>c==="inline"?u.text:d(u.src),l=c=>{try{return JSON.parse(c)}catch(u){}return null},i=c=>c.replace(/rufEvent\d+/,"rufEvent0"),h=async()=>{const c=[];for(const t of document.scripts)if(!g.has(t)&&(g.add(t),!t.type||E.test(t.type)))if(t.src)c.push({type:"src",src:t.src,script:t});else{const r=i(t.text),y=S.update(r).digest();c.push({type:"inline",hash:y,script:t})}if(c.length===0)return;const u=await apiRequest(API_REPORT_SCRIPT_LIST,{list:JSON.stringify(c.map(t=>[t.type,t.hash||t.src]))});if(u.toLowerCase().indexOf("error")===0){Logging.userError("browse_scripts_error",{result:u});return}const a=l(u);if(!a){Logging.userError("browse_scripts_json_error",{result:u});return}for(const t of a){const r=c[t];if(!r){Logging.userError("browse_scripts_no_index",{index:t,result:u});continue}const y=await v(r);if(!y)continue;const f=new FormData;f.append(`script_type_${t}`,r.type),f.append(`script_info_${t}`,r.hash||r.src),f.append(`script_content_${t}`,y);const p=await apiRequest(API_REPORT_SCRIPT_CONTENT,f);p!=="ok"&&Logging.userError("browse_scripts_upload_error",{index:t,result:p})}};h(),new MutationObserver(c=>c.forEach(u=>{u.type==="childList"&&h()})).observe(document,{subtree:!0,childList:!0})}const SHORT_URL_CACHE=new Map;async function getShortUrl(g,S,E){const d="https://browserling.com/"+getCanonicalUrl(g,S,E);if(SHORT_URL_CACHE.has(d))return SHORT_URL_CACHE.get(d);const v=await apiRequest(API_GET_SHORT_URL,{url:d});if(v.toLowerCase().indexOf("error")===0)return Logging.userError("browse_short_url",{result:v}),null;const[,l]=v.split(" ");return SHORT_URL_CACHE.set(d,l),l}function upgradeToPremium(){window.location.href=UPGRADE_URL}function adjustDisplayScaleForHighDpiScreens(g=400){if(SafeStorage.getItem("scale")===null){const{x:S,y:E}=gBrowserScreen.contentRect,d=Math.min(S,E);d>g&&(gDisplaySettings.setScale(.5),console.log(`[ScaleAdjust] Browser screen too far from edge (${d}px), setting scale to 50%`))}}function initUserSettings(){SafeStorage.getItem("scale")!==null&&gDisplaySettings.setScale(parseFloat(SafeStorage.getItem("scale"))||0)}function initScreenshotEditor(){const g=document.getElementById("group-popups");gScreenshotEditor=new ScreenshotEditor({editorWindow:document.querySelector("#group-ui .screenshot-editor")});const S=(a,t)=>{const r=new MessagePopup({titleText:a,messageText:t});g.appendChild(r.popupElement),r.showPopup()},E=async()=>{try{const{state:a}=await navigator.permissions.query({name:"clipboard-write"});return a==="granted"}catch(a){return!1}},d=async a=>new Promise(t=>a.toBlob(r=>t(r),"image/png",1)),v=async a=>new Promise(t=>{const r=new FileReader;r.onload=()=>t(r.result),r.readAsDataURL(a)});let l=!1;gScreenshotEditor.onCopyToClipboard=async()=>{if(l)return;if(l=!0,Logging.uiEvent("browse.screenshot.clipboard"),!await E()){S("No clipboard permission","We can't copy this screenshot to clipboard without the browser's permission."),l=!1;return}const t=await d(gScreenshotEditor.getEditedImage("white")),r=()=>{gScreenshotEditor.showCopied(),setTimeout(()=>{gScreenshotEditor.hideCopied(),l=!1},1500)},y=f=>{S("Can't write to clipboard",`An error occurred while trying to write to clipboard: ${f.message}`),l=!1};try{const f=[new ClipboardItem({[t.type]:t})];navigator.clipboard.write(f).then(r,y)}catch(f){y(f)}};let i=!1;gScreenshotEditor.onDownloadToDevice=async()=>{if(i)return;i=!0,Logging.uiEvent("browse.screenshot.download");const a=await d(gScreenshotEditor.getEditedImage("white"));saveAs(a,"browserling-screenshot.png"),gScreenshotEditor.showDownloaded(),setTimeout(()=>{gScreenshotEditor.hideDownloaded(),i=!1},1500)};let h=!1;gScreenshotEditor.onSaveToAccount=async()=>{if(!IS_LOGGED_IN){S("Not logged in","You need to be logged in to save screenshots to your account.");return}if(!IS_PREMIUM){gPremiumPopup.setItemText("Saving screenshots"),gPremiumPopup.setDismissText("Keep using free version"),gPremiumPopup.setVisible();return}if(h)return;h=!0,Logging.uiEvent("browse.screenshot.save");const a=await d(gScreenshotEditor.getEditedImage("transparent")),t=await v(a),r=new ScreenshotSaveToAccountPopup({previewBlob:a}),y=async()=>{const f=await apiRequest(API_SAVE_SCREENSHOT,{image:t,title:r.getTitle(),desc:r.getDescription()});f==="ok"?S("Screenshot saved","Your screenshot has been saved to your account."):(S("Couldn't save screenshot",f||"An unknown error has occurred."),Logging.userError("browse_save_screenshot",{result:f})),r.dismissPopup(),h=!1};r.onUploadConfirm=()=>{r.setUploading(),y()},r.onDismiss=()=>{setTimeout(()=>g.removeChild(r.popupElement),200),h=!1},g.appendChild(r.popupElement),r.showPopup()};let c=!1;gScreenshotEditor.onSendOverEmail=async()=>{if(c)return;c=!0,Logging.uiEvent("browse.screenshot.email");const a=gScreenshotEditor.getScreenshotURL(),t=gScreenshotEditor.getScreenshotBrowser(),r=gScreenshotEditor.getScreenshotPlatform(),y=await d(gScreenshotEditor.getEditedImage("transparent")),f=await v(y),p=new ScreenshotSendOverEmailPopup({previewBlob:y}),e=()=>{const o=p.getEmailInput();return o.checkValidity()?!0:(o.reportValidity(),!1)},n=async()=>{console.log(r,t);const o=await apiRequest(API_EMAIL_SCREENSHOT,{image:f,email:p.getRecipient(),message:p.getMessage(),platform_name:r.name,platform_version:r.version,browser:t.name,version:t.version,url:a});o==="ok"?S("Screenshot sent",`Your screenshot was sent to ${p.getRecipient()}`):(S("Couldn't send screenshot",o||"An unknown error has occurred."),Logging.userError("browse_email_screenshot",{result:o})),p.dismissPopup(),c=!1};p.onSendConfirm=()=>{e()&&(p.setSending(),n())},p.onDismiss=()=>{setTimeout(()=>g.removeChild(p.popupElement),200),c=!1},g.appendChild(p.popupElement),p.showPopup()};let u=!1;gScreenshotEditor.onUploadToImgur=async()=>{if(u)return;u=!0,Logging.uiEvent("browse.screenshot.imgur");const a=gScreenshotEditor.getScreenshotURL(),t=gScreenshotEditor.getScreenshotBrowser(),r=gScreenshotEditor.getScreenshotPlatform(),y=await d(gScreenshotEditor.getEditedImage("transparent")),f=await v(y),p=new ScreenshotUploadToImgurPopup({previewBlob:y}),e=async()=>{const n=await apiRequest(API_IMGUR_SCREENSHOT,{image:f,message:p.getDescription(),platform_name:r.name,platform_version:r.version,browser:t.name,version:t.version,url:a});if(n.indexOf("ok")===0){const[,o,s]=n.split(" ");S("Screenshot uploaded",`Your screenshot has been uploaded to Imgur.<ul><li>Image URL: <a href="${o}" target="_blank">${o}</a></li><li>Delete hash: <a href="https://imgur.com/delete/${s}" target="_blank">${s}</a></li></ul>`)}else S("Couldn't upload screenshot",n||"An unknown error has occurred."),Logging.userError("browse_imgur_screenshot",{result:n});p.dismissPopup(),u=!1};p.onUploadConfirm=()=>{p.setUploading(),e()},p.onDismiss=()=>{setTimeout(()=>g.removeChild(p.popupElement),200),u=!1},g.appendChild(p.popupElement),p.showPopup()}}function initLocalTesting(){const g=document.getElementById("group-popups"),S=(e,n)=>{const o=new MessagePopup({titleText:e,messageText:n});g.appendChild(o.popupElement),o.showPopup()},E=(e,n,o="OK",s="")=>new Promise(m=>{const b=new MessagePopup({titleText:e,messageText:n,primaryButton:o,secondaryButton:s}),w=A=>{m(A),b.dismissPopup()};g.appendChild(b.popupElement),b.onPrimary=()=>w(!0),b.onSecondary=()=>w(!1),b.onEscPressed=()=>w(!1),b.showPopup()});gLocalTesting=new LocalTestingWindow({mainWindow:document.querySelector("#group-ui .tunnels-setup")}),IS_PREMIUM&&(apiRequest(API_TUNNEL_KEY_EXISTS).then(e=>{e==="exists"?(console.log("[LocalTesting] Public key exists"),gLocalTesting.setStepNumbers("1","2"),gLocalTesting.setScreen(LocalTestingWindow.SCREEN_OPEN_TUNNEL)):e.toLowerCase().indexOf("error")===0?(Logging.userError("browse_tunnel_key_exists",{result:e}),gLocalTesting.setScreen(LocalTestingWindow.SCREEN_LOADING)):(console.log("[LocalTesting] Public key does not exist"),gLocalTesting.setStepNumbers("2","3"),gLocalTesting.setScreen(LocalTestingWindow.SCREEN_ADD_KEY))}),apiRequest(API_TUNNEL_LAST_HOST,{},{method:"GET"}).then(e=>{e.toLowerCase().indexOf("error")!==0&&gLocalTesting.setAddress(e)})),gLocalTesting.handleAddKey=async e=>{if(!e){S("Couldn't update SSH key","You need to enter your public SSH key to continue.");return}if(!/^ssh-(rsa|dss|sha2)/.test(e)&&!await E("Unusual key format",'SSH keys usually begin with "ssh-rsa", "ssh-dss", or "ssh-sha2" but yours does not. Are you sure you want to add it anyway?',"Yes","Cancel"))return;const n=await apiRequest(API_TUNNEL_KEY_UPDATE,{key:e});if(n.toLowerCase().indexOf("error")===0){Logging.userError("browse_tunnel_key_update",{result:n}),S("Couldn't update SSH key",n||"An unknown error has occurred.");return}gLocalTesting.setScreen(LocalTestingWindow.SCREEN_OPEN_TUNNEL)};const d=e=>{try{return new URL(e).host}catch(n){}},v=e=>{const n=d(e)||e;return n.indexOf(":")===-1?n+":80":n},l=e=>e.replace(/[^a-zA-Z0-9]/g,"_").substr(0,32),i="ssh",h="plink.exe";let c=null,u=1e3,a=null;const t=()=>c?`http://tunnel.browserling.com:${c.remotePort}`:null;gLocalTesting.handleOpenInBrowser=()=>{gEncoder!==null&&gEncoder.navigateTo(gEncoder.getLastNavigateBrowser(),t())};const r=Symbol(),y=Symbol(),f=Symbol(),p=async()=>{if(!c)return;const{remotePort:e}=c,n=new Date().getTime(),o=await apiRequest(API_TUNNEL_PING+`/${e}`,{},{method:"GET"});if(!c)return;if(o==="ok")c.firstConnection!==f&&(c.firstConnection=f,gLocalTesting.handleOpenInBrowser(),u=3e3),gLocalTesting.setPingIcon("#icon-check-circle"),gLocalTesting.setPingState("success"),gLocalTesting.setPingStatus("Connected!"),gLocalTesting.setPingDetail(`Your local server is available via <a class="opens-link">${t()}</a>`);else if(o==="error: got nothing")c.firstConnection===r&&(c.firstConnection=y),gLocalTesting.setPingIcon("#icon-triangle"),gLocalTesting.setPingState("warning"),gLocalTesting.setPingStatus("Empty webserver response"),gLocalTesting.setPingDetail("There is no data coming from your webserver, it might be offline.");else if(o==="error: timeout")gLocalTesting.setPingIcon("#icon-triangle"),gLocalTesting.setPingState("warning"),gLocalTesting.setPingStatus("Connection timeout"),gLocalTesting.setPingDetail("The connection has timed out.");else if(o==="error: couldn't connect")c.firstConnection===r?(gLocalTesting.setPingIcon("#icon-wifi"),gLocalTesting.setPingState("idle"),gLocalTesting.setPingStatus("Waiting for connection..."),gLocalTesting.setPingDetail("Your local server will be accessible when you run the SSH command.")):(gLocalTesting.setPingIcon("#icon-triangle"),gLocalTesting.setPingState("warning"),gLocalTesting.setPingStatus("Connection lost"),gLocalTesting.setPingDetail("We've lost connection to your SSH tunnel."));else if(o.indexOf("error: unknown")===0){const[,b]=o.match(/^error: unknown \((.*)\)/);gLocalTesting.setPingIcon("#icon-triangle"),gLocalTesting.setPingState("warning"),gLocalTesting.setPingStatus("Connection error"),gLocalTesting.setPingDetail(`Couldn't establish connection to the tunnel (${b})`)}else{gLocalTesting.setPingIcon("#icon-alert-circle"),gLocalTesting.setPingState("error"),gLocalTesting.setPingStatus("Connection error"),gLocalTesting.setPingDetail("An unknown connection error has occurred."),Logging.userError("browse_tunnel_ping",{result:o});return}const m=new Date().getTime()-n;m<u?a=setTimeout(p,u-m):a=setTimeout(p,1)};gLocalTesting.handleOpenTunnel=async e=>{if(!e){S("Couldn't open tunnel","You need to enter the address that you want to tunnel.");return}const n=await apiRequest(API_TUNNEL_OPEN,{host:e});if(n.toLowerCase().indexOf("error")===0){Logging.userError("browse_tunnel_open",{result:n}),S("Couldn't open SSH tunnel",n||"An unknown error has occurred.");return}c={firstConnection:r,remotePort:parseInt(n),localHost:v(e),unixEmail:l(SESSION_EMAIL||"")},gLocalTesting.handleUpdateCommand(i),gLocalTesting.setPingIcon("#icon-wifi"),gLocalTesting.setPingState("idle"),gLocalTesting.setPingStatus("Waiting for connection..."),gLocalTesting.setPingDetail("Your local server will be accessible when you run the SSH command."),gLocalTesting.setScreen(LocalTestingWindow.SCREEN_RUN_COMMAND),u=1e3,p()},gLocalTesting.handleUpdateCommand=e=>{if(!c)return"";const{remotePort:n,localHost:o,unixEmail:s}=c;switch(e){case i:gLocalTesting.setCommand(`ssh -NR ${n}:${o} ${s}@tunnel.browserling.com`),gLocalTesting.setNextProgramName(h);break;case h:gLocalTesting.setCommand(`plink.exe -N -R ${n}:${o} ${s}@tunnel.browserling.com`),gLocalTesting.setNextProgramName(i);break;default:throw new Error("Unknown SSH program: "+e)}},gLocalTesting.handleCloseTunnel=async()=>{if(!c)return;const{remotePort:e}=c,n=await apiRequest(API_TUNNEL_CLOSE+`/${e}`);if(n.toLowerCase().indexOf("error")===0){Logging.userError("browse_tunnel_key_close",{result:n}),S("Couldn't close SSH tunnel",n||"An unknown error has occurred.");return}c=null,clearTimeout(a),a=null,gLocalTesting.setScreen(LocalTestingWindow.SCREEN_OPEN_TUNNEL)},gLocalTesting.handleCopyToClipboard=async e=>copyToClipboardFromInput(e)}function initDisplaySettings(){gDisplaySettings=new DisplaySettingsWindow({mainWindow:document.querySelector("#group-ui .display-settings")});let g=0;gDisplaySettings.onResolutionChange=(E,d)=>{if(gEncoder!==null){const v=++g;Logging.uiEvent(`browse.set-resolution.${E}x${d}`),gLoadingBar.setText(`Switching to ${E}\xD7${d}...`),gDisplaySettings.setSwitchingResolution(!0),gLoadingBar.setVisible(),gEncoder.setResolution(E,d),setTimeout(()=>{v===g&&(gDisplaySettings.setSwitchingResolution(!1),gLoadingBar.setHidden())},2e3)}},gDisplaySettings.onScaleChange=E=>{const d=E/100;gBrowserScreen.setContentFit(d),SafeStorage.setItem("scale",d)};let S=!1;gDisplaySettings.onSliderRelease=()=>{S||(S=!0,Logging.uiEvent("browse.set-resolution.slider"))},gDisplaySettings.onEncoderReconnect=()=>{gDisplaySettings.setEncoderNotAvailable(!0)},gDisplaySettings.onEncoderRunning=()=>{gDisplaySettings.setEncoderNotAvailable(!1),gDisplaySettings.setSwitchingResolution(!1),gEncoder.getPlatform().name==="android"?gDisplaySettings.setNoResolutions(!0):gDisplaySettings.setNoResolutions(!1)},gDisplaySettings.onEncoderScreenResize=(E,d)=>{gDisplaySettings.setActiveResolution(E,d),gDisplaySettings.setSwitchingResolution(!1)}}let gSessionIdleTimeout=null;const resetIdleTimeout=()=>{gSessionIdleTimeout!==null&&clearTimeout(gSessionIdleTimeout),gSessionIdleTimeout=setTimeout(()=>{console.log("[IdleTimeout] Disconnecting because of inactivity"),Logging.browseStats("idletimeout"),gIdleTimeoutOverlay.setVisible(),gEncoder!==null&&(gEncoder.destroy(),gEncoder=null),gQueue!==null&&(gQueue.destroy(),gQueue=null)},IDLE_TIMEOUT)};function initUiElements(){IS_PREMIUM&&document.body.setAttribute("data-has-premium-plan",!0),initScreenshotEditor(),initLocalTesting(),initDisplaySettings(),gKeyboardWindow=new KeyboardWindow({mainWindow:document.querySelector("#group-ui .virtual-keyboard")}),gScreenshotManager=new ScreenshotManager;let g=!1,S=!1,E=!1;const d=()=>{E=gDisplaySettings.isVisible(),S=gLocalTesting.isVisible(),g=gKeyboardWindow.isVisible(),gDisplaySettings.setHidden(),gKeyboardWindow.setHidden(),gLocalTesting.setHidden(),gMainMenu.setHidden()},v=()=>{gMainMenu.setVisible(),E&&gDisplaySettings.setVisible(),S&&gLocalTesting.setVisible(),g&&gKeyboardWindow.setVisible(),E=!1,S=!1,g=!1};gScreenshotManager.onScreenshotStart=()=>{document.body.setAttribute("data-taking-a-screenshot",!0),gBottomInfoBar.setIcon("#icon-crop"),gBottomInfoBar.setText("Drag the cursor around the area you want to capture"),gScreenshotEditor.setHidden(),gBottomInfoBar.setVisible(),d()},gScreenshotManager.onScreenshotCancel=()=>{document.body.removeAttribute("data-taking-a-screenshot"),gBottomInfoBar.setHidden(),v()},gScreenshotManager.onScreenshotFinish=({image:s,platform:m,browser:b})=>{document.body.removeAttribute("data-taking-a-screenshot"),gBottomInfoBar.setHidden(),v(),gScreenshotEditor.setScreenshotData(s,m,b),gScreenshotEditor.centerWindow(s.width,s.height),gScreenshotEditor.setVisible(),gScreenshotEditor.bringToTop()},gMainMenu=new MainMenu({menuElement:document.getElementById("main-menu")}),gMainMenu.setVisible();const l=Platform.___HARDCODED___PLATFORM___DATA___,i=s=>Browser.___HARDCODED___BROWSER___METADATA___[s.name].displayName,h=s=>Platform.___HARDCODED___PLATFORM___METADATA___.get(s).displayName,c=s=>Browser.___HARDCODED___BROWSER___SUPPORT___INFO___.get(s);let u=null,a=INIT_PLATFORM,t=INIT_BROWSER;gMainMenu.setPlatforms(l),gMainMenu.setBrowsers(c(a)),gMainMenu.setSelectedPlatform(a),gMainMenu.setSelectedBrowser(t),gMainMenu.setCurrentUrl(INIT_URL),gMainMenu.onPlatformSelected=s=>{Logging.uiEvent("browse.menu.platform-select"),IS_PREMIUM?s!==a&&(u=s,gMainMenu.setSelectedPlatform(s),gMainMenu.setBrowsers(c(s),!1),gMainMenu.requestBrowserSelection(),gMainMenu.showBrowserList()):(s!==FREE_PLAN_PLATFORM&&(gPremiumPopup.setItemText(h(s)),gPremiumPopup.setDismissText(`Stay on ${h(FREE_PLAN_PLATFORM)}`),gPremiumPopup.setVisible()),gMainMenu.setSelectedPlatform(FREE_PLAN_PLATFORM)),gMainMenu.hidePlatformList()},gMainMenu.onBrowserListHidden=()=>{u!==null&&(gMainMenu.setSelectedPlatform(a),gMainMenu.setSelectedBrowser(t),gMainMenu.setBrowsers(c(a)),u=null)};const r=(s,m)=>{const b=gMainMenu.getCurrentUrl();a=s,t=m,Logging.browseRequest(a,t,b,"navigate"),updatePageUrl(a,t,b),connectToVm(a,t,b),gLoadingBar.setText(`Switching to ${h(s)}...`),gLoadingBar.setVisible()},y=s=>{const m=gMainMenu.getCurrentUrl();t=s,Logging.browseRequest(a,t,m,"navigate"),updatePageUrl(a,t,m),gLoadingBar.setText(`Switching to ${i(s)} ${s.version}...`),gLoadingBar.setVisible(),gEncoder===null||!gEncoder.isBrowserAvailable(s)?connectToVm(a,t,m):(gEncoder.navigateTo(s,m),setTimeout(()=>gLoadingBar.setHidden(),2e3),resetIdleTimeout())};gMainMenu.onBrowserSelected=s=>{if(Logging.uiEvent("browse.menu.browser-select"),u!==null){const m=u;u=null,gMainMenu.setSelectedBrowser(s),gMainMenu.setSelectedPlatform(m),gMainMenu.hideBrowserList(),r(m,s)}else gMainMenu.setSelectedBrowser(s),gMainMenu.hideBrowserList(),y(s)},gMainMenu.onUrlSubmit=()=>{const s=gMainMenu.getCurrentUrl();Logging.uiEvent("browse.menu.url-submit"),Logging.browseRequest(a,t,s,"navigate"),gEncoder!==null&&(updatePageUrl(a,t,s),gEncoder.navigateTo(t,s),resetIdleTimeout())},gMainMenu.onPremiumUpgrade=()=>{Logging.uiEvent("browse.menu.upgrade"),upgradeToPremium("browse_menu")},gMainMenu.onSetResolution=()=>{gDisplaySettings.isVisible()?gDisplaySettings.setHidden():(Logging.uiEvent("browse.menu.set-resolution"),gDisplaySettings.centerWindow(),gDisplaySettings.setVisible(),gDisplaySettings.bringToTop())},gMainMenu.onScreenCapture=()=>{Logging.uiEvent("browse.menu.capture-screen"),gScreenshotManager.startScreenshot()},gMainMenu.onLocalTesting=()=>{IS_PREMIUM?gLocalTesting.isVisible()?gLocalTesting.setHidden():(Logging.uiEvent("browse.menu.local-testing"),gLocalTesting.centerWindow(),gLocalTesting.setVisible(),gLocalTesting.bringToTop()):(Logging.uiEvent("browse.menu.local-testing"),gPremiumPopup.setItemText("SSH tunnels"),gPremiumPopup.setDismissText("Keep testing public sites"),gPremiumPopup.setVisible(),gLocalTesting.setHidden())},gMainMenu.onShowKeyboard=()=>{gKeyboardWindow.isVisible()?gKeyboardWindow.setHidden():(Logging.uiEvent("browse.menu.show-keyboard"),gKeyboardWindow.centerWindow(),gKeyboardWindow.setVisible(),gKeyboardWindow.bringToTop())};const f=document.getElementById("group-popups"),p=(s,m,b="OK",w="")=>new Promise(A=>{const R=new MessagePopup({titleText:s,messageText:m,primaryButton:b,secondaryButton:w}),T=L=>{A(L),R.dismissPopup()};f.appendChild(R.popupElement),R.onPrimary=()=>T(!0),R.onSecondary=()=>T(!1),R.onEscPressed=()=>T(!1),R.showPopup()}),e=new ShareBrowserPopup({popupContainer:f});e.handleCopyToClipboard=async s=>copyToClipboardFromInput(s),e.handleUpdateUrl=async s=>{const m=[a,t,gMainMenu.getCurrentUrl()];if(s){const b=await getShortUrl(...m).catch(()=>null);if(b!=null){e.setUrl("https://browserling.com/b/"+b);return}e.setShortenUrl(!1)}e.setUrl("https://browserling.com/"+getCanonicalUrl(...m))},gMainMenu.onShareBrowser=()=>{Logging.uiEvent("browse.menu.share-browser"),e.setVisible()};const n=document.getElementById("group-overlays"),o=new SendFeedbackPopup({popupContainer:n});o.getUserEmail=()=>SESSION_EMAIL||"",o.handleSend=async()=>{const s=o.getEmail(),m=o.getMessage();if(s.length>0&&!/.+@.+\..+/.test(s)){await p("Couldn't send feedback","The e-mail address you've entered is invalid. If you want to submit your feedback anonymously, please leave the the e-mail field empty.");return}if(!m||m.length<20){await p("Couldn't send feedback","Your message must be at least 20 characters long.");return}const b=await apiRequest(API_SEND_FEEDBACK,{email:s,message:m});if(b.toLowerCase().indexOf("error")===0){Logging.userError("browse_send_feedback",{result:b}),await p("Couldn't send feedback",b||"An unknown error has occurred.");return}p("Feedback sent","Your feedback has been successfully submitted."),o.setHidden()},gMainMenu.onSendFeedback=()=>{Logging.uiEvent("browse.menu.send-feedback"),o.setVisible()},gMainMenu.onEndSession=()=>{gEncoder!==null&&(gEncoder.destroy(),gEncoder=null),Logging.uiEvent("browse.menu.end-session"),window.location.href=FRONT_PAGE},gQueueUi=new QueueOverlay({queueScreen:document.getElementById("queue"),queueTitle:document.getElementById("queue-title"),queuePremium:document.getElementById("queue-title-premium"),queueTime:document.getElementById("queue-time"),queuePosition:document.getElementById("queue-position"),invalidRequestError:document.getElementById("queue-error-text"),upgradeButtons:document.getElementById("queue").querySelectorAll(".upgrade-to-premium")}),gQueueUi.onUpgrade=(s="queue")=>{Logging.uiEvent(`browse.${s}.upgrade`),upgradeToPremium(`browse_${s}`)},gQueueUi.setScreen(QueueOverlay.CONNECTING),gLoadingBar=new LoadingBar({loadingBarElement:document.getElementById("loading-bar"),loadingBarText:document.getElementById("loading-bar-text")}),gBottomInfoBar=new BottomInfoBar({infoBarElement:document.getElementById("info-tooltip"),infoBarText:document.getElementById("info-tooltip").querySelector(".text"),infoBarIcon:document.getElementById("info-tooltip").querySelector("svg use")}),gPremiumPopup=new PremiumPopup({popupElement:document.getElementById("popup-premium-plan"),itemText:document.getElementById("premium-popup-item-placeholder"),dismissText:document.getElementById("premium-popup-dismiss-placeholder"),dismissButtons:document.getElementById("popup-premium-plan").querySelectorAll(".dismiss-popup"),upgradeButtons:document.getElementById("popup-premium-plan").querySelectorAll(".upgrade-to-premium")}),gPremiumPopup.onDismiss=()=>gPremiumPopup.setHidden(),gPremiumPopup.onUpgrade=()=>{Logging.uiEvent("browse.premium-popup.upgrade"),upgradeToPremium("browse_premium_popup")},gTimesUp=new TimesUpOverlay({timesUpScreen:document.getElementById("times-up"),upgradeButtons:document.getElementById("times-up").querySelectorAll(".upgrade-to-premium")}),gTimesUp.onUpgrade=()=>{Logging.uiEvent("browse.times-up.upgrade"),upgradeToPremium("browse_times_up")},gDisconnectedOverlay=new DisconnectedOverlay({disconnectedScreen:document.getElementById("browser-disconnected")}),gIdleTimeoutOverlay=new IdleTimeoutOverlay({idleTimeoutScreen:document.getElementById("idle-timeout"),reconnectButton:document.getElementById("idle-timeout").querySelector("button.primary")}),gIdleTimeoutOverlay.onReconnect=()=>{Logging.uiEvent("browse.idle-timeout.reconnect"),gIdleTimeoutOverlay.setHidden(),gLoadingBar.setText("Reconnecting..."),gLoadingBar.setVisible(),connectToVm(a,t,gMainMenu.getCurrentUrl())}}function initBrowserScreen(){gBrowserScreen=new BrowserScreen,gBrowserScreen.canvas.id="browser",gBrowserScreen.canvas.tabIndex=0,gBrowserScreen.canvas.autofocus=!0;const g=document.querySelector("main");g.insertBefore(gBrowserScreen.canvas,g.firstChild),gBrowserScreen.canvas.focus()}function importTemplateById(g){const S=document.getElementById(g);return document.importNode(S.content,!0)}function insertTemplatePlaceholders(){for(const g of document.querySelectorAll(".placeholder-feature-list")){const S=importTemplateById("template-feature-list").firstElementChild;g.parentNode.replaceChild(S,g)}}const QueueResult={RECONNECT:Symbol("RECONNECT"),SUCCESSFUL:Symbol("SUCCESSFUL"),UNSUCCESSFUL:Symbol("UNSUCCESSFUL")};async function waitForQueueResult(g,S){if(g.state!==(USE_NEW_QUEUE?Queue:LegacyQueue).READY_TO_CONNECT)throw new Error(`Queue must be in READY_TO_CONNECT state, not ${g.state}`);return new Promise(E=>{S||gQueueUi.setScreen(QueueOverlay.CONNECTING),g.onConnected=()=>{console.log("[Queue] Connected")},g.onQueueStart=(d,v)=>{console.log(`[Queue] Queue started, ${d} in queue, ${v} servers online`),S||(gQueueUi.queueSize=d,gQueueUi.serverCount=v,gQueueUi.updateQueueStatus(),gQueueUi.setScreen(QueueOverlay.WAITING))},g.onQueueUpdate=(d,v)=>{console.log(`[Queue] Your position: ${d}/${v}`),S||(gQueueUi.queueSize=v,gQueueUi.yourPosition=d,gQueueUi.updateQueueStatus())},g.onInvalidRequest=d=>{Logging.browseStats("que_invalid"),console.log(`[Queue] Invalid request: ${d}`),gQueueUi.setInvalidRequestError(d),gQueueUi.setScreen(QueueOverlay.INVALID_REQUEST),E([QueueResult.UNSUCCESSFUL])},g.onFreeLimitReached=()=>{Logging.browseStats("freelimit"),console.log("[Queue] Free limit reached"),gQueueUi.setScreen(QueueOverlay.LIMIT_REACHED),E([QueueResult.UNSUCCESSFUL])},g.onDisconnected=()=>{Logging.browseStats("que_disconnect"),console.log("[Queue] Disconnected"),E([QueueResult.RECONNECT])},g.onDestroyed=()=>{console.log("[Queue] Destroyed"),E([QueueResult.UNSUCCESSFUL])},g.onError=d=>{Logging.browseStats("que_error"),console.log(`[Queue] Error: ${d}`),gQueueUi.setInvalidRequestError(d),gQueueUi.setScreen(QueueOverlay.INVALID_REQUEST),E([QueueResult.UNSUCCESSFUL])},g.onYourTurn=(d,v,l)=>{console.log(`[Queue] Your turn, connect to ${v} through port ${l}, job ID is ${d}`),S?gLoadingBar.setText("Connecting to your browser..."):gQueueUi.setScreen(QueueOverlay.YOUR_TURN),E([QueueResult.SUCCESSFUL,{jobId:d,encoderUrl:v,multiplexPort:l}])},g.connect()})}const IS_WEBP_SUPPORTED=(()=>{try{return document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")===0}catch(g){return!1}})();let gPlanTimerExpireAt=null;async function connectToVm(g,S,E){typeof connectToVm.nextId=="undefined"&&(connectToVm.nextId=0);const d=++connectToVm.nextId;gSessionIdleTimeout!==null&&clearTimeout(gSessionIdleTimeout),console.log(`[Connect] Connecting to ${S} on ${g} and requesting ${E}`),document.body.setAttribute("data-is-reconnecting",!0),gDisplaySettings.onEncoderReconnect(),gScreenshotManager.detach(),gKeyboardWindow.detach(),gEncoder!==null&&(console.log("[Connect] Disconnecting from current encoder..."),gEncoder.destroy(),gEncoder=null),gQueue!==null&&(console.log("[Connect] Disconnecting from current queue..."),gQueue.destroy(),gQueue=null),USE_NEW_QUEUE?gQueue=new Queue({sessionPayload:SESSION_PAYLOAD,queueUrl:QUEUE_URL,browseRequest:{platform_name:g.name,platform_version:g.version,browser_name:S.name,browser_version:S.version,url:E}}):gQueue=new LegacyQueue({queueUrl:LEGACY_QUEUE_URL,accessToken:`${SESSION_PLAN}/${SESSION_EMAIL||""}`,platform:g,browser:S});const v=IS_PREMIUM&&gWasConnectedOnce,[l,i]=await waitForQueueResult(gQueue,v);if(d!==connectToVm.nextId)return;if(gQueue=null,l===QueueResult.RECONNECT){console.log("[Connect] Reconnecting to queue..."),setTimeout(()=>connectToVm(g,S,E),1e3);return}else if(l===QueueResult.UNSUCCESSFUL){console.log("[Connect] Connection cancelled");return}Logging.browseStats("yourturn"),console.log("[Connect] Connecting to encoder..."),gEncoder=new Encoder({jobId:i.jobId,encoderUrl:i.encoderUrl,multiplexPort:i.multiplexPort,isOutdatedClient:!1,isWebpSupported:IS_WEBP_SUPPORTED}),g.name==="android"&&(gEncoder.__defaultResolutionThatShouldBeReceivedFromEncoder__setThisTo480x800IfPlatformIsAndroid__=[480,800]),gEncoder.__platformTypeAcknowledgeThatShouldBeReceivedFromEncoder__setThisToThePlatformYouConnectToForNow=g;let h=null;const c=()=>{h!==null&&(clearInterval(h),h=null)},u=()=>{c(),gTimesUp.setVisible(),Logging.browseStats("timesup"),gEncoder!==null&&gEncoder.destroy()},a=()=>{if(gPlanTimerExpireAt===null){gMainMenu.updateTimer("--","--");return}const n=new Date().getTime(),o=Math.round((gPlanTimerExpireAt-n)/1e3),s=Math.floor(o/60),m=Math.floor(o%60),b=w=>w<=0?"00":w<10?`0${w}`:`${w}`;gMainMenu.updateTimer(b(s),b(m)),o<=0&&(console.log("[Encoder] Client-side session timer ran out"),u())},t=(n=0)=>{gPlanTimerExpireAt===null&&(gPlanTimerExpireAt=new Date().getTime()+n),h===null&&(h=setInterval(a,1e3),a())};gEncoder.onDestroyed=()=>{clearTimeout(gSessionIdleTimeout),c()},gEncoder.onRunning=()=>{console.log("[Encoder] Running"),Logging.browseStats("confirmedid"),resetIdleTimeout(),gDisplaySettings.onEncoderRunning(),gKeyboardWindow.attach(gBrowserScreen),gScreenshotManager.attach(gEncoder,gBrowserScreen),document.body.removeAttribute("data-is-reconnecting"),gWasConnectedOnce||(adjustDisplayScaleForHighDpiScreens(),checkPremiumBrowser(),checkInvalidRequest(),showWelcomeScreen()),gWasConnectedOnce=!0,gQueueUi.setScreen(QueueOverlay.HIDDEN),gLoadingBar.setHidden(),gEncoder.navigateTo(S,E),IS_PREMIUM||t(FREE_PLAN_TIMER)},gEncoder.onScreenResize=()=>{console.log(`[Encoder] Screen resized to ${gEncoder.width}\xD7${gEncoder.height}`),gDisplaySettings.onEncoderScreenResize(gEncoder.width,gEncoder.height),gBrowserScreen.contentSize.width=gEncoder.width,gBrowserScreen.contentSize.height=gEncoder.height,gBrowserScreen.updateContentRect(),gBrowserScreen.onViewportChanged(),gLoadingBar.setHidden()},gEncoder.onTimeOut=()=>{console.log("[Encoder] Server session time out"),u()};const r=()=>{if(gPlanTimerExpireAt!==null)return gPlanTimerExpireAt-new Date().getTime()};gEncoder.onDisconnected=()=>{if(!IS_PREMIUM){const n=r();if(n<=0){console.log("[Encoder] Disconnected, already timed out");return}else if(n<=5e3){console.log("[Encoder] Disconnected, will time out shortly"),u();return}}clearTimeout(gSessionIdleTimeout),Logging.browseStats("enc_disconnect"),console.log("[Encoder] Disconnected"),gDisconnectedOverlay.setVisible()};const y=()=>{gEncoder!==null&&gBrowserScreen.drawContentImage(gEncoder.canvas,gEncoder.width,gEncoder.height)},f=n=>{switch(n){case 59:return 186;case 61:return 187;case 173:return 189;default:return n}},p=(n,o)=>(o&1<<n)==0?0:1;let e=0;gEncoder.onScreenUpdate=()=>y(),gBrowserScreen.onViewportChanged=()=>y(),gBrowserScreen.onKeyEvent=({event:n})=>{if(gEncoder===null)return;resetIdleTimeout();const o=n.type==="keydown",s=f(n.keyCode),m=n.shiftKey&&o?1:0;o?gEncoder.sendKeyDown(s,m):gEncoder.sendKeyUp(s,m)},gBrowserScreen.onMouseEvent=({cx:n,cy:o,event:s})=>{if(gEncoder===null)return;resetIdleTimeout();const m=s.type==="mousedown"&&s.buttons===0?1:0,b=p(0,s.buttons)||m,w=p(1,s.buttons),A=p(2,s.buttons);e=b|A<<1|w<<2,gEncoder.sendPointer(n,o,e)},gBrowserScreen.onWheelEvent=({cx:n,cy:o,event:s})=>{if(gEncoder===null)return;resetIdleTimeout();const m=s.deltaY>0?1<<4:1<<3;gEncoder.sendPointer(n,o,m),gEncoder.sendPointer(n,o,e)},gEncoder.connect()}
//# sourceMappingURL=bundle.js.map
